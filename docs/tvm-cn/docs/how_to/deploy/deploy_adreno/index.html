<!doctype html><html lang=zh-Hans dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-how_to/deploy/deploy_adreno" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>部署到 Adreno™ GPU | Apache TVM 中文站</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://lzw.me/docs/tvm-cn/docs/how_to/deploy/deploy_adreno><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="部署到 Adreno™ GPU | Apache TVM 中文站"><meta data-rh=true name=description content=介绍><meta data-rh=true property=og:description content=介绍><link data-rh=true rel=icon href=/docs/tvm-cn/img/favicon.png><link data-rh=true rel=canonical href=https://lzw.me/docs/tvm-cn/docs/how_to/deploy/deploy_adreno><link data-rh=true rel=alternate href=https://lzw.me/docs/tvm-cn/docs/how_to/deploy/deploy_adreno hreflang=zh-Hans><link data-rh=true rel=alternate href=https://lzw.me/docs/tvm-cn/docs/how_to/deploy/deploy_adreno hreflang=x-default><link data-rh=true rel=preconnect href=https://KU6TD2KAGA-dsn.algolia.net crossorigin=anonymous><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-TVRNTQWL"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-TVRNTQWL",{})</script><link rel=search type=application/opensearchdescription+xml title="Apache TVM 中文站" href=/docs/tvm-cn/opensearch.xml><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><script src=https://lzw.me/x/lib/utils/h5-common.js defer data-domain=lzw.me></script><link rel=stylesheet href=/docs/tvm-cn/assets/css/styles.d660bc20.css><script src=/docs/tvm-cn/assets/js/runtime~main.412de774.js defer></script><script src=/docs/tvm-cn/assets/js/main.60e49e7b.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/docs/tvm-cn/img/favicon-dark.svg><link rel=preload as=image href=/docs/tvm-cn/img/favicon.svg><div role=region aria-label=跳到主要内容><a class=skipToContent_ZYxR href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/docs/tvm-cn/><div class=navbar__logo><img src=/docs/tvm-cn/img/favicon-dark.svg alt="TVM Logo" class="themedComponent_PKz1 themedComponent--light_TYnW"><img src=/docs/tvm-cn/img/favicon.svg alt="TVM Logo" class="themedComponent_PKz1 themedComponent--dark_RKZm"></div><b class="navbar__title text--truncate">TVM 中文站</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/tvm-cn/docs/>查看文档</a><a class="navbar__item navbar__link" href=/docs/tvm-cn/about>关于</a><a href=https://tool.lzw.me target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">有趣工具箱<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_wR_l><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://lzw.me/x/reference/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">IT速查清单<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_wR_l><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/hyperai/tvm-cn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_wR_l><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/docs/tvm-cn/docs/how_to/deploy/deploy_adreno>0.13.0</a><ul class=dropdown__menu><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs/tvm-cn/docs/how_to/deploy/deploy_adreno>0.13.0</a><li><a class=dropdown__link href=/docs/tvm-cn/docs/0.12.0/>0.12.0</a><li><a class=dropdown__link href=/docs/tvm-cn/docs/0.10.0/>0.10.0</a></ul></div><div class="toggle_azEg colorModeToggle_ACQd"><button class="clean-btn toggleButton_rDEP toggleButtonDisabled_BTpm" type=button disabled title=切换浅色/暗黑模式（当前为浅色模式） aria-label=切换浅色/暗黑模式（当前为浅色模式） aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_FWei><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_OH98><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_CQDF><button type=button class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>搜索</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_YyXw"><div class=docsWrapper_QpQH><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_J2hp" type=button></button><div class=docRoot_e4fL><aside class="theme-doc-sidebar-container docSidebarContainer_lAUu"><div class=sidebarViewport_u_LW><div class=sidebar_CdZN><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_MbTs"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/tvm-cn/docs/>欢迎</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>快速上手</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/install>安装 TVM</a><button aria-label="展开侧边栏分类 '安装 TVM'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/contribute>贡献指南</a><button aria-label="展开侧边栏分类 '贡献指南'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--active">用户手册</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/tutorial>用户教程</a><button aria-label="展开侧边栏分类 '用户教程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/docs/tvm-cn/docs/how_to>常见问题</a><button aria-label="折叠侧边栏分类 '常见问题'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/compile/>编译深度学习模型</a><button aria-label="展开侧边栏分类 '编译深度学习模型'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/>部署模型并与 TVM 集成</a><button aria-label="折叠侧边栏分类 '部署模型并与 TVM 集成'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/deploy_c++>使用 C++ API 部署 TVM 模块</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/deploy_android>部署到 Android</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/integrate>将 TVM 集成到项目中</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/hls>HLS 后端示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/relay_arm>Relay Arm® 计算库集成</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/relay_tensorrt>Relay TensorRT 集成</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/vitis_ai>Vitis AI 集成</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/relay_bnns>Relay BNNS 集成</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/deploy_adreno>部署到 Adreno™ GPU</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/deploy/deploy_models/>部署深度学习模型</a><button aria-label="展开侧边栏分类 '部署深度学习模型'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/relay/>使用 Relay</a><button aria-label="展开侧边栏分类 '使用 Relay'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/te_schedules/>使用张量表达式和 Schedule</a><button aria-label="展开侧边栏分类 '使用张量表达式和 Schedule'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/optimize/>优化张量算子</a><button aria-label="展开侧边栏分类 '优化张量算子'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/autotune/>使用模板和 AutoTVM 进行自动调优</a><button aria-label="展开侧边栏分类 '使用模板和 AutoTVM 进行自动调优'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/autoscheduler/>使用 AutoScheduler 进行无模板调度</a><button aria-label="展开侧边栏分类 '使用 AutoScheduler 进行无模板调度'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/microtvm/>使用 microTVM</a><button aria-label="展开侧边栏分类 '使用 microTVM'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/extend/>扩展 TVM</a><button aria-label="展开侧边栏分类 '扩展 TVM'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/how_to/models/>Profile 模型</a><button aria-label="展开侧边栏分类 'Profile 模型'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/errors>处理 TVM 报错</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/how_to/FAQ>FAQ</a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>开发手册</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/dev/>开发者教程</a><button aria-label="展开侧边栏分类 '开发者教程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/dev/how_to>开发者指南</a><button aria-label="展开侧边栏分类 '开发者指南'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>设计与架构</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/arch/>设计与架构</a><button aria-label="展开侧边栏分类 '设计与架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>主题指南</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/topic/microtvm/>microTVM：裸机上的 TVM</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/topic/vta>VTA：多功能张量加速器</a><button aria-label="展开侧边栏分类 'VTA：多功能张量加速器'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></ul></nav></div></div></aside><main class=docMainContainer_ch7h><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol__o6A"><div class=docItemContainer_Wtch><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_fS1C" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/docs/tvm-cn/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_jcRj><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>用户手册</span><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/tvm-cn/docs/how_to><span itemprop=name>常见问题</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/tvm-cn/docs/how_to/deploy/><span itemprop=name>部署模型并与 TVM 集成</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>部署到 Adreno™ GPU</span><meta itemprop=position content=4></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.13.0</span><div class="tocCollapsible_hZNL theme-doc-toc-mobile tocMobile_UGcD"><button type=button class="clean-btn tocCollapsibleButton_z7oa">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>部署到 Adreno™ GPU</h1></header>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=介绍>介绍<a href=#介绍 class=hash-link aria-label=介绍的直接链接 title=介绍的直接链接>​</a></h2>
<p>Adreno™ 是由高通开发并用于许多 SoC 的图形处理单元（GPU）半导体 IP 核系列。</p>
<p>Adreno™ GPU 可以加速复杂几何图形的渲染，在提供高性能图形和丰富的用户体验的同时拥有很低的功耗。</p>
<p>TVM 使用 TVM 的原生 OpenCL 后端 和 OpenCLML 后端以支持加速 Adreno™ GPU 上的深度学习。TVM 的原生 OpenCL 后端通过结合纹理内存使用和 Adreno™ 友好布局来改进 Adreno™ 。 OpenCLML 是由高通发布的 SDK ，提供了大多数深度学习运算符的内核加速库。</p>
<p>本指南展示以下方面的不同设计</p>
<ul>
<li><a href=#opencl-%E5%90%8E%E7%AB%AF%E5%A2%9E%E5%BC%BA>OpenCL 后端增强</a></li>
<li><a href=#%E5%85%B3%E4%BA%8E-OpenCLML>关于 OpenCLML</a></li>
<li><a href=#Adreno%E2%84%A2-%E4%B8%8B%E7%9A%84-TVM>构建与部署</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=opencl-后端增强>OpenCL 后端增强<a href=#opencl-后端增强 class=hash-link aria-label="OpenCL 后端增强的直接链接" title="OpenCL 后端增强的直接链接">​</a></h2>
<p>TVM 的 OpenCL 后端已被增强以利用 Adreno™ 特色功能，如</p>
<ul>
<li>纹理内存使用。</li>
<li>Adreno™ 友好的激活布局。</li>
<li>全新的调度以加速上述功能。</li>
</ul>
<p>Adreno™ 的一个优势是对纹理的巧妙处理。目前，TVM 能够通过对 Adreno™  的纹理支持获得益处。下图显示了 Adreno™ A5x 架构。</p>
<p><img decoding=async loading=lazy src=https://raw.githubusercontent.com/tlc-pack/web-data/main/images/how-to/adreno_architecture.png alt=" Adreno™ A5x 架构的高级概览，用于 OpenCL" class=img_DHp8></p>
<p><em>图1 用于 OpenCL Adreno™ A5x 架构的高层次概览</em></p>
<p><em>来源：</em> <a href=https://dl.acm.org/doi/10.1145/3204919.3204935 target=_blank rel="noopener noreferrer">Qualcomm Adreno™ GPU 的 OpenCL 优化和最佳实践</a></p>
<p>使用纹理的原因：</p>
<ul>
<li>
<p>纹理处理器（TP）具有专用的 L1 缓存，它是只读缓存，并存储了从 2 级缓存（L2）中提取的用于纹理操作的数据（主要原因）</p>
</li>
<li>
<p>图像边界的处理已内置。</p>
</li>
<li>
<p>支持多种图像格式和数据类型组合，支持自动格式转换</p>
</li>
</ul>
<p>总体而言，与基于 OpenCL 缓冲区的解决方案相比，使用纹理可以获得显著的性能提升。</p>
<p>通常，我们将目标指定为 <code>target="opencl"</code> ，以生成如下所示的内核的常规OpenCL目标。</p>
<div class="language-c codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-c codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">   __kernel </span><span class="token keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>tvmgen_default_fused_nn_conv2d_kernel0</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">__global </span><span class="token keyword" style=color:#00009f>float</span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> restrict p0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> __global </span><span class="token keyword" style=color:#00009f>double</span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> restrict p1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> __global </span><span class="token keyword" style=color:#00009f>float</span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> restrict conv2d_nhwc</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic>// body..</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述 OpenCL 内核定义有 <code>__global float*</code> 类型指针，它们实质上是 OpenCL <code>buffer</code> 对象。</p>
<p>通过修改目标定义为 <code>target="opencl -device=adreno"</code> 启用基于纹理的增强后，我们可以看到生成的内核使用纹理支持的 OpenCL 图像对象，如下所示。</p>
<div class="language-c codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-c codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">   __kernel </span><span class="token keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>tvmgen_default_fused_nn_conv2d_kernel0</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">__write_only </span><span class="token class-name">image2d_t</span><span class="token plain"> pad_temp_global_texture</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> __read_only </span><span class="token class-name">image2d_t</span><span class="token plain"> p0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic>// body..</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><em>image2d_t</em> 是内置的 OpenCL 类型，用于表示二维图像对象并提供几个附加功能。
当我们使用 <em>image2d_t</em> 时，我们一次读取 <em>4个元素</em> 可以更有效地利用硬件。</p>
<p>有关生成和检查内核源的更多详细信息，请参阅<a href=#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95>高级用法</a>。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=关于-openclml>关于 OpenCLML<a href=#关于-openclml class=hash-link aria-label="关于 OpenCLML的直接链接" title="关于 OpenCLML的直接链接">​</a></h2>
<p>OpenCLML 是高通发布的 SDK ，提供了更快的深度学习运算符。这些运算符作为标准 OpenCL 规范的扩展 <code>cl_qcom_ml_ops</code> 公开。有关更多详细信息，请参见 <a href=https://developer.qualcomm.com/blog/accelerate-your-models-our-opencl-ml-sdk target=_blank rel="noopener noreferrer">Accelerate your models with our OpenCL ML SDK</a> 。</p>
<p>OpenCLML 已集成到 TVM ,作为 <a href="https://tvm.apache.org/docs/dev/how_to/relay_bring_your_own_codegen.html?highlight=bring%20your%20own" target=_blank rel="noopener noreferrer">BYOC</a> 解决方案。 OpenCLML 运算符可以使用相同的上下文，并可以加入到同样被原生 OpenCL 使用的命令队列中。我们利用了这一点避免在回退到原生 OpenCL 时的上下文切换。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=adreno-下的-tvm>Adreno™ 下的 TVM<a href=#adreno-下的-tvm class=hash-link aria-label="Adreno™ 下的 TVM的直接链接" title="Adreno™ 下的 TVM的直接链接">​</a></h2>
<p>本节提供有关构建和部署模型到 Adreno™ 目标机的方法说明。 Adreno™ 是通过 ADB 连接与主机连接的远程目标。在这里部署已编译的模型需要在主机和目标上使用一些工具。</p>
<p>TVM 提供了简单的、用户友好的命令行工具以及专为开发者设计的 Python API 接口，可用于各种步骤，如自动调整、构建和部署。</p>
<p><img decoding=async loading=lazy src=https://raw.githubusercontent.com/tlc-pack/web-data/main/images/how-to/Adreno-Deployment-Pipeline.jpg alt=图2 class=img_DHp8>
<em>图2 Adreno 设备的构建和部署流水线</em></p>
<p>上图展示了以下各个阶段的通用流程：</p>
<ul>
<li>
<p>导入模型：在此阶段，我们从知名框架（如 TensorFlow、PyTorch、ONNX 等）导入模型。该阶段将给定的模型转换为 TVM 的 relay 模块格式。或者也可以通过使用 TVM 的操作库手动构建 relay 模块。此处生成的 TVM 模块的是独立于图的表示形式的目标。</p>
</li>
<li>
<p>自动调整：在此阶段，我们调整特定于目标的 TVM 生成的内核。自动调整过程需要目标设备的有效性，在如 Android 设备上的 Adreno™ 这样的远程目标中，我们使用 RPC 设置进行通信。本指南的后续部分将详细介绍 Android 设备的 RPC 设置。自动调整不是模型编译的必需步骤，但对于获得 TVM 生成的内核的最佳性能是必要的。</p>
</li>
<li>
<p>编译：在此阶段，我们为特定目标编译模型。鉴于我们在前一阶段自动调整了模块， TVM 编译利用调整日志以生成性能最佳的内核。 TVM 编译进程中产生包含内核的共享库、以 json 格式定义的图和以 TVM 特定格式的二进制参数文件。</p>
</li>
<li>
<p>部署（或测试运行）到目标：在此阶段，我们在目标上运行 TVM 编译输出。部署可以从 Python 环境中使用 RPC 设置。也可以使用 TVM 的本地工具进行，该工具可以为 Android 进行本地二进制交叉编译。在此阶段，我们可以在 Android 目标上运行已编译的模型，并对输出的正确性和性能方面进行单元测试。</p>
</li>
<li>
<p>应用集成：本阶段涉及将 TVM 编译的模型集成到应用程序中。我们在这里讨论如何从 Android（cpp 本地环境或 JNI）中设置输入和获取输出的 TVM 运行时接口。</p>
</li>
<li>
<p>高级用法：本部分涵盖了高级用户感兴趣的主题，如查看生成的源代码、更改模块的精度等。</p>
</li>
</ul>
<p>此教程以下各节将涵盖上述内容。</p>
<ul>
<li><a href=#%E8%87%AA%E5%8A%A8%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE>开发环境</a></li>
<li><a href=#rpc-%E8%AE%BE%E7%BD%AE>RPC 设置</a></li>
<li><a href=#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7>命令行工具</a></li>
<li><a href=#python-%E6%8E%A5%E5%8F%A3>Python 接口</a></li>
<li><a href=#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%9B%86%E6%88%90>应用集成</a></li>
<li><a href=#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95>高级用法</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=自动开发环境设置>自动开发环境设置<a href=#自动开发环境设置 class=hash-link aria-label=自动开发环境设置的直接链接 title=自动开发环境设置的直接链接>​</a></h2>
<p>TVM 提供了一个预定义的 Docker 容器环境，其中包含了所有入门所需的先决条件。如果您想要更多地控制依赖关系，请参考<a href=#%E6%89%8B%E5%8A%A8%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE>手动环境设置</a>。</p>
<p>对于 Docker 设置，先决条件只是主机上有 Docker 工具。</p>
<p>以下命令可以构建 Adreno 的 Docker 镜像：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">./docker/build.sh ci_adreno</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>docker</span><span class="token plain"> tag tvm.ci_adreno ci_adreno</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>现在，我们可以使用以下命令构建主机和目标工具：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">./tests/scripts/ci.py adreno </span><span class="token parameter variable" style=color:#36acaa>-i</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>要使用 OpenCLML SDK 构建TVM，在构建时需要导出 OpenCLML SDK，如下所示：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#36acaa>ADRENO_OPENCL</span><span class="token operator" style=color:#393A34>=</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">OpenCLML SDK路径</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">./tests/scripts/ci.py adreno </span><span class="token parameter variable" style=color:#36acaa>-i</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>成功编译后，您将进入 Docker shell。构建将生成两个文件夹：</p>
<ul>
<li><code>build-adreno</code>：主机端TVM编译器构建。</li>
<li><code>build-adreno-target</code>：包含 Android 目标组件。<!-- -->
<ul>
<li>libtvm_runtime.so：TVM 运行时库</li>
<li>tvm_rpc：rpc 运行时环境工具</li>
<li>rtvm：独立的原生工具</li>
</ul>
</li>
</ul>
<p>在使用Docker环境时， Android 设备与主机共享，所以在主机上需要安装 ADB 版本为 <code>1.0.41</code> ，因为 Docker 使用相同的版本。</p>
<p>您还可以在 Docker 环境中检查 ADB 设备的可用性：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">user@ci-adreno-fpeqs:~$ adb devices</span><br></span><span class=token-line style=color:#393A34><span class="token plain">List of devices attached</span><br></span><span class=token-line style=color:#393A34><span class="token plain">aaaabbbb	device</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ccccdddd	device</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=手动开发环境设置>手动开发环境设置<a href=#手动开发环境设置 class=hash-link aria-label=手动开发环境设置的直接链接 title=手动开发环境设置的直接链接>​</a></h2>
<p>手动构建过程需要构建主机和目标组件。</p>
<p>以下命令将配置主机编译：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token function" style=color:#d73a49>mkdir</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>-p</span><span class="token plain"> build</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> build</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>cp</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>..</span><span class="token plain">/cmake/config.cmake </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 启用 RPC 功能以与远程设备通信。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_RPC ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 我们在主机（x86）上使用图执行器验证模型。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_GRAPH_EXECUTOR ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 启用溢出时的回溯以获取更多调试信息。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_LIBBACKTRACE AUTO</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 目标主机将是 llvm。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_LLVM ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>此外，我们可以推送以下配置条目，以使用 OpenCLML 支持进行编译：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#36acaa>ADRENO_OPENCL</span><span class="token operator" style=color:#393A34>=</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">OpenCLML SDK路径</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_CLML </span><span class="token variable" style=color:#36acaa>${ADRENO_OPENCL}</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>现在我们可以像下面这样构建：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">cmake </span><span class="token punctuation" style=color:#393A34>..</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>make</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>最后，我们可以导出 Python 路径：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#36acaa>PYTHONPATH</span><span class="token operator" style=color:#393A34>=</span><span class="token variable" style=color:#36acaa>$TVM_HOME</span><span class="token plain">/python:</span><span class="token variable" style=color:#36acaa>${PYTHONPATH}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">python3 </span><span class="token parameter variable" style=color:#36acaa>-c</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"import tvm"</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 验证tvm Python包</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>现在，我们可以使用以下配置来配置和构建目标组件。目标构建需要安装 Android NDK。</p>
<ul>
<li>在此处阅读有关 <em>Android NDK 安装</em> 的文档：<a href=https://developer.android.com/ndk target=_blank rel="noopener noreferrer">https://developer.android.com/ndk</a></li>
<li>要获取 adb 工具的访问权限，您可以在此处查看 <em>Android Debug Bridge 安装</em> ：<a href=https://developer.android.com/studio/command-line/adb target=_blank rel="noopener noreferrer">https://developer.android.com/studio/command-line/adb</a></li>
</ul>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token function" style=color:#d73a49>mkdir</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>-p</span><span class="token plain"> build-adreno</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> build-adreno</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>cp</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>..</span><span class="token plain">/cmake/config.cmake </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 启用 OpenCL 后端。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_OPENCL ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 启用 RPC 功能。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_RPC ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 构建在目标设备上运行的 tvm_rpc 工具。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_CPP_RPC ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 构建本机 rtvm 部署工具。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_CPP_RTVM ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 我们在像 Android 这样的设备上使用图执行器。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_GRAPH_EXECUTOR ON</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 在可能的情况下启用回溯。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_LIBBACKTRACE AUTO</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># Adreno 支持 OpenCL 分配的32位对齐而不是64位。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_KALLOC_ALIGNMENT </span><span class="token number" style=color:#36acaa>32</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># Android 构建相关定义。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ANDROID_ABI arm64-v8a</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ANDROID_PLATFORM android-28</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">MACHINE_NAME aarch64-linux-gnu</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>此外，我们可以推送以下配置以使用 OpenCLML 支持进行编译：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#36acaa>ADRENO_OPENCL</span><span class="token operator" style=color:#393A34>=</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">OpenCLML SDK路径</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_CLML </span><span class="token string" style=color:#e3116c>"</span><span class="token string variable" style=color:#36acaa>${ADRENO_OPENCL}</span><span class="token string" style=color:#e3116c>"</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> set</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">USE_CLML_GRAPH_EXECUTOR </span><span class="token string" style=color:#e3116c>"</span><span class="token string variable" style=color:#36acaa>${ADRENO_OPENCL}</span><span class="token string" style=color:#e3116c>"</span><span class="token punctuation" style=color:#393A34>\</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> config.cmake</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>对于 Android 目标构建，<code>ANDROID_NDK_HOME</code> 是一个依赖项，我们应该在环境变量中设置相同的依赖项。以下命令将构建 Adreno™ 目标组件：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">cmake </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_TOOLCHAIN_FILE</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"</span><span class="token string variable" style=color:#36acaa>${ANDROID_NDK_HOME}</span><span class="token string" style=color:#e3116c>/build/cmake/android.toolchain.cmake"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DANDROID_ABI</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">arm64-v8a </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DANDROID_PLATFORM</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">android-28 </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_SYSTEM_VERSION</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_FIND_ROOT_PATH</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"</span><span class="token string variable" style=color:#36acaa>${ADRENO_OPENCL}</span><span class="token string" style=color:#e3116c>"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">NEVER </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">ONLY </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_CXX_COMPILER</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"</span><span class="token string variable" style=color:#36acaa>${ANDROID_NDK_HOME}</span><span class="token string" style=color:#e3116c>/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android28-clang++"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DCMAKE_C_COMPILER</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"</span><span class="token string variable" style=color:#36acaa>${ANDROID_NDK_HOME}</span><span class="token string" style=color:#e3116c>/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android28-clang"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token parameter variable" style=color:#36acaa>-DMACHINE_NAME</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"aarch64-linux-gnu"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>..</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>make</span><span class="token plain"> tvm_runtime tvm_rpc rtvm</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=rpc-设置>RPC 设置<a href=#rpc-设置 class=hash-link aria-label="RPC 设置的直接链接" title="RPC 设置的直接链接">​</a></h2>
<p>RPC 设置允许通过 TCP/IP 网络接口访问远程目标。RPC 设置对于自动调整阶段是必不可少的，因为调整涉及在真实设备上运行自动生成的内核，并通过使用机器学习方法对其进行优化。请参考 <a href=https://tvm.apache.org/docs/how_to/tune_with_autotvm/index.html target=_blank rel="noopener noreferrer">使用模板和 AutoTVM 进行自动调整</a> 以获取有关 AutoTVM 的详细信息。</p>
<p>RPC 设置也可用于通过 python 接口或来自主机设备的 <code>tvmc</code> 工具将已编译的模型部署到远程设备。</p>
<p>RPC 设置有多个组件，如下所示。</p>
<p><strong>TVM Tracker:</strong> TVM Tracker 是主机端的守护程序，管理远程设备并为主机端应用程序提供服务。应用程序可以连接到此跟踪器并获取远程设备句柄以进行通信。</p>
<p><strong>TVM RPC:</strong> TVM RPC 是在远程设备上运行的本地应用程序（本情况下是 Android ），并向在主机上运行的 TVM Tracker 注册自身。</p>
<p>因此，对于基于 RPC 的设置，我们将在主机和目标设备上运行上述组件。以下部分解释了如何手动设置相同的内容，以及如何在使用自动化工具的 Docker 环境中设置相同的内容。</p>
<p>**自动化 RPC 设置:**此处，我们将解释如何在 Docker 环境中设置 RPC 。</p>
<p>以下命令在 Docker 环境中启动 tracker，其中 tracker 监听端口 9190。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">./tests/scripts/ci.py adreno </span><span class="token parameter variable" style=color:#36acaa>-i</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 在 anreno docker 上启动一个新的 shell</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> tests/scripts/setup-adreno-env.sh </span><span class="token parameter variable" style=color:#36acaa>-e</span><span class="token plain"> tracker </span><span class="token parameter variable" style=color:#36acaa>-p</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9190</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>现在，以下命令可以在具有 ID <code>abcdefgh</code> 的远程 Android 设备上运行 TVM RPC 。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">./tests/scripts/ci.py adreno </span><span class="token parameter variable" style=color:#36acaa>-i</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 在adreno docker上启动一个新的shell。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> tests/scripts/setup-adreno-env.sh </span><span class="token parameter variable" style=color:#36acaa>-e</span><span class="token plain"> device </span><span class="token parameter variable" style=color:#36acaa>-p</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9190</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>-d</span><span class="token plain"> abcdefgh</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>此外，以下命令可用于在任何其他 Docker 终端上查询 RPC 设置详细信息。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">./tests/scripts/ci.py adreno </span><span class="token parameter variable" style=color:#36acaa>-i</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 在 adreno docker 上启动一个新的 shell。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> tests/scripts/setup-adreno-env.sh </span><span class="token parameter variable" style=color:#36acaa>-e</span><span class="token plain"> query </span><span class="token parameter variable" style=color:#36acaa>-p</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9190</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>**手动 RPC 设置：**请参阅教程 <a href=https://tvm.apache.org/docs/how_to/deploy_models/deploy_model_on_adreno.html target=_blank rel="noopener noreferrer">在 Adreno 上部署模型</a> 了解手动 RPC 环境设置。</p>
<p>这些 RPC 设置完成后，我们在主机 <code>127.0.0.1</code>（rpc-tracker）上拥有 rpc-tracker，端口 <code>9190</code> （rpc-port）可用。</p>
<p>.. _commandline_interface:</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=命令行工具>命令行工具<a href=#命令行工具 class=hash-link aria-label=命令行工具的直接链接 title=命令行工具的直接链接>​</a></h2>
<p>此处我们使用命令行工具描述整个编译进程。 TVM 具有命令行实用程序 <a href=https://tvm.apache.org/docs/tutorial/tvmc_command_line_driver.html target=_blank rel="noopener noreferrer">tvmc</a>，用于执行模型导入、自动调整、编译和 rpc 部署。 <a href=https://tvm.apache.org/docs/tutorial/tvmc_command_line_driver.html target=_blank rel="noopener noreferrer">tvmc</a> 有许多选项可供探索和尝试。</p>
<p>**模型导入和调整：**使用以下命令从任何框架导入模型并对其进行自动调整。此处我们使用来自 Keras 的模型，它使用 RPC 设置进行调整，并最终生成调整日志文件 <code>keras-resnet50.log</code> 。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">python3 </span><span class="token parameter variable" style=color:#36acaa>-m</span><span class="token plain"> tvm.driver.tvmc tune </span><span class="token parameter variable" style=color:#36acaa>--target</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"opencl -device=adreno"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--target-host</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"llvm -mtriple=aarch64-linux-gnu"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">resnet50.h5 </span><span class="token parameter variable" style=color:#36acaa>-o</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">keras-resnet50.log </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--early-stopping </span><span class="token number" style=color:#36acaa>0</span><span class="token plain"> </span><span class="token parameter variable" style=color:#36acaa>--repeat</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>30</span><span class="token plain"> --rpc-key android </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--rpc-tracker </span><span class="token number" style=color:#36acaa>127.0</span><span class="token plain">.0.1:9190 </span><span class="token parameter variable" style=color:#36acaa>--trials</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1024</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--tuning-records keras-resnet50-records.log </span><span class="token parameter variable" style=color:#36acaa>--tuner</span><span class="token plain"> xgb</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>模型编译:</strong></p>
<p>使用以下命令编译模型并生成TVM编译器输出。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">python3 </span><span class="token parameter variable" style=color:#36acaa>-m</span><span class="token plain"> tvm.driver.tvmc compile </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--cross-compiler </span><span class="token variable" style=color:#36acaa>${ANDROID_NDK_HOME}</span><span class="token plain">/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android28-clang </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token parameter variable" style=color:#36acaa>--target</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"opencl, llvm"</span><span class="token plain"> --target-llvm-mtriple aarch64-linux-gnu --target-opencl-device adreno </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--tuning-records keras-resnet50.log </span><span class="token parameter variable" style=color:#36acaa>-o</span><span class="token plain"> keras-resnet50.tar resnet50.h5</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在启用 OpenCLML 卸载时，我们需要如下添加目标 <code>clml</code> 。调整日志对于 OpenCLML 卸载同样有效，因为 OpenCL 路径是没有经过 OpenCLML 路径的任何运算符的回退选项。调整日志将用于这类运算符。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">python3 </span><span class="token parameter variable" style=color:#36acaa>-m</span><span class="token plain"> tvm.driver.tvmc compile </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--cross-compiler </span><span class="token variable" style=color:#36acaa>${ANDROID_NDK_HOME}</span><span class="token plain">/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android28-clang </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token parameter variable" style=color:#36acaa>--target</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"opencl, clml, llvm"</span><span class="token plain"> --target-llvm-mtriple aarch64-linux-gnu --target-opencl-device adreno </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--tuning-records keras-resnet50.log </span><span class="token parameter variable" style=color:#36acaa>-o</span><span class="token plain"> keras-resnet50.tar resnet50.h5</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在成功编译后，上述命令会产生 <code>keras-resnet50.tar</code> 。这是一个压缩存档，包含有 kernel shared lib（ mod.so ）、graph json（ mod.json ）和参数二进制（ mod.params ）。</p>
<p><strong>在目标上部署和运行:</strong></p>
<p>可以通过 RPC 方式和本地部署方式实现在 Android 目标上运行编译后的模型。</p>
<p>我们可以使用下面的 tvmc 命令通过 RPC 基础设置在远程目标上部署。</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">python3 </span><span class="token parameter variable" style=color:#36acaa>-m</span><span class="token plain"> tvm.driver.tvmc run </span><span class="token parameter variable" style=color:#36acaa>--device</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"cl"</span><span class="token plain"> keras-resnet50.tar </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">--rpc-key android --rpc-tracker </span><span class="token number" style=color:#36acaa>127.0</span><span class="token plain">.0.1:9190 --print-time</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>基于运行的 <a href=https://tvm.apache.org/docs/tutorial/tvmc_command_line_driver.html target=_blank rel="noopener noreferrer">tvmc</a> 提供了更多选项，用于以各种模式（如 fill 、 random 等）初始化输入。</p>
<p>基于部署的 <code>tvmc</code> 通常是通过 RPC 设置从远程主机快速验证在目标上编译的模型的一种方式。</p>
<p>通常，生产环境使用原生部署环境，如 Android JNI 或 CPP 原生环境。此处我们需要使用交叉编译的 <code>tvm_runtime</code> 接口来部署 tvm 编译输出，即 <code>TVMPackage</code> 。</p>
<p>TVM 有一个名为 <code>rtvm</code> 的独立工具，用于在 ADB shell 上本地部署和运行模型。构建过程会在 build-adreno-target 下生成此工具。有关有关此工具的更多详细信息，请参阅 <a href=https://github.com/apache/tvm/tree/main/apps/cpp_rtvm target=_blank rel="noopener noreferrer">rtvm</a> 。</p>
<p>在将其集成到现有 Android 应用程序中时， TVM 有多种选择。对于 JNI 或 CPP 原生，我们可以使用 <a href=https://github.com/apache/tvm/blob/main/include/tvm/runtime/c_runtime_api.h target=_blank rel="noopener noreferrer">C Runtime API</a> 。
您还可以参考 <code>rtvm</code> 的简化接口 <a href=https://github.com/apache/tvm/blob/main/apps/cpp_rtvm/tvm_runner.h%3E target=_blank rel="noopener noreferrer">TVMRunner</a> 。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=python-接口>Python 接口<a href=#python-接口 class=hash-link aria-label="Python 接口的直接链接" title="Python 接口的直接链接">​</a></h2>
<p>该节解释如何使用 Python 接口导入、自动调整、编译和运行模型的过程。 TVM 通过 <code>tvmc</code> 抽象提供高级接口，以及低级的 Relay API 。我们将详细讨论这两者。</p>
<p><strong>TVMC 接口：</strong></p>
<p>在使用 <code>tvmc</code> Python接口时，我们首先加载一个生成 <code>TVMCModel</code> 的模型。 <code>TVMCModel</code> 将用于自动调整以生成调整缓存。编译进程使用 <code>TVMCModel</code> 和调整缓存（可选）来生成 <code>TVMCPackage</code> 。现在 <code>TVMCPackage</code> 将保存到文件系统，或者可以用于部署和在目标设备上运行。</p>
<p>请参考相应的教程<a href=https://tvm.apache.org/docs/how_to/deploy_models/deploy_model_on_adreno_tvmc.html target=_blank rel="noopener noreferrer">如何使用 TVMC 在 Adreno 上部署预训练模型</a>。</p>
<p>保存的 <code>TVMCPackage</code> 也可以用于使用 <code>rtvm</code> 工具进行原生部署。</p>
<p>此外，请参考 <a href=https://tvm.apache.org/docs/how_to/deploy_models/deploy_model_on_adreno.html target=_blank rel="noopener noreferrer">使用 TVMC 编译和优化模型</a> 文档，了解有关 API 接口的更多详细信息。</p>
<p><strong>Relay 接口：</strong></p>
<p>Relay API 接口提供了对 TVM 编译器接口的低级 API 访问。与 <code>tvmc</code> 接口类似，Relay API 接口提供了各种前端 API，用于将模型转换为 Relay <code>Module</code>。Relay <code>Module</code> 将用于所有种类的转换，如精度转换、CLML 卸载和其他自定义转换（如果有）。生成的 Module 也将用于自动调整。最后，我们使用 <code>relay.build</code> API 生成库模块。从这个库模块，我们可以导出编译产物，如模块共享库（mod.so）、参数（mod.params）和 json 图（mod.json）。这个库模块将用于创建图形运行时以在目标设备上部署和运行。</p>
<p>请参考教程<a href=https://tvm.apache.org/docs/how_to/deploy_models/deploy_model_on_adreno.html target=_blank rel="noopener noreferrer">如何在 Adreno 上部署预训练模型</a>，其中逐步解释了相同的内容。</p>
<p>此外，TVM 还通过 <a href=https://github.com/apache/tvm/tree/main/jvm target=_blank rel="noopener noreferrer">TVM4J</a> 支持 Java 接口。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=应用程序集成>应用程序集成<a href=#应用程序集成 class=hash-link aria-label=应用程序集成的直接链接 title=应用程序集成的直接链接>​</a></h2>
<p>TVM 编译输出以模块共享库（mod.so）、图形 json （mod.json）和参数（mod.params）的形式表示。 TVMPackage 的存档表示也包含相同的内容。</p>
<p>通常对于任何 Android 应用程序集成来说，基于 CPP/C 的接口就足够了。</p>
<p>TVM 原生地公开了 <code>c_runtime_api</code>，用于加载 TVM 编译的模块并运行相同的模块。</p>
<p>或者，用户还可以参考 <a href=https://github.com/apache/tvm/blob/main/apps/cpp_rtvm/tvm_runner.h target=_blank rel="noopener noreferrer">cpp_rtvm</a> 中的 <code>TVMRunner</code> 接口，以获得相同的进一步简化的版本。</p>
<p>.. _advanced_usage:</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=高级用法>高级用法<a href=#高级用法 class=hash-link aria-label=高级用法的直接链接 title=高级用法的直接链接>​</a></h2>
<p>本节详细介绍在 TVM 上 使用 Adreno™ 目标机时的一些高级用法和其他信息。</p>
<p><strong>生成源码检查</strong></p>
<p>除了标准的 tvm 编译产物（kernel 库 mod.so 、图形 mod.json 和参数 mod.params）之外，我们还可以从 lib handle 生成 opencl kernel 源码、clml 卸载图等。TVM 编译的输出被组织为一个 TVM 模块，其中包含许多其他导入的 TVM 模块。</p>
<p>下面的代码段可以将 CLML子 图以 json 格式转储。</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 查找 "clml" 类型的导入模块。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">clml_modules </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style=color:#393A34>(</span><span class="token builtin">filter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>lambda</span><span class="token plain"> mod</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> mod</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">type_key </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"clml"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> lib</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_lib</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">imported_modules</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 循环遍历所有 clml 子图并转储以 json 格式的 CLML 子图。</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> cmod </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> clml_modules</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token keyword" style=color:#00009f>print</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"CLML Src:"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> cmod</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_source</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>类似地，下面的代码段可以从编译的 TVM 模块中提取 opencl</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 类似地，我们可以转存开放的内核源码如下所示</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 寻找 "opencl" 类型模块导入.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">opencl_modules </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style=color:#393A34>(</span><span class="token builtin">filter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>lambda</span><span class="token plain"> mod</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> mod</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">type_key </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"opencl"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> lib</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_lib</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">imported_modules</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 现在为每一个 Open CL 的目标子图转储内核源码</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> omod </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> opencl_modules</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>print</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"OpenCL Src:"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> omod</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_source</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=精度>精度<a href=#精度 class=hash-link aria-label=精度的直接链接 title=精度的直接链接>​</a></h2>
<p>选择特定工作负载的正确精度可以极大地提高解决方案的效率，将精度和速度的初始平衡转移到问题的首要一侧。</p>
<p>我们可以选择 <em>float16</em>，<em>float16_acc32</em>（混合精度），<em>float32</em>（标准）。</p>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=float16>Float16<a href=#float16 class=hash-link aria-label=Float16的直接链接 title=Float16的直接链接>​</a></h3>
<p>为了充分利用 GPU 硬件功能并利用半精度计算和内存管理的优势，我们可以将具有浮点运算的原始模型转换为使用半精度运算的模型。选择较低的精度将积极地影响模型的性能，但也可能导致模型精度下降。</p>
<p>要执行转换，您需要在任何一个前端生成 Relay 模块的同时调用 Adreno 特定的转换 API 。</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">driver</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">tvmc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transform </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> apply_graph_transforms</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mod </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> apply_graph_transforms</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    mod</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision_ops"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"nn.conv2d"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"nn.dense"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision_calculation_type"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float16"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision_acc_type"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float16"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>tvm.driver.tvmc.transform.apply_graph_transforms</code> 是对 <code>ToMixedPrecision</code> 传递的简化 API ，为了获取所需的精度。</p>
<p>然后我们可以以任意方便的方式编译我们的模型：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>with</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transform</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">PassContext</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">opt_level</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    lib </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> relay</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">build</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        mod</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> target_host</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">target_host</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> target</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">target</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> params</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">params</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在使用 <code>tvmc</code> Python接口时，下面的参数启用到 float16 的精度转换：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">mixed_precision </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mixed_precision_ops </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"nn.conv2d"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"nn.dense"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mixed_precision_calculation_type </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float16"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mixed_precision_acc_type </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float16"</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>同样，<code>tvmc</code> 命令行接口选项有以下列出的选项：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision</span><br></span><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision-ops nn.conv2d nn.dense</span><br></span><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision-calculation-type float16</span><br></span><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision-acc-type float16</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=float16_acc32-混合精度>float16_acc32 (混合精度)<a href=#float16_acc32-混合精度 class=hash-link aria-label="float16_acc32 (混合精度)的直接链接" title="float16_acc32 (混合精度)的直接链接">​</a></h3>
<p><code>ToMixedPrecision</code> 过程遍历网络并将网络拆分为处理 float 或 float16 数据类型的操作簇。这些簇由三种类型的操作定义：</p>
<ul>
<li>总是转换为 float16 数据类型的操作</li>
<li>如果后面跟着转换簇，可以转换的操作</li>
<li>从不转换为 float16 数据类型的操作</li>
</ul>
<p>此列表在 ToMixedPrecision 的实现 <a href=https://github.com/apache/tvm/blob/main/python/tvm/relay/transform/mixed_precision.py#L34 target=_blank rel="noopener noreferrer">relay/transform/mixed_precision.py</a> 中定义，用户可以覆盖。</p>
<p><code>ToMixedPrecision</code> 方法是将 FP32 的 Relay 图转换为 FP16 版本（使用 FP16 或 FP32 累积数据类型）的过程。进行此转换对于减小模型大小很有用，因为它将权重的期望大小减半（FP16_acc16情况）。</p>
<p><code>ToMixedPrecision</code> 过程的使用简化为以下代码：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">driver</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">tvmc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transform </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> apply_graph_transforms</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mod </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> apply_graph_transforms</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    mod</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision_ops"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"nn.conv2d"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"nn.dense"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision_calculation_type"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float16"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"mixed_precision_acc_type"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float32"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>tvm.driver.tvmc.transform.apply_graph_transforms</code> 是对 <code>ToMixedPrecision</code> 过程的简化 API ，以获取所需的精度。</p>
<p>然后我们可以以任何方便的方式编译我们的模型：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>with</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transform</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">PassContext</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">opt_level</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    lib </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> relay</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">build</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        mod</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> target_host</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">target_host</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> target</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">target</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> params</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">params</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在使用 <code>tvmc</code> Python 接口时，下面的参数启用到 float16_acc32 的精度转换：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">mixed_precision </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mixed_precision_ops </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"nn.conv2d"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"nn.dense"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mixed_precision_calculation_type </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float16"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mixed_precision_acc_type </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"float32"</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>同样， <code>tvmc</code> 命令行接口选项有以下选项：</p>
<div class="language-bash codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-bash codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision</span><br></span><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision-ops nn.conv2d nn.dense</span><br></span><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision-calculation-type float16</span><br></span><span class=token-line style=color:#393A34><span class="token plain">--mixed-precision-acc-type float32</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/hyperai/tvm-cn/edit/master/docs/how_to/deploy/09-deploy_adreno.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_OUzX aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_ccpN"><span class=theme-last-updated>最后<!-- -->由 <b>sparanoid</b> <!-- -->于 <b><time datetime=2025-04-15T11:50:10.000Z itemprop=dateModified>2025年4月15日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/tvm-cn/docs/how_to/deploy/relay_bnns><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>Relay BNNS 集成</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/tvm-cn/docs/how_to/deploy/deploy_models/><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>部署深度学习模型</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cD69 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#介绍 class="table-of-contents__link toc-highlight">介绍</a><li><a href=#opencl-后端增强 class="table-of-contents__link toc-highlight">OpenCL 后端增强</a><li><a href=#关于-openclml class="table-of-contents__link toc-highlight">关于 OpenCLML</a><li><a href=#adreno-下的-tvm class="table-of-contents__link toc-highlight">Adreno™ 下的 TVM</a><li><a href=#自动开发环境设置 class="table-of-contents__link toc-highlight">自动开发环境设置</a><li><a href=#手动开发环境设置 class="table-of-contents__link toc-highlight">手动开发环境设置</a><li><a href=#rpc-设置 class="table-of-contents__link toc-highlight">RPC 设置</a><li><a href=#命令行工具 class="table-of-contents__link toc-highlight">命令行工具</a><li><a href=#python-接口 class="table-of-contents__link toc-highlight">Python 接口</a><li><a href=#应用程序集成 class="table-of-contents__link toc-highlight">应用程序集成</a><li><a href=#高级用法 class="table-of-contents__link toc-highlight">高级用法</a><li><a href=#精度 class="table-of-contents__link toc-highlight">精度</a><ul><li><a href=#float16 class="table-of-contents__link toc-highlight">Float16</a><li><a href=#float16_acc32-混合精度 class="table-of-contents__link toc-highlight">float16_acc32 (混合精度)</a></ul></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>© 2025 Apache Software Foundation and Hyper.AI for Chinese Simplified mirror</div></div></div></footer></div>