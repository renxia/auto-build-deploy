<!doctype html><html lang=zh-Hans dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-0.10.0 docs-doc-page docs-doc-id-arch/index" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>设计与架构 | Apache TVM 中文站</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://lzw.me/docs/tvm-cn/docs/0.10.0/arch/><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docusaurus_version content=0.10.0><meta data-rh=true name=docusaurus_tag content=docs-default-0.10.0><meta data-rh=true name=docsearch:version content=0.10.0><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-0.10.0><meta data-rh=true property=og:title content="设计与架构 | Apache TVM 中文站"><meta data-rh=true name=description content="本文档适用于想要了解 TVM 架构和/或积极开发项目的开发者。本文档组织结构如下："><meta data-rh=true property=og:description content="本文档适用于想要了解 TVM 架构和/或积极开发项目的开发者。本文档组织结构如下："><link data-rh=true rel=icon href=/docs/tvm-cn/img/favicon.png><link data-rh=true rel=canonical href=https://lzw.me/docs/tvm-cn/docs/0.10.0/arch/><link data-rh=true rel=alternate href=https://lzw.me/docs/tvm-cn/docs/0.10.0/arch/ hreflang=zh-Hans><link data-rh=true rel=alternate href=https://lzw.me/docs/tvm-cn/docs/0.10.0/arch/ hreflang=x-default><link data-rh=true rel=preconnect href=https://KU6TD2KAGA-dsn.algolia.net crossorigin=anonymous><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-TVRNTQWL"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-TVRNTQWL",{})</script><link rel=search type=application/opensearchdescription+xml title="Apache TVM 中文站" href=/docs/tvm-cn/opensearch.xml><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><script src=https://lzw.me/x/lib/utils/h5-common.js defer data-domain=lzw.me></script><link rel=stylesheet href=/docs/tvm-cn/assets/css/styles.d660bc20.css><script src=/docs/tvm-cn/assets/js/runtime~main.412de774.js defer></script><script src=/docs/tvm-cn/assets/js/main.60e49e7b.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/docs/tvm-cn/img/favicon-dark.svg><link rel=preload as=image href=/docs/tvm-cn/img/favicon.svg><div role=region aria-label=跳到主要内容><a class=skipToContent_ZYxR href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/docs/tvm-cn/><div class=navbar__logo><img src=/docs/tvm-cn/img/favicon-dark.svg alt="TVM Logo" class="themedComponent_PKz1 themedComponent--light_TYnW"><img src=/docs/tvm-cn/img/favicon.svg alt="TVM Logo" class="themedComponent_PKz1 themedComponent--dark_RKZm"></div><b class="navbar__title text--truncate">TVM 中文站</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/tvm-cn/docs/0.10.0/>查看文档</a><a class="navbar__item navbar__link" href=/docs/tvm-cn/about>关于</a><a href=https://tool.lzw.me target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">有趣工具箱<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_wR_l><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://lzw.me/x/reference/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">IT速查清单<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_wR_l><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/hyperai/tvm-cn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_wR_l><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/docs/tvm-cn/docs/0.10.0/arch/>0.10.0</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs/tvm-cn/docs/arch/>0.13.0</a><li><a class=dropdown__link href=/docs/tvm-cn/docs/0.12.0/arch/>0.12.0</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs/tvm-cn/docs/0.10.0/arch/>0.10.0</a></ul></div><div class="toggle_azEg colorModeToggle_ACQd"><button class="clean-btn toggleButton_rDEP toggleButtonDisabled_BTpm" type=button disabled title=切换浅色/暗黑模式（当前为浅色模式） aria-label=切换浅色/暗黑模式（当前为浅色模式） aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_FWei><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_OH98><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_CQDF><button type=button class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>搜索</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_YyXw"><div class=docsWrapper_QpQH><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_J2hp" type=button></button><div class=docRoot_e4fL><aside class="theme-doc-sidebar-container docSidebarContainer_lAUu"><div class=sidebarViewport_u_LW><div class=sidebar_CdZN><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_MbTs"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/tvm-cn/docs/0.10.0/>欢迎</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>快速上手</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/install>安装 TVM</a><button aria-label="展开侧边栏分类 '安装 TVM'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/contribute>贡献指南</a><button aria-label="展开侧边栏分类 '贡献指南'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>用户手册</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/tutorial>用户教程</a><button aria-label="展开侧边栏分类 '用户教程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/how_to>常见问题</a><button aria-label="展开侧边栏分类 '常见问题'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>开发手册</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/dev/>开发者教程</a><button aria-label="展开侧边栏分类 '开发者教程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/dev/how_to>开发者指南</a><button aria-label="展开侧边栏分类 '开发者指南'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--active">设计与架构</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current=page tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/>设计与架构</a><button aria-label="折叠侧边栏分类 '设计与架构'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/runtimes/>TVM Runtime 系统</a><button aria-label="展开侧边栏分类 'TVM Runtime 系统'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/debugger>调试器</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/virtual_machine>向 TVM 中添加虚拟机：Relay 虚拟机</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/introduction_to_module_serialization>模块序列化简介</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/device_target_interactions>设备/Target 交互</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/pass_infra>Pass Infrastructure</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/inferbound>InferBound Pass</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/hybrid_script>混合前端开发者指南</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/relay_intro>Relay IR 简介</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/relay_op_strategy>Relay 算子策略</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/convert_layout>Convert Layout Pass</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/benchmark>Benchmark 性能日志格式</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/tensorflow>TensorFlow 前端</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/security>安全指南</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/microtvm_design>microTVM 设计文档</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/microtvm_project_api>关于 microTVM 项目 API</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/arch/arch/model_library_format>模型库格式</a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>主题指南</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/tvm-cn/docs/0.10.0/topic/microtvm/>microTVM：裸机上的 TVM</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/tvm-cn/docs/0.10.0/topic/vta>VTA：多功能张量加速器</a><button aria-label="展开侧边栏分类 'VTA：多功能张量加速器'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></ul></nav></div></div></aside><main class=docMainContainer_ch7h><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol__o6A"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role=alert><div>此为 <!-- -->Apache TVM 中文站<!-- --> <b>0.10.0</b> 版的文档，现已不再积极维护。</div><div class=margin-top--md>最新的文档请参阅 <b><a href=/docs/tvm-cn/docs/arch/>最新版本</a></b> (<!-- -->0.13.0<!-- -->)。</div></div><div class=docItemContainer_Wtch><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_fS1C" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/docs/tvm-cn/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_jcRj><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>设计与架构</span><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>设计与架构</span><meta itemprop=position content=2></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.10.0</span><div class="tocCollapsible_hZNL theme-doc-toc-mobile tocMobile_UGcD"><button type=button class="clean-btn tocCollapsibleButton_z7oa">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>设计与架构</h1></header>
<p>本文档适用于想要了解 TVM 架构和/或积极开发项目的开发者。本文档组织结构如下：</p>
<ul>
<li><a href=#example-compilation-flow>编译流程示例</a> 概述了 TVM 将模型的高级描述转换为可部署模块所采取的步骤。</li>
<li><a href=#logical-architecture-components>逻辑架构组件</a> 部分描述了逻辑组件。后面的部分是针对每个逻辑组件的具体指南，按组件的名称编排。</li>
<li><a href=https://tvm.apache.org/docs/arch/device_target_interactions.html#tvm-target-specific-overview target=_blank rel="noopener noreferrer">设备/ Target 交互</a> 文档描述了 TVM 如何与所有受支持的物理设备，以及代码生成的 target 进行交互。</li>
<li>查看 <a href=/docs/tvm-cn/docs/dev/how_to>开发者操作指南</a> 获取实用开发技巧。</li>
</ul>
<p>本指南提供了架构的一些补充视图。首先研究端到端的编译流程，并讨论关键的数据结构和转换。这种基于 runtime 的视图侧重于运行编译器时每个组件的交互。接下来研究代码库的逻辑模块及其关系。这部分提供了设计的静态总体视图。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=编译流程示例>编译流程示例<a href=#编译流程示例 class=hash-link aria-label=编译流程示例的直接链接 title=编译流程示例的直接链接>​</a></h2>
<p>本指南研究编译器中的编译流程示例，下图显示了流程。在高层次，它包含以下步骤：</p>
<ul>
<li>导入：前端组件将模型引入到 IRModule 中，它包含了内部表示模型的函数集合。</li>
<li>转换：编译器将 IRModule 转换为功能与之等效或近似等效（例如在量化的情况下）的 IRModule。许多转换与 target（后端）无关，并且允许 target 配置转换 pipeline。</li>
<li>Target 转换：编译器将 IRModule 转换（codegen）为指定 target 的可执行格式。target 的转换结果被封装为 <em>runtime.Module</em>，可以在 runtime 环境中导出、加载和执行。</li>
<li>Runtime 执行：用户加载 <em>runtime.Module</em>，并在支持的 runtime 环境中运行编译好的函数。</li>
</ul>
<p><img decoding=async loading=lazy alt=/img/docs/tlc-pack/web-data/main/images/design/tvm_dyn_workflow.svg src=/docs/tvm-cn/assets/images/tvm_dyn_workflow-9a2f74a21483220724f86cebaff943b6.svg width=882 height=519 class=img_DHp8></p>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=关键数据结构>关键数据结构<a href=#关键数据结构 class=hash-link aria-label=关键数据结构的直接链接 title=关键数据结构的直接链接>​</a></h3>
<p>设计和理解复杂系统的最佳方法之一，就是识别关键数据结构和操作（转换）这些数据结构的 API。识别了关键数据结构后，就可以将系统分解为逻辑组件，这些逻辑组件定义了关键数据结构的集合，或是数据结构之间的转换。</p>
<p><strong>IRModule</strong> 是整个堆栈中使用的主要数据结构。一个 IRModule（intermediate representation module）包含一组函数。目前支持两种主要的功能变体（variant）：</p>
<ul>
<li><strong>relay::Function</strong> 是一种高级功能程序表示。一个 relay.Function 通常对应一个端到端的模型。可将 relay.Function 视为额外支持控制流、递归和复杂数据结构的计算图。</li>
<li><strong>tir::PrimFunc</strong> 是一种底层程序表示，包含循环嵌套选择、多维加载/存储、线程和向量/张量指令的元素。通常用于表示算子程序，这个程序在模型中执行一个（可融合的）层。 在编译期间，Relay 函数可降级为多个 tir::PrimFunc 函数和一个调用这些 tir::PrimFunc 函数的顶层函数。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=转换>转换<a href=#转换 class=hash-link aria-label=转换的直接链接 title=转换的直接链接>​</a></h3>
<p>前面介绍了关键数据结构，接下来讲转换。转换的目的有：</p>
<ul>
<li>优化：将程序转换为等效，甚至更优的版本。</li>
<li>降级：将程序转换为更接近 target 的较低级别表示。 <strong>relay/transform</strong> 包含一组优化模型的 pass。优化包括常见的程序优化（例如常量折叠和死码消除），以及特定于张量计算的 pass（例如布局转换和 scale 因子折叠）。</li>
</ul>
<p>在 Relay 优化流程的后期，运行 pass（FuseOps），将端到端函数（例如 MobileNet）分解为子功能（例如 conv2d-relu）段。这个过程帮助将原始问题分为两个子问题：</p>
<ul>
<li>所有子函数的编译和优化。</li>
<li>整体执行结构：对生成的子函数进行一系列调用，执行整个模型。 使用下层 tir 阶段来编译和优化每个子函数。对于特定的 targets，也可以直接进入 target 转换阶段，使用外部代码生成器。</li>
</ul>
<p>有几种不同的方法（在 relay/backend 目录）来处理对整体执行问题的调用。对于具有已知 shape 且没有控制流的简单模型，可以降级为图执行器，这个图执行器存储计算图中的执行结构。我们还支持用于动态执行的虚拟机后端。</p>
<p>最后，我们计划支持 ahead-of-time 编译，它将高级执行结构编译成可执行和生成的原始函数。所有这些执行模式都被统一的 <strong>runtime.Module</strong> 接口封装，指南的后半部分将进行讨论。</p>
<p><strong>tir/transform</strong> 包含 TIR 级函数的转换过程。许多 tir passes 的目的是降级。例如，有些 pass 将多维访问展平为一维指针访问，将内联函数扩展至特定于 target 的函数，以及将函数入口修饰为满足 runtime 调用约定。当然，也有一些 pass 的目的是为了优化，例如访问索引简化和死码消除。</p>
<p>LLVM、CUDA C 和其他 target 编译器都可以在 target 阶段处理许多底层优化。因此，我们将底层优化（如寄存器分配）留给下游编译器，只关注它们未涵盖的优化。</p>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=搜索空间和基于学习的转换>搜索空间和基于学习的转换<a href=#搜索空间和基于学习的转换 class=hash-link aria-label=搜索空间和基于学习的转换的直接链接 title=搜索空间和基于学习的转换的直接链接>​</a></h3>
<p>到目前为止，我们介绍的转换 pass 都是确定且遵循一定规则的。 TVM 堆栈的设计目标之一是支持不同硬件平台的高性能代码优化。因此要研究尽可能多的优化选择，包括但不限于多维张量访问、循环分块行为、特殊加速器内存层次结构和线程。</p>
<p>定义一个要做出所有选择的启发式方法很难。因此，我们采用搜索和基于学习的方法。</p>
<p>首先定义一组用来转换程序的操作。示例操作包括循环转换、内联、向量化，这些操作称为<strong>调度原语</strong>。调度原语的集合定义了可用于程序的优化的搜索空间。</p>
<p>接下来，系统搜索不同的可能调度序列，选择最佳调度组合。搜索过程通常由机器学习算法指导。</p>
<p>搜索完成后，可以记录（可能融合的）算子的最佳调度顺序。然后编译器可以查找最佳调度序列，并将其应用于程序。注意，这个调度应用阶段与基于规则的转换<strong>完全一样</strong>，能够与传统 pass 共享相同的接口。</p>
<p>使用基于搜索的优化来处理初始 tir 函数生成问题。模块的这部分称为 AutoTVM（auto_scheduler）。随着 TVM 堆栈开发的深入，基于学习的转换将扩展到更多领域。</p>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=target-转换>Target 转换<a href=#target-转换 class=hash-link aria-label="Target 转换的直接链接" title="Target 转换的直接链接">​</a></h3>
<p>target 转换阶段将 IRModule 转换为相应 target 的可执行格式。对于 x86 和 ARM 等后端，使用 LLVM IRBuilder 来构建内存中的 LLVM IR。还可以生成源代码级语言，例如 CUDA C 和 OpenCL。最后，支持通过外部代码生成器将 Relay 函数（子图）直接转换为特定 target 。</p>
<p>重要的是，最终代码生成阶段要尽可能轻量级。绝大多数的转换和降级要在 target 转换阶段之前进行。</p>
<p>我们还提供了一个 Target 结构来指定编译 target。target 转换阶段之前的转换也可能受到 target 的影响，例如，target 的向量长度会改变向量化行为。</p>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=runtime-执行>Runtime 执行<a href=#runtime-执行 class=hash-link aria-label="Runtime 执行的直接链接" title="Runtime 执行的直接链接">​</a></h3>
<p>TVM runtime 的主要目标是提供一个最小的 API，从而能以选择的语言（包括 Python、C++、Rust、Go、Java 和 JavaScript）加载和执行编译好的工件。以下代码片段展示了一个 Python 示例：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> tvm</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># Python 中 runtime 执行程序示例，带有类型注释</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mod</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Module </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">load_module</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"compiled_artifact.so"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">arr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">NDArray </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">nd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> device</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fun</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">PackedFunc </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> mod</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"addone"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fun</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">a</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>print</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">a</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">numpy</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>tvm.runtime.Module</code> 封装了编译的结果。runtime.Module 包含一个 GetFunction 方法，用于按名称获取 PackedFuncs。</p>
<p><code>tvm.runtime.PackedFunc</code> 是一种为各种构造函数消解类型的函数接口。runtime.PackedFunc 的参数和返回值的类型如下：POD 类型（int, float）、string、runtime.PackedFunc、runtime.Module、runtime.NDArray 和 runtime.Object 的其他子类。</p>
<p><code>tvm.runtime.Module</code> 和 <code>tvm.runtime.PackedFunc</code> 是模块化 runtime 的强大机制。例如，要在 CUDA 上获取上述 <em>addone</em> 函数，可以用 LLVM 生成主机端代码来计算启动参数（例如线程组的大小），然后用 CUDA 驱动程序 API 支持的 CUDAModule 调用另一个 PackedFunc。OpenCL 内核也有相同的机制。</p>
<p>以上示例只处理了一个简单的 <em>addone</em> 函数。下面的代码片段给出了用相同接口执行端到端模型的示例：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> tvm</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># python 中 runtime 执行程序的示例，带有类型注释</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">factory</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Module </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">load_module</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"resnet18.so"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 在 cuda(0) 上为 resnet18 创建一个有状态的图执行模块</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">gmod</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Module </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> factory</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"resnet18"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">data</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">runtime</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">NDArray </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> get_input_data</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 设置输入</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">gmod</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"set_input"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> data</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 执行模型</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">gmod</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"run"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 得到输出</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">result </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> gmod</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"get_output"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">numpy</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>主要的结论是 runtime.Module 和 runtime.PackedFunc 可以封装算子级别的程序（例如 addone），以及端到端模型。</p>
<h3 class="anchor anchorWithStickyNavbar_csPL" id=总结与讨论>总结与讨论<a href=#总结与讨论 class=hash-link aria-label=总结与讨论的直接链接 title=总结与讨论的直接链接>​</a></h3>
<p>综上所述，编译流程中的关键数据结构有：</p>
<ul>
<li>IRModule：包含 relay.Function 和 tir.PrimFunc</li>
<li>runtime.Module：包含 runtime.PackedFunc</li>
</ul>
<p>编译基本是在进行关键数据结构之间的转换。</p>
<ul>
<li>relay/transform 和 tir/transform 是确定性的基于规则的转换</li>
<li>auto_scheduler 和 autotvm 包含基于搜索的转换</li>
</ul>
<p>最后，编译流程示例只是 TVM 堆栈的一个典型用例。将这些关键数据结构和转换提供给 Python 和 C++ API。然后，就可以像使用 numpy 一样使用 TVM，只不过关注的数据结构从 numpy.ndarray 改为 tvm.IRModule。以下是一些用例的示例：</p>
<ul>
<li>用 Python API 直接构建 IRModule。</li>
<li>编写一组自定义转换（例如自定义量化）。</li>
<li>用 TVM 的 Python API 直接操作 IR。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=逻辑架构组件>逻辑架构组件<a href=#逻辑架构组件 class=hash-link aria-label=逻辑架构组件的直接链接 title=逻辑架构组件的直接链接>​</a></h2>
<p><img decoding=async loading=lazy alt=/img/docs/tlc-pack/web-data/main/images/design/tvm_static_overview.svg src=/docs/tvm-cn/assets/images/tvm_static_overview-c9f3ed0d76b1814a35c26ffd2dbb7bce.svg width=764 height=344 class=img_DHp8></p>
<p><em>TVM Architecture Diagram</em><a href=#logical-architecture-components>¶</a></p>
<p>上图展示了项目中的主要逻辑组件。阅读以下部分，获取更多有关组件及其关系的信息。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmsupport>tvm/support<a href=#tvmsupport class=hash-link aria-label=tvm/support的直接链接 title=tvm/support的直接链接>​</a></h2>
<p>support 模块包含基础架构最常用的程序，例如通用 arena 分配器（arena allocator）、套接字（socket）和日志（logging）。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmruntime>tvm/runtime<a href=#tvmruntime class=hash-link aria-label=tvm/runtime的直接链接 title=tvm/runtime的直接链接>​</a></h2>
<p>runtime 是 TVM 堆栈的基础，它提供了加载和执行已编译工件的机制。runtime 定义了一组稳定的标准 C API，与 Python 和 Rust 等前端语言交互。</p>
<p>在 TVM runtime 中，<em>runtime::Object</em> 是除 <em>runtime::PackedFunc</em> 之外的主要数据结构之一。它是一个具有类型索引的引用计数基类，这个类型索引用来支持 runtime 类型检查和向下转换。</p>
<p>对象系统允许开发者向 runtime 引入新的数据结构，例如 Array、Map 和新的 IR 数据结构。</p>
<p>除了部署用例，编译器本身也大量使用 TVM 的 runtime 机制。所有 IR 数据结构都是 <em>runtime::Object</em> 的子类，因此可以从 Python 前端直接访问和操作它们。我们使用 PackedFunc 机制向前端公开各种 API。</p>
<p>runtime 子目录（例如 runtime/opencl）定义了 runtime 对不同硬件后端的支持。这些特定于硬件的 runtime 模块，为设备内存分配和设备功能序列化定义了 API。</p>
<p><em>runtime/rpc</em> 实现了对 PackedFunc 的 RPC 支持，可以用 RPC 机制将交叉编译的库发送到远程设备，并对执行性能进行 benchmark 测试。rpc 基础架构支持从各种硬件后端收集数据，进行基于学习的优化。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/runtimes>TVM Runtime 系统</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/runtimes#runtime-specific-information>特定 Runtime 信息</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/debugger>调试器</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/virtual_machine>向 TVM 中添加虚拟机：Relay 虚拟机</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/introduction_to_module_serialization>模块序列化简介</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/device_target_interactions>设备/Target 交互</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmnode>tvm/node<a href=#tvmnode class=hash-link aria-label=tvm/node的直接链接 title=tvm/node的直接链接>​</a></h2>
<p>节点模块在 <em>runtime::Object</em> 之上，为 IR 数据结构添加了额外的功能。主要特征包括反射、序列化、结构等效和散列。</p>
<p>node 模块使得可以通过 Python 中的名称，直接访问 TVM IRNode 的任何字段。</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token plain">x </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">tir</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Var</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"x"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"int32"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">y </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">tir</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">x</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> x</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># a 和 b 是 tir.Add 节点的字段</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 可以直接使用字段名来访问 IR 结构</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>assert</span><span class="token plain"> y</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">a </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> x</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>还可以将任意 IR 节点序列化为 JSON 格式，然后将它们加载回来。保存/存储和检查 IR 节点的能力，为更容易访问编译器提供了基础。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmir>tvm/ir<a href=#tvmir class=hash-link aria-label=tvm/ir的直接链接 title=tvm/ir的直接链接>​</a></h2>
<p><em>tvm/ir</em> 文件夹包含了所有 IR 函数变体的统一数据结构和接口。 <em>tvm/ir</em> 中的组件由 <em>tvm/relay</em> 和 <em>tvm/tir</em> 共享，主要包括</p>
<ul>
<li>IRModule</li>
<li>Type</li>
<li>PassContext and Pass</li>
<li>Op</li>
</ul>
<p>不同的函数变体（例如，relay.Function 和 tir.PrimFunc）可以在一个 IRModule 中共存。虽然这些变体的内容表示可能不同，但它们使用相同的数据结构来表示类型。</p>
<p>因此，可以用相同的数据结构来表示这些变体的函数（类型）签名。一旦明确定义了调用约定，统一的类型系统就可以用一个函数变体调用另一个函数。这为未来的跨函数变体的优化奠定了基础。</p>
<p>我们还提供了一个统一的 PassContext，用于配置 pass 行为，以及通用的复合 pass 来执行 pass pipeline。以下代码片段给出了 PassContext 配置的示例：</p>
<div class="language-python codeBlockContainer_MndA theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_WK21><pre tabindex=0 class="prism-code language-python codeBlock_Eu_S thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_OAXn><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 配置 tir.UnrollLoop pass 的行为</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>with</span><span class="token plain"> tvm</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transform</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">PassContext</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">config</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"tir.UnrollLoop"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"auto_max_step"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 受 pass 上下文影响的代码</span><br></span></code></pre><div class=buttonGroup_zuHS><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_x9oo aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_K8Fc><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_AKIi><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Op 是表示所有系统定义的原始算子/内联函数的通用类。开发者可以向系统注册新的 Ops，以及它们的额外属性（例如 Op 是否为元素）。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/pass_infra>Pass Infrastructure</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmtarget>tvm/target<a href=#tvmtarget class=hash-link aria-label=tvm/target的直接链接 title=tvm/target的直接链接>​</a></h2>
<p>target 模块包含将 IRModule 转换为 target runtime.Module 的所有代码生成器。它还提供了一个描述 target 的通用 Target 类。</p>
<p>通过查询 target 中的属性信息和注册到每个 target id（cuda、opencl）的内置信息，可以根据 target 定制编译 pipeline。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/device_target_interactions>设备/Target 交互</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmtir>tvm/tir<a href=#tvmtir class=hash-link aria-label=tvm/tir的直接链接 title=tvm/tir的直接链接>​</a></h2>
<p>TIR 包含低级程序表示的定义。用 <em>tir::PrimFunc</em> 来表示可通过 TIR pass 转换的函数。除了 IR 数据结构外，tir 模块还通过通用 Op 注册表，定义了一组内置内联函数及其属性，以及 <em>tir/transform</em> 中的转换 pass。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmarith>tvm/arith<a href=#tvmarith class=hash-link aria-label=tvm/arith的直接链接 title=tvm/arith的直接链接>​</a></h2>
<p>该模块与 TIR 密切相关，低级代码生成的关键问题之一是分析索引的算术属性（arithmetic properties）——正性（positiveness）、变量界限和描述迭代器空间的整数集。arith 模块提供了一组进行（主要是整数）分析的工具。TIR pass 可以用这些分析来简化和优化代码。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmte>tvm/te<a href=#tvmte class=hash-link aria-label=tvm/te的直接链接 title=tvm/te的直接链接>​</a></h2>
<p>te（tensor expression）代表「张量表达式」，这是一个特定领域的语言模块，它允许通过编写张量表达式来快速构造 <em>tir::PrimFunc</em> 变体（variant）。</p>
<p>重要的是，张量表达式本身并不是一个可以存储到 IRModule 中的自包含函数（self-contained function）。相反，它是 IR 的一个片段，可以拼接起来构建一个 IRModule。</p>
<p><em>te/schedule</em> 提供了一组调度原语，来控制正在生成的函数。未来，可能会将其中一些调度组件引入到 <em>tir::PrimFunc</em> 本身。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/inferbound>InferBound Pass</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/hybrid_script>混合前端开发者指南</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmtopi>tvm/topi<a href=#tvmtopi class=hash-link aria-label=tvm/topi的直接链接 title=tvm/topi的直接链接>​</a></h2>
<p>虽然可以通过 TIR 或张量表达式（TE）为每个用例直接构造算子，但这样做很乏味。 <em>topi</em>（张量算子清单）提供了一组 numpy 定义的预定义算子（在 TE 或 TIR 中），并可在常见的深度学习任务中找到。还提供了一组常见的调度模板，来获得跨不同 target 平台的性能实现。</p>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmrelay>tvm/relay<a href=#tvmrelay class=hash-link aria-label=tvm/relay的直接链接 title=tvm/relay的直接链接>​</a></h2>
<p>Relay 是用于表示完整模型的高级功能 IR。<em>relay.transform</em> 中定义了各种优化。 Relay 编译器定义了多种方言，每种方言都旨在支持特定的优化风格。主要包括 QNN（用于导入预量化模型）、VM（用于降级到动态虚拟机）、内存（用于内存优化）。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/relay_intro>Relay IR 简介</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/relay_op_strategy>Relay 算子策略</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/convert_layout>转换布局 Pass</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=tvmautotvm>tvm/autotvm<a href=#tvmautotvm class=hash-link aria-label=tvm/autotvm的直接链接 title=tvm/autotvm的直接链接>​</a></h2>
<p>AutoTVM 和 AutoScheduler 都是基于程序优化的自动搜索组件。它们在迅速发展中，主要包括：</p>
<ul>
<li>cost 模型和特征提取。</li>
<li>存储 cost 模型构建的程序 benchmark 结果的记录格式。</li>
<li>一组程序转换的搜索策略。</li>
</ul>
<p>自动化程序优化仍是热点研究领域。因此，我们采用了模块化的设计思路，以便研究人员通过 Python binding 来快速修改组件或应用自己的算法，也可以自定义搜索，以及从 Python binding 插入自己的算法。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/benchmark>benchmark 性能日志格式</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=前端>前端<a href=#前端 class=hash-link aria-label=前端的直接链接 title=前端的直接链接>​</a></h2>
<p>前端将来自不同框架的模型引入到 TVM 堆栈中。<code>tvm.relay.frontend</code> 是模型引入 API 的命名空间。</p>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/tensorflow>TensorFlow 前端</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=安全>安全<a href=#安全 class=hash-link aria-label=安全的直接链接 title=安全的直接链接>​</a></h2>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/security>安全指南</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_csPL" id=microtvm>microTVM<a href=#microtvm class=hash-link aria-label=microTVM的直接链接 title=microTVM的直接链接>​</a></h2>
<ul>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/microtvm_design>microTVM 设计文档</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/microtvm_project_api>microTVM 项目 API</a></li>
<li><a href=/docs/tvm-cn/docs/0.10.0/arch/arch/model_library_format>模型库格式</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/hyperai/tvm-cn/edit/master/versioned_docs/version-0.10.0/arch/index.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_OUzX aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_ccpN"><span class=theme-last-updated>最后<!-- -->由 <b>sparanoid</b> <!-- -->于 <b><time datetime=2025-04-15T11:50:10.000Z itemprop=dateModified>2025年4月15日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/tvm-cn/docs/0.10.0/dev/how_to/python_target_parametrization><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>Python Target 参数化</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/tvm-cn/docs/0.10.0/arch/arch/runtimes/><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>TVM Runtime 系统</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cD69 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#编译流程示例 class="table-of-contents__link toc-highlight">编译流程示例</a><ul><li><a href=#关键数据结构 class="table-of-contents__link toc-highlight">关键数据结构</a><li><a href=#转换 class="table-of-contents__link toc-highlight">转换</a><li><a href=#搜索空间和基于学习的转换 class="table-of-contents__link toc-highlight">搜索空间和基于学习的转换</a><li><a href=#target-转换 class="table-of-contents__link toc-highlight">Target 转换</a><li><a href=#runtime-执行 class="table-of-contents__link toc-highlight">Runtime 执行</a><li><a href=#总结与讨论 class="table-of-contents__link toc-highlight">总结与讨论</a></ul><li><a href=#逻辑架构组件 class="table-of-contents__link toc-highlight">逻辑架构组件</a><li><a href=#tvmsupport class="table-of-contents__link toc-highlight">tvm/support</a><li><a href=#tvmruntime class="table-of-contents__link toc-highlight">tvm/runtime</a><li><a href=#tvmnode class="table-of-contents__link toc-highlight">tvm/node</a><li><a href=#tvmir class="table-of-contents__link toc-highlight">tvm/ir</a><li><a href=#tvmtarget class="table-of-contents__link toc-highlight">tvm/target</a><li><a href=#tvmtir class="table-of-contents__link toc-highlight">tvm/tir</a><li><a href=#tvmarith class="table-of-contents__link toc-highlight">tvm/arith</a><li><a href=#tvmte class="table-of-contents__link toc-highlight">tvm/te</a><li><a href=#tvmtopi class="table-of-contents__link toc-highlight">tvm/topi</a><li><a href=#tvmrelay class="table-of-contents__link toc-highlight">tvm/relay</a><li><a href=#tvmautotvm class="table-of-contents__link toc-highlight">tvm/autotvm</a><li><a href=#前端 class="table-of-contents__link toc-highlight">前端</a><li><a href=#安全 class="table-of-contents__link toc-highlight">安全</a><li><a href=#microtvm class="table-of-contents__link toc-highlight">microTVM</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>© 2025 Apache Software Foundation and Hyper.AI for Chinese Simplified mirror</div></div></div></footer></div>