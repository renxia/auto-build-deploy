"use strict";(self.webpackChunktvm_cn=self.webpackChunktvm_cn||[]).push([["35240"],{30700:function(e,n,t){t.r(n),t.d(n,{default:()=>p,frontMatter:()=>d,metadata:()=>r,assets:()=>i,toc:()=>l,contentTitle:()=>s});var r=JSON.parse('{"id":"how_to/deploy/deploy_models/deploy_android","title":"\u5728 Android \u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B","description":"\u5355\u51FB \u6B64\u5904 \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801","source":"@site/versioned_docs/version-0.10.0/how_to/deploy/deploy_models/01-deploy_android.md","sourceDirName":"how_to/deploy/deploy_models","slug":"/how_to/deploy/deploy_models/deploy_android","permalink":"/docs/tvm-cn/docs/0.10.0/how_to/deploy/deploy_models/deploy_android","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperai/tvm-cn/edit/master/versioned_docs/version-0.10.0/how_to/deploy/deploy_models/01-deploy_android.md","tags":[],"version":"0.10.0","lastUpdatedBy":"sparanoid","lastUpdatedAt":1744717810000,"sidebarPosition":1,"frontMatter":{"title":"\u5728 Android \u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B"},"sidebar":"tutorialSidebar","previous":{"title":"\u90E8\u7F72\u6DF1\u5EA6\u5B66\u4E60\u6A21\u578B","permalink":"/docs/tvm-cn/docs/0.10.0/how_to/deploy/deploy_models/"},"next":{"title":"\u5728 Jetson Nano \u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B","permalink":"/docs/tvm-cn/docs/0.10.0/how_to/deploy/deploy_models/deploy_nano"}}'),a=t("74132"),o=t("21494");let d={title:"\u5728 Android \u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B"},s="\u5728 Android \u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B",i={},l=[{value:"\u8BBE\u7F6E\u73AF\u5883",id:"\u8BBE\u7F6E\u73AF\u5883",level:2},{value:"\u542F\u52A8 RPC \u8DDF\u8E2A\u5668",id:"\u542F\u52A8-rpc-\u8DDF\u8E2A\u5668",level:2},{value:"\u5C06 Android \u8BBE\u5907\u6CE8\u518C\u5230 RPC \u8DDF\u8E2A\u5668",id:"\u5C06-android-\u8BBE\u5907\u6CE8\u518C\u5230-rpc-\u8DDF\u8E2A\u5668",level:2},{value:"\u52A0\u8F7D\u9884\u8BAD\u7EC3\u7684 Keras \u6A21\u578B",id:"\u52A0\u8F7D\u9884\u8BAD\u7EC3\u7684-keras-\u6A21\u578B",level:2},{value:"\u7528 Relay \u7F16\u8BD1\u6A21\u578B",id:"\u7528-relay-\u7F16\u8BD1\u6A21\u578B",level:2},{value:"\u901A\u8FC7 RPC \u8FDC\u7A0B\u90E8\u7F72\u6A21\u578B",id:"\u901A\u8FC7-rpc-\u8FDC\u7A0B\u90E8\u7F72\u6A21\u578B",level:2},{value:"\u5728 TVM \u4E0A\u6267\u884C",id:"\u5728-tvm-\u4E0A\u6267\u884C",level:2},{value:"\u6837\u672C\u8F93\u51FA",id:"\u6837\u672C\u8F93\u51FA",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\u5728-android-\u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B",children:"\u5728 Android \u4E0A\u90E8\u7F72\u9884\u8BAD\u7EC3\u6A21\u578B"})}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["\u5355\u51FB ",(0,a.jsx)(n.a,{href:"https://tvm.apache.org/docs/how_to/deploy_models/deploy_model_on_android.html#sphx-glr-download-how-to-deploy-models-deploy-model-on-android-py",children:"\u6B64\u5904"})," \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801"]})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u4F5C\u8005"}),"\uFF1A",(0,a.jsx)(n.a,{href:"https://tkat0.github.io/",children:"Tomohiro Kato"})]}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u9762\u662F\u7528 Relay \u7F16\u8BD1 Keras \u6A21\u578B\uFF0C\u5E76\u5C06\u5176\u90E8\u7F72\u5230 Android \u8BBE\u5907\u4E0A\u7684\u793A\u4F8B\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import os\nimport numpy as np\nfrom PIL import Image\nimport keras\nfrom keras.applications.mobilenet_v2 import MobileNetV2\nimport tvm\nfrom tvm import te\nimport tvm.relay as relay\nfrom tvm import rpc\nfrom tvm.contrib import utils, ndk, graph_executor as runtime\nfrom tvm.contrib.download import download_testdata\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u8BBE\u7F6E\u73AF\u5883",children:"\u8BBE\u7F6E\u73AF\u5883"}),"\n",(0,a.jsx)(n.p,{children:"\u7531\u4E8E Android \u9700\u8981\u7684\u5305\u6BD4\u8F83\u591A\uFF0C\u63A8\u8350\u4F7F\u7528\u5B98\u65B9\u7684 Docker \u955C\u50CF\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u9996\u5148\uFF0C\u6267\u884C\u4E0B\u9762\u7684\u547D\u4EE4\u6765\u6784\u5EFA\u548C\u8FD0\u884C Docker \u955C\u50CF\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"git clone --recursive https://github.com/apache/tvm tvm\ncd tvm\ndocker build -t tvm.demo_android -f docker/Dockerfile.demo_android ./docker\ndocker run --pid=host -h tvm -v $PWD:/workspace \\\n       -w /workspace -p 9190:9190 --name tvm -it tvm.demo_android bash\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u5BB9\u5668\u4E2D\uFF0C\u514B\u9686\u7684 TVM \u76EE\u5F55\u6302\u8F7D\u5230 /workspace\u3002\u6B64\u65F6\uFF0C\u6302\u8F7D RPC \u8981\u7528\u7684 9190 \u7AEF\u53E3\u5C06\u5728\u540E\u9762\u8BA8\u8BBA\u3002"}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["\u8BF7\u5728\u5BB9\u5668\u4E2D\u6267\u884C\u4EE5\u4E0B\u6B65\u9AA4\u3002\u6267\u884C ",(0,a.jsx)(n.code,{children:"docker exec -it tvm bash"})," \u5728\u5BB9\u5668\u4E2D\u6253\u5F00\u4E00\u4E2A\u65B0\u7684\u7EC8\u7AEF\u3002"]})}),"\n",(0,a.jsx)(n.p,{children:"\u63A5\u4E0B\u6765\u6784\u5EFA TVM\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir build\ncd build\ncmake -DUSE_LLVM=llvm-config-8 \\\n      -DUSE_RPC=ON \\\n      -DUSE_SORT=ON \\\n      -DUSE_VULKAN=ON \\\n      -DUSE_GRAPH_EXECUTOR=ON \\\n      ..\nmake -j10\n"})}),"\n",(0,a.jsx)(n.p,{children:"TVM \u6784\u5EFA\u6210\u529F\u540E\uFF0C\u8BBE\u7F6E PYTHONPATH\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"echo 'export PYTHONPATH=/workspace/python:/workspace/vta/python:${PYTHONPATH}' >> ~/.bashrc\nsource ~/.bashrc\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u542F\u52A8-rpc-\u8DDF\u8E2A\u5668",children:"\u542F\u52A8 RPC \u8DDF\u8E2A\u5668"}),"\n",(0,a.jsx)(n.p,{children:"TVM \u7528 RPC session \u4E0E Android \u8BBE\u5907\u8FDB\u884C\u901A\u4FE1\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u5BB9\u5668\u4E2D\u8FD0\u884C\u8FD9\u4E2A\u547D\u4EE4\u6765\u542F\u52A8 RPC \u8DDF\u8E2A\u5668\u3002\u56E0\u4E3A\u6574\u4E2A\u8C03\u4F18\u8FC7\u7A0B\u90FD\u9700\u8981\u8DDF\u8E2A\u5668\uFF0C\u56E0\u6B64\u9700\u8981\u4E3A\u8FD9\u4E2A\u547D\u4EE4\u6253\u5F00\u4E00\u4E2A\u65B0\u7EC8\u7AEF\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"python3 -m tvm.exec.rpc_tracker --host=0.0.0.0 --port=9190\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u9884\u671F\u8F93\u51FA\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"INFO:RPCTracker:bind to 0.0.0.0:9190\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u5C06-android-\u8BBE\u5907\u6CE8\u518C\u5230-rpc-\u8DDF\u8E2A\u5668",children:"\u5C06 Android \u8BBE\u5907\u6CE8\u518C\u5230 RPC \u8DDF\u8E2A\u5668"}),"\n",(0,a.jsxs)(n.p,{children:["\u6309\u7167 ",(0,a.jsx)(n.a,{href:"https://github.com/apache/tvm/tree/main/apps/android_rpc",children:"readme page"})," \u5728 Android \u8BBE\u5907\u4E0A\u5B89\u88C5 TVM RPC APK\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u9762\u662F config.mk \u7684\u793A\u4F8B\uFF08\u542F\u7528\u4E86 OpenCL \u548C Vulkan\uFF09\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cmake",children:"APP_ABI = arm64-v8a\n\nAPP_PLATFORM = android-24\n\n# \u7F16\u8BD1\u65F6\u662F\u5426\u542F\u52A8 OpenCL\nUSE_OPENCL = 1\n\n# \u7F16\u8BD1\u65F6\u662F\u5426\u542F\u7528 Vulkan\nUSE_VULKAN = 1\n\nifeq ($(USE_VULKAN), 1)\n  # \u9759\u6001\u94FE\u63A5 vulkan \u9700\u8981 API \u7EA7\u522B 24 \u6216\u66F4\u9AD8\n  APP_PLATFORM = android-24\nendif\n\n# \u8981\u6DFB\u52A0\u7684\u5176\u4ED6 include \u5934\uFF0C\u4F8B\u5982 SDK_PATH/adrenosdk/Development/Inc\nADD_C_INCLUDES += /work/adrenosdk-linux-5_0/Development/Inc\n# \u4ECE https://github.com/KhronosGroup/OpenCL-Headers \u4E0B\u8F7D\nADD_C_INCLUDES += /usr/local/OpenCL-Headers/\n\n# \u8981\u6DFB\u52A0\u7684\u9644\u52A0\u94FE\u63A5\u5E93\uFF0C\u4F8B\u5982 ANDROID_LIB_PATH/libOpenCL.so\nADD_LDLIBS = /workspace/pull-from-android-device/libOpenCL.so\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsxs)(n.p,{children:["\u4E0D\u8981\u5FD8\u8BB0 ",(0,a.jsx)(n.a,{href:"https://github.com/apache/tvm/tree/main/apps/android_rpc#architecture-and-android-standalone-toolchain",children:"\u521B\u5EFA\u72EC\u7ACB\u7684\u5DE5\u5177\u94FE"}),"\u3002\u4F8B\u5982\uFF1A"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ANDROID_NDK_HOME/build/tools/make-standalone-toolchain.sh \\\n   --platform=android-24 --use-llvm --arch=arm64 --install-dir=/opt/android-toolchain-arm64\nexport TVM_NDK_CC=/opt/android-toolchain-arm64/bin/aarch64-linux-android-g++\n"})})]}),"\n",(0,a.jsx)(n.p,{children:"\u63A5\u4E0B\u6765\uFF0C\u542F\u52A8 Android \u5E94\u7528\u7A0B\u5E8F\uFF0C\u8F93\u5165 RPC \u8DDF\u8E2A\u5668\u7684 IP \u5730\u5740\u548C\u7AEF\u53E3\u6765\u6CE8\u518C\u4F60\u7684\u8BBE\u5907\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u8BBE\u5907\u6CE8\u518C\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u67E5\u8BE2 rpc_tracker \u6765\u786E\u8BA4\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"python3 -m tvm.exec.query_rpc_tracker --host=0.0.0.0 --port=9190\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4F8B\u5982\uFF0C\u5982\u679C\u6709 1 \u53F0 Android \u8BBE\u5907\uFF0C\u8F93\u51FA\u4E3A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Queue Status\n----------------------------------\nkey          total  free  pending\n----------------------------------\nandroid      1      1     0\n----------------------------------\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u8FD0\u884C\u4E0B\u9762\u7684\u6D4B\u8BD5\u811A\u672C\uFF0C\u786E\u8BA4\u662F\u5426\u53EF\u4EE5\u4E0E Android \u901A\u4FE1\uFF0C\u5982\u679C\u4F7F\u7528 OpenCL \u548C Vulkan\uFF0C\u8981\u5728\u811A\u672C\u4E2D\u8BBE\u7F6E ",(0,a.jsx)(n.code,{children:"test_opencl"})," \u548C ",(0,a.jsx)(n.code,{children:"test_vulkan"}),"\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export TVM_TRACKER_HOST=0.0.0.0\nexport TVM_TRACKER_PORT=9190\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cd /workspace/apps/android_rpc\npython3 tests/android_rpc_test.py\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u52A0\u8F7D\u9884\u8BAD\u7EC3\u7684-keras-\u6A21\u578B",children:"\u52A0\u8F7D\u9884\u8BAD\u7EC3\u7684 Keras \u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u52A0\u8F7D Keras \u63D0\u4F9B\u7684\u9884\u8BAD\u7EC3 MobileNetV2\uFF08alpha=0.5\uFF09\u5206\u7C7B\u6A21\u578B\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'keras.backend.clear_session()  # \u9500\u6BC1\u5F53\u524D\u7684 TF \u8BA1\u7B97\u56FE\uFF0C\u5E76\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u3002\nweights_url = "".join(\n    [\n        "https://github.com/JonathanCMitchell/",\n        "mobilenet_v2_keras/releases/download/v1.1/",\n        "mobilenet_v2_weights_tf_dim_ordering_tf_kernels_0.5_224.h5",\n    ]\n)\nweights_file = "mobilenet_v2_weights.h5"\nweights_path = download_testdata(weights_url, weights_file, module="keras")\nkeras_mobilenet_v2 = MobileNetV2(\n    alpha=0.5, include_top=True, weights=None, input_shape=(224, 224, 3), classes=1000\n)\nkeras_mobilenet_v2.load_weights(weights_path)\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u4E3A\u4E86\u6D4B\u8BD5\u6A21\u578B\uFF0C\u4E0B\u8F7D\u4E00\u5F20\u732B\u7684\u56FE\u7247\uFF0C\u5E76\u8F6C\u6362\u5176\u683C\u5F0F\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'img_url = "https://github.com/dmlc/mxnet.js/blob/main/data/cat.png?raw=true"\nimg_name = "cat.png"\nimg_path = download_testdata(img_url, img_name, module="data")\nimage = Image.open(img_path).resize((224, 224))\ndtype = "float32"\n\ndef transform_image(image):\n    image = np.array(image) - np.array([123.0, 117.0, 104.0])\n    image /= np.array([58.395, 57.12, 57.375])\n    image = image.transpose((2, 0, 1))\n    image = image[np.newaxis, :]\n    return image\n\nx = transform_image(image)\n'})}),"\n",(0,a.jsx)(n.p,{children:"synset \u7528\u4E8E\u5C06 ImageNet \u7C7B\u7684\u6807\u7B7E\uFF0C\u8F6C\u6362\u4E3A\u4EBA\u7C7B\u66F4\u5BB9\u6613\u7406\u89E3\u7684\u5355\u8BCD\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'synset_url = "".join(\n    [\n        "https://gist.githubusercontent.com/zhreshold/",\n        "4d0b62f3d01426887599d4f7ede23ee5/raw/",\n        "596b27d23537e5a1b5751d2b0481ef172f58b539/",\n        "imagenet1000_clsid_to_human.txt",\n    ]\n)\nsynset_name = "imagenet1000_clsid_to_human.txt"\nsynset_path = download_testdata(synset_url, synset_name, module="data")\nwith open(synset_path) as f:\n    synset = eval(f.read())\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u7528-relay-\u7F16\u8BD1\u6A21\u578B",children:"\u7528 Relay \u7F16\u8BD1\u6A21\u578B"}),"\n",(0,a.jsxs)(n.p,{children:["\u5982\u679C\u5728 x86 \u670D\u52A1\u5668\u4E0A\u8FD0\u884C\u793A\u4F8B\uFF0C\u53EF\u5C06\u5176\u8BBE\u7F6E\u4E3A ",(0,a.jsx)(n.code,{children:"llvm"}),"\u3002\u5982\u679C\u5728\u6811\u8393\u6D3E\u4E0A\u8FD0\u884C\uFF0C\u9700\u8981\u6307\u5B9A\u5B83\u7684\u6307\u4EE4\u96C6\u3002\u82E5\u8981\u5728\u771F\u5B9E\u8BBE\u5907\u4E0A\u8FD0\u884C\uFF0C\u9700\u5C06 ",(0,a.jsx)(n.code,{children:"local_demo"})," \u8BBE\u7F6E\u4E3A False\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'local_demo = True\n\n# \u9ED8\u8BA4\u4F1A\u5728 CPU target \u4E0A\u6267\u884C\n# \u53EF\u9009\u503C\uFF1A\'cpu\'\uFF0C\'opencl\' \u548C \'vulkan\'\ntest_target = "cpu"\n\n# \u6539\u53D8 target \u914D\u7F6E\u3002\n# \u8FD0\u884C `adb shell cat /proc/cpuinfo` \u547D\u4EE4\u67E5\u770B arch \u7684\u503C\u3002\narch = "arm64"\ntarget = tvm.target.Target("llvm -mtriple=%s-linux-android" % arch)\n\nif local_demo:\n\xa0 \xa0 target = tvm.target.Target("llvm")\nelif test_target == "opencl":\n\xa0 \xa0 target = tvm.target.Target("opencl", host=target)\nelif test_target == "vulkan":\n\xa0 \xa0 target = tvm.target.Target("vulkan", host=target)\n\ninput_name = "input_1"\nshape_dict = {input_name: x.shape}\nmod, params = relay.frontend.from_keras(keras_mobilenet_v2, shape_dict)\n\nwith tvm.transform.PassContext(opt_level=3):\n\xa0 \xa0 lib = relay.build(mod, target=target, params=params)\n\n# \u5728 `relay.build` \u4E4B\u540E\uFF0C\u4F1A\u5F97\u5230\u4E09\u4E2A\u8FD4\u56DE\u503C\uFF1A\u8BA1\u7B97\u56FE\uFF0C\u5E93\u548C\u65B0\u53C2\u6570\uFF0C\u56E0\u4E3A\u6211\u4EEC\u505A\u4E86\u4E00\u4E9B\u4F18\u5316\uFF0C\u5B83\u4EEC\u4F1A\u6539\u53D8\u53C2\u6570\uFF0C\u4F46\u6A21\u578B\u7684\u7ED3\u679C\u4E0D\u53D8\u3002\n# \u5C06\u5E93\u4FDD\u5B58\u5728\u672C\u5730\u4E34\u65F6\u76EE\u5F55\u4E2D\u3002\ntmp = utils.tempdir()\nlib_fname = tmp.relpath("net.so")\nfcompile = ndk.create_shared if not local_demo else None\nlib.export_library(lib_fname, fcompile)\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'/workspace/python/tvm/driver/build_module.py:268: UserWarning: target_host parameter is going to be deprecated. Please pass in tvm.target.Target(target, host=target_host) instead.\n  "target_host parameter is going to be deprecated. "\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u901A\u8FC7-rpc-\u8FDC\u7A0B\u90E8\u7F72\u6A21\u578B",children:"\u901A\u8FC7 RPC \u8FDC\u7A0B\u90E8\u7F72\u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u5229\u7528 RPC \u53EF\u5C06\u6A21\u578B\u4ECE\u4E3B\u673A\u90E8\u7F72\u5230\u8FDC\u7A0B Android \u8BBE\u5907\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'tracker_host = os.environ.get("TVM_TRACKER_HOST", "127.0.0.1")\ntracker_port = int(os.environ.get("TVM_TRACKER_PORT", 9190))\nkey = "android"\n\nif local_demo:\n    remote = rpc.LocalSession()\nelse:\n    tracker = rpc.connect_tracker(tracker_host, tracker_port)\n    # \u8FD0\u884C\u91CD\u578B\u6A21\u578B\u65F6\uFF0C\u8981\u6DFB\u52A0 `session_timeout`\n    remote = tracker.request(key, priority=0, session_timeout=60)\n\nif local_demo:\n    dev = remote.cpu(0)\nelif test_target == "opencl":\n    dev = remote.cl(0)\nelif test_target == "vulkan":\n    dev = remote.vulkan(0)\nelse:\n    dev = remote.cpu(0)\n\n# \u5C06\u5E93\u4E0A\u4F20\u5230\u8FDC\u7A0B\u8BBE\u5907\uFF0C\u5E76\u52A0\u8F7D\nremote.upload(lib_fname)\nrlib = remote.load_module("net.so")\n\n# \u521B\u5EFA\u8FDC\u7A0B runtime \u6A21\u5757\nmodule = runtime.GraphModule(rlib["default"](dev))\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5728-tvm-\u4E0A\u6267\u884C",children:"\u5728 TVM \u4E0A\u6267\u884C"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# \u8BBE\u7F6E\u8F93\u5165\u6570\u636E\nmodule.set_input(input_name, tvm.nd.array(x.astype(dtype)))\n# \u8FD0\u884C\nmodule.run()\n# \u5F97\u5230\u8F93\u51FA\u7ED3\u679C\nout = module.get_output(0)\n\n# \u5F97\u5230\u5206\u6570\u6700\u9AD8\u7684\u7B2C\u4E00\u4E2A\u7ED3\u679C\ntop1 = np.argmax(out.numpy())\nprint("TVM prediction top-1: {}".format(synset[top1]))\n\nprint("Evaluate inference time cost...")\nprint(module.benchmark(dev, number=1, repeat=10))\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"TVM prediction top-1: tiger cat\nEvaluate inference time cost...\nExecution time summary:\n mean (ms)   median (ms)    max (ms)     min (ms)     std (ms)\n  15.5571      15.5695      15.7189      15.3987       0.0868\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6837\u672C\u8F93\u51FA",children:"\u6837\u672C\u8F93\u51FA"}),"\n",(0,a.jsx)(n.p,{children:"\u4EE5\u4E0B\u662F\u5728\u9A81\u9F99 820 \u4E0A\u4F7F\u7528 Adreno 530 \u7684 \u2018cpu\u2019\u3001\u2018opencl\u2019 \u548C \u2018vulkan\u2019 \u7684\u7ED3\u679C\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u5728 GPU \u4E0A\u8FD0\u884C\u6BD4 CPU \u6162\u3002\u4E3A\u4E86\u52A0\u5FEB\u901F\u5EA6\uFF0C\u9700\u8981\u6839\u636E GPU \u67B6\u6784\u7F16\u5199\u548C\u4F18\u5316 schedule\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# cpu\nTVM prediction top-1: tiger cat\nEvaluate inference time cost...\nMean inference time (std dev): 37.92 ms (19.67 ms)\n\n# opencl\nTVM prediction top-1: tiger cat\nEvaluate inference time cost...\nMean inference time (std dev): 419.83 ms (7.49 ms)\n\n# vulkan\nTVM prediction top-1: tiger cat\nEvaluate inference time cost...\nMean inference time (std dev): 465.80 ms (4.52 ms)\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://tvm.apache.org/docs/_downloads/21a9dd883b196be58ca1c5cd02700274/deploy_model_on_android.py",children:"\u4E0B\u8F7D Python \u6E90\u4EE3\u7801\uFF1Adeploy_model_on_android.py"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://tvm.apache.org/docs/_downloads/eed2658f15243bab719b2de7769fa45a/deploy_model_on_android.ipynb",children:"\u4E0B\u8F7D Jupyter Notebook\uFF1Adeploy_model_on_android.ipynb"})})]})}function p(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},21494:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return d}});var r=t(39546);let a={},o=r.createContext(a);function d(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);