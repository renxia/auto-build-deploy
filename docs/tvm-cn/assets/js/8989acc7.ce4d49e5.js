"use strict";(self.webpackChunktvm_cn=self.webpackChunktvm_cn||[]).push([["51909"],{89669:function(e,n,r){r.r(n),r.d(n,{default:()=>p,frontMatter:()=>i,metadata:()=>t,assets:()=>a,toc:()=>d,contentTitle:()=>s});var t=JSON.parse('{"id":"tutorial/rpc","title":"\u4EA4\u53C9\u7F16\u8BD1\u548C RPC","description":"\u5355\u51FB \u6B64\u5904 \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801","source":"@site/versioned_docs/version-0.12.0/tutorial/10-rpc.md","sourceDirName":"tutorial","slug":"/tutorial/rpc","permalink":"/docs/tvm-cn/docs/0.12.0/tutorial/rpc","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperai/tvm-cn/edit/master/versioned_docs/version-0.12.0/tutorial/10-rpc.md","tags":[],"version":"0.12.0","lastUpdatedBy":"sparanoid","lastUpdatedAt":1744717810000,"sidebarPosition":10,"frontMatter":{"title":"\u4EA4\u53C9\u7F16\u8BD1\u548C RPC"},"sidebar":"tutorialSidebar","previous":{"title":"TensorIR \u5FEB\u901F\u5165\u95E8","permalink":"/docs/tvm-cn/docs/0.12.0/tutorial/tensorIR"},"next":{"title":"\u5FEB\u901F\u5165\u95E8\uFF1A\u7F16\u8BD1\u6DF1\u5EA6\u5B66\u4E60\u6A21\u578B","permalink":"/docs/tvm-cn/docs/0.12.0/tutorial/quick_start"}}'),c=r("74132"),l=r("21494");let i={title:"\u4EA4\u53C9\u7F16\u8BD1\u548C RPC"},s="\u4EA4\u53C9\u7F16\u8BD1\u548C RPC",a={},d=[{value:"\u5728\u8BBE\u5907\u4E0A\u6784\u5EFA TVM Runtime",id:"\u5728\u8BBE\u5907\u4E0A\u6784\u5EFA-tvm-runtime",level:2},{value:"\u5728\u8BBE\u5907\u4E0A\u8BBE\u7F6E RPC \u670D\u52A1\u5668",id:"\u5728\u8BBE\u5907\u4E0A\u8BBE\u7F6E-rpc-\u670D\u52A1\u5668",level:2},{value:"\u5728\u672C\u5730\u673A\u5668\u4E0A\u58F0\u660E\u548C\u4EA4\u53C9\u7F16\u8BD1\u5185\u6838",id:"\u5728\u672C\u5730\u673A\u5668\u4E0A\u58F0\u660E\u548C\u4EA4\u53C9\u7F16\u8BD1\u5185\u6838",level:2},{value:"\u901A\u8FC7 RPC \u8FDC\u7A0B\u8FD0\u884C CPU \u5185\u6838",id:"\u901A\u8FC7-rpc-\u8FDC\u7A0B\u8FD0\u884C-cpu-\u5185\u6838",level:2},{value:"\u901A\u8FC7 RPC \u8FDC\u7A0B\u8FD0\u884C OpenCL \u5185\u6838",id:"\u901A\u8FC7-rpc-\u8FDC\u7A0B\u8FD0\u884C-opencl-\u5185\u6838",level:2},{value:"\u603B\u7ED3",id:"\u603B\u7ED3",level:2}];function o(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"\u4EA4\u53C9\u7F16\u8BD1\u548C-rpc",children:"\u4EA4\u53C9\u7F16\u8BD1\u548C RPC"})}),"\n",(0,c.jsx)(n.admonition,{type:"note",children:(0,c.jsxs)(n.p,{children:["\u5355\u51FB ",(0,c.jsx)(n.a,{href:"https://tvm.apache.org/docs/tutorial/cross_compilation_and_rpc.html#sphx-glr-download-tutorial-cross-compilation-and-rpc-py",children:"\u6B64\u5904"})," \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801"]})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"\u4F5C\u8005"}),"\uFF1A",(0,c.jsx)(n.a,{href:"https://github.com/ZihengJiang/",children:"Ziheng Jiang"}),"\uFF0C",(0,c.jsx)(n.a,{href:"https://github.com/merrymercy/",children:"Lianmin Zheng"})]}),"\n",(0,c.jsx)(n.p,{children:"\u672C\u6559\u7A0B\u4ECB\u7ECD\u4E86\u5982\u4F55\u5728 TVM \u4E2D\u4F7F\u7528 RPC \u8FDB\u884C\u4EA4\u53C9\u7F16\u8BD1\u548C\u8FDC\u7A0B\u8BBE\u5907\u6267\u884C\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u5229\u7528\u4EA4\u53C9\u7F16\u8BD1\u548C RPC\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u7A0B\u5E8F\u5728\u672C\u5730\u673A\u5668\u7F16\u8BD1\uFF0C\u5728\u8FDC\u7A0B\u8BBE\u5907\u8FD0\u884C\u3002\u8FD9\u4E2A\u7279\u6027\u5728\u8FDC\u7A0B\u8BBE\u5907\u8D44\u6E90\u6709\u9650\u65F6\uFF08\u5982\u5728\u6811\u8393\u6D3E\u548C\u79FB\u52A8\u5E73\u53F0\u4E0A\uFF09\u5C24\u5176\u6709\u7528\u3002\u672C\u6559\u7A0B\u5C06\u628A\u6811\u8393\u6D3E\u4F5C\u4E3A CPU \u793A\u4F8B\uFF0C\u628A Firefly-RK3399 \u4F5C\u4E3A OpenCL \u793A\u4F8B\u8FDB\u884C\u6F14\u793A\u3002"}),"\n",(0,c.jsx)(n.h2,{id:"\u5728\u8BBE\u5907\u4E0A\u6784\u5EFA-tvm-runtime",children:"\u5728\u8BBE\u5907\u4E0A\u6784\u5EFA TVM Runtime"}),"\n",(0,c.jsx)(n.p,{children:"\u9996\u5148\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u6784\u5EFA TVM runtime\u3002"}),"\n",(0,c.jsx)(n.admonition,{title:"\u6CE8\u610F",type:"note",children:(0,c.jsx)(n.p,{children:"\u672C\u8282\u548C\u4E0B\u4E00\u8282\u4E2D\u7684\u6240\u6709\u547D\u4EE4\u90FD\u5E94\u5728\u76EE\u6807\u8BBE\u5907\uFF08\u4F8B\u5982\u6811\u8393\u6D3E\uFF09\u4E0A\u6267\u884C\u3002\u5047\u8BBE\u76EE\u6807\u8BBE\u5907\u8FD0\u884C Linux \u7CFB\u7EDF\u3002"})}),"\n",(0,c.jsx)(n.p,{children:"\u7531\u4E8E\u5728\u672C\u5730\u673A\u5668\u4E0A\u53EA\u505A\u7F16\u8BD1\uFF0C\u800C\u8FDC\u7A0B\u8BBE\u5907\u7528\u4E8E\u8FD0\u884C\u751F\u6210\u7684\u4EE3\u7801\u3002\u6240\u4EE5\u53EA\u9700\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u6784\u5EFA TVM runtime\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"git clone --recursive https://github.com/apache/tvm tvm\ncd tvm\nmake runtime -j2\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u6210\u529F\u6784\u5EFA runtime \u540E\uFF0C\u8981\u5728 ",(0,c.jsx)(n.code,{children:"~/.bashrc"})," \u6587\u4EF6\u4E2D\u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF\u3002\u53EF\u4EE5\u7528 ",(0,c.jsx)(n.code,{children:"vi ~/.bashrc"}),"\u547D\u4EE4\u7F16\u8F91 ",(0,c.jsx)(n.code,{children:"~/.bashrc"}),"\uFF0C\u5728\u8FD9\u4E2A\u6587\u4EF6\u91CC\u6DFB\u52A0\u4E0B\u9762\u8FD9\u884C\u4EE3\u7801\uFF08\u5047\u8BBE TVM \u76EE\u5F55\u5728 ",(0,c.jsx)(n.code,{children:"~/tvm"})," \u4E2D\uFF09\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"export PYTHONPATH=$PYTHONPATH:~/tvm/python\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u6267\u884C ",(0,c.jsx)(n.code,{children:"source ~/.bashrc"})," \u6765\u66F4\u65B0\u73AF\u5883\u53D8\u91CF\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"\u5728\u8BBE\u5907\u4E0A\u8BBE\u7F6E-rpc-\u670D\u52A1\u5668",children:"\u5728\u8BBE\u5907\u4E0A\u8BBE\u7F6E RPC \u670D\u52A1\u5668"}),"\n",(0,c.jsx)(n.p,{children:"\u5728\u8FDC\u7A0B\u8BBE\u5907\uFF08\u672C\u4F8B\u4E3A\u6811\u8393\u6D3E\uFF09\u4E0A\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u6765\u542F\u52A8 RPC \u670D\u52A1\u5668\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"python -m tvm.exec.rpc_server --host 0.0.0.0 --port=9090\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u770B\u5230\u4E0B\u9762\u8FD9\u884C\u63D0\u793A\uFF0C\u5219\u8868\u793A RPC \u670D\u52A1\u5668\u5DF2\u6210\u529F\u542F\u52A8\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"INFO:root:RPCServer: bind to 0.0.0.0:9090\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u5728\u672C\u5730\u673A\u5668\u4E0A\u58F0\u660E\u548C\u4EA4\u53C9\u7F16\u8BD1\u5185\u6838",children:"\u5728\u672C\u5730\u673A\u5668\u4E0A\u58F0\u660E\u548C\u4EA4\u53C9\u7F16\u8BD1\u5185\u6838"}),"\n",(0,c.jsx)(n.admonition,{type:"note",children:(0,c.jsx)(n.p,{children:"\u73B0\u5728\u56DE\u5230\u672C\u5730\u673A\u5668\uFF08\u5DF2\u7ECF\u7528 LLVM \u5B89\u88C5\u4E86\u5B8C\u6574\u7684 TVM\uFF09\u3002"})}),"\n",(0,c.jsx)(n.p,{children:"\u5728\u672C\u5730\u673A\u5668\u4E0A\u58F0\u660E\u4E00\u4E2A\u7B80\u5355\u7684\u5185\u6838\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import numpy as np\n\nimport tvm\nfrom tvm import te\nfrom tvm import rpc\nfrom tvm.contrib import utils\n\nn = tvm.runtime.convert(1024)\nA = te.placeholder((n,), name="A")\nB = te.compute((n,), lambda i: A[i] + 1.0, name="B")\ns = te.create_schedule(B.op)\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u7136\u540E\u4EA4\u53C9\u7F16\u8BD1\u5185\u6838\u3002\u5BF9\u4E8E\u6811\u8393\u6D3E 3B\uFF0Ctarget \u662F\u201Cllvm -mtriple=armv7l-linux-gnueabihf\u201D\uFF0C\u4F46\u8FD9\u91CC\u7528\u7684\u662F\u201Cllvm\u201D\uFF0C\u4F7F\u5F97\u672C\u6559\u7A0B\u53EF\u4EE5\u5728\u7F51\u9875\u6784\u5EFA\u670D\u52A1\u5668\u4E0A\u8FD0\u884C\u3002\u8BF7\u53C2\u9605\u4E0B\u9762\u7684\u8BE6\u7EC6\u8BF4\u660E\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'local_demo = True\n\nif local_demo:\n    target = "llvm"\nelse:\n    target = "llvm -mtriple=armv7l-linux-gnueabihf"\n\nfunc = tvm.build(s, [A, B], target=target, name="add_one")\n# \u5C06 lib \u5B58\u50A8\u5728\u672C\u5730\u4E34\u65F6\u6587\u4EF6\u5939\ntemp = utils.tempdir()\npath = temp.relpath("lib.tar")\nfunc.export_library(path)\n'})}),"\n",(0,c.jsxs)(n.admonition,{type:"note",children:[(0,c.jsxs)(n.p,{children:["\u8981\u4F7F\u672C\u6559\u7A0B\u8FD0\u884C\u5728\u771F\u6B63\u7684\u8FDC\u7A0B\u8BBE\u5907\u4E0A\uFF0C\u9700\u8981\u5C06 ",(0,c.jsx)(n.code,{children:"local_demo"})," \u6539\u4E3A False\uFF0C\u5E76\u5C06 ",(0,c.jsx)(n.code,{children:"build"})," \u4E2D\u7684 ",(0,c.jsx)(n.code,{children:"target"})," \u66FF\u6362\u4E3A\u9002\u5408\u8BBE\u5907\u7684 target \u4E09\u5143\u7EC4\u3002\u4E0D\u540C\u8BBE\u5907\u7684 target \u4E09\u5143\u7EC4\u53EF\u80FD\u4E0D\u540C\u3002\u4F8B\u5982\uFF0C\u5BF9\u4E8E\u6811\u8393\u6D3E 3B\uFF0C\u5B83\u662F ",(0,c.jsx)(n.code,{children:"llvm -mtriple=armv7l-linux-gnueabihf"}),"\uFF1B\u5BF9\u4E8E RK3399\uFF0C\u5B83\u662F ",(0,c.jsx)(n.code,{children:"llvm -mtriple=aarch64-linux-gnu"}),"\u3002"]}),(0,c.jsxs)(n.p,{children:["\u901A\u5E38\uFF0C\u53EF\u4EE5\u5728\u8BBE\u5907\u4E0A\u8FD0\u884C ",(0,c.jsx)(n.code,{children:"gcc -v"})," \u6765\u67E5\u8BE2 target\uFF0C\u5BFB\u627E\u4EE5 ",(0,c.jsx)(n.code,{children:"Target"})," \u5F00\u5934\u7684\u884C\uFF1A\uFF08\u5C3D\u7BA1\u5B83\u53EF\u80FD\u4ECD\u7136\u662F\u4E00\u4E2A\u677E\u6563\u7684\u914D\u7F6E\u3002\uFF09"]}),(0,c.jsxs)(n.p,{children:["\u9664\u4E86 ",(0,c.jsx)(n.code,{children:"-mtriple"}),"\uFF0C\u8FD8\u53EF\u8BBE\u7F6E\u5176\u4ED6\u7F16\u8BD1\u9009\u9879\uFF0C\u4F8B\u5982\uFF1A"]}),(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"-mcpu=<cpuname\\>"})})}),"\n",(0,c.jsx)(n.p,{children:"\u6307\u5B9A\u751F\u6210\u7684\u4EE3\u7801\u8FD0\u884C\u7684\u82AF\u7247\u67B6\u6784\u3002\u9ED8\u8BA4\u60C5\u51B5\u8FD9\u662F\u4ECE target \u4E09\u5143\u7EC4\u63A8\u65AD\u51FA\u6765\u7684\uFF0C\u5E76\u81EA\u52A8\u68C0\u6D4B\u5230\u5F53\u524D\u67B6\u6784\u3002"}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"-mattr=a1,+a2,-a3,\u2026"})})}),"\n",(0,c.jsx)(n.p,{children:"\u8986\u76D6\u6216\u63A7\u5236 target \u7684\u6307\u5B9A\u5C5E\u6027\uFF0C\u4F8B\u5982\u662F\u5426\u542F\u7528 SIMD \u64CD\u4F5C\u3002\u9ED8\u8BA4\u5C5E\u6027\u96C6\u7531\u5F53\u524D CPU \u8BBE\u7F6E\u3002\u8981\u83B7\u53D6\u53EF\u7528\u5C5E\u6027\u5217\u8868\uFF0C\u6267\u884C\uFF1A"}),"\n"]}),"\n"]}),(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"  llc -mtriple=<your device target triple> -mattr=help\n"})}),(0,c.jsxs)(n.p,{children:["\u8FD9\u4E9B\u9009\u9879\u4E0E ",(0,c.jsx)(n.a,{href:"http://llvm.org/docs/CommandGuide/llc.html",children:"llc"})," \u4E00\u81F4\u3002\u5EFA\u8BAE\u8BBE\u7F6E target \u4E09\u5143\u7EC4\u548C\u529F\u80FD\u96C6\uFF0C\u4F7F\u5176\u5305\u542B\u53EF\u7528\u7684\u7279\u5B9A\u529F\u80FD\uFF0C\u8FD9\u6837\u6211\u4EEC\u53EF\u4EE5\u5145\u5206\u5229\u7528\u5355\u677F\u7684\u529F\u80FD\u3002\u67E5\u770B ",(0,c.jsx)(n.a,{href:"https://clang.llvm.org/docs/CrossCompilation.html",children:"LLVM \u4EA4\u53C9\u7F16\u8BD1\u6307\u5357"})," \u83B7\u53D6\u6709\u5173\u4EA4\u53C9\u7F16\u8BD1\u5C5E\u6027\u7684\u8BE6\u7EC6\u4FE1\u606F\u3002"]})]}),"\n",(0,c.jsx)(n.h2,{id:"\u901A\u8FC7-rpc-\u8FDC\u7A0B\u8FD0\u884C-cpu-\u5185\u6838",children:"\u901A\u8FC7 RPC \u8FDC\u7A0B\u8FD0\u884C CPU \u5185\u6838"}),"\n",(0,c.jsx)(n.p,{children:"\u4E0B\u9762\u5C06\u6F14\u793A\u5982\u4F55\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u8FD0\u884C\u751F\u6210\u7684 CPU \u5185\u6838\u3002\u9996\u5148\uFF0C\u4ECE\u8FDC\u7A0B\u8BBE\u5907\u83B7\u53D6 RPC \u4F1A\u8BDD\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'if local_demo:\n    remote = rpc.LocalSession()\nelse:\n    # \u4E0B\u9762\u662F\u6211\u7684\u73AF\u5883\uFF0C\u5C06\u8FD9\u4E2A\u6362\u6210\u4F60\u76EE\u6807\u8BBE\u5907\u7684 IP \u5730\u5740\n    host = "10.77.1.162"\n    port = 9090\n    remote = rpc.connect(host, port)\n'})}),"\n",(0,c.jsxs)(n.p,{children:["\u5C06 lib \u4E0A\u4F20\u5230\u8FDC\u7A0B\u8BBE\u5907\uFF0C\u7136\u540E\u8C03\u7528\u8BBE\u5907\u7684\u672C\u5730\u7F16\u8BD1\u5668\u91CD\u65B0\u94FE\u63A5\u5B83\u4EEC\u3002\u5176\u4E2D ",(0,c.jsx)(n.em,{children:"func"})," \u662F\u4E00\u4E2A\u8FDC\u7A0B\u6A21\u5757\u5BF9\u8C61\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'remote.upload(path)\nfunc = remote.load_module("lib.tar")\n\n# \u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u521B\u5EFA\u6570\u7EC4\ndev = remote.cpu()\na = tvm.nd.array(np.random.uniform(size=1024).astype(A.dtype), dev)\nb = tvm.nd.array(np.zeros(1024, dtype=A.dtype), dev)\n# \u8FD9\u4E2A\u51FD\u6570\u5C06\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u8FD0\u884C\nfunc(a, b)\nnp.testing.assert_equal(b.numpy(), a.numpy() + 1)\n'})}),"\n",(0,c.jsxs)(n.p,{children:["\u8981\u60F3\u8BC4\u4F30\u5185\u6838\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u7684\u6027\u80FD\uFF0C\u907F\u514D\u7F51\u7EDC\u5F00\u9500\u5F88\u91CD\u8981\u3002",(0,c.jsx)(n.code,{children:"time_evaluator"})," \u8FD4\u56DE\u4E00\u4E2A\u8FDC\u7A0B\u51FD\u6570\uFF0C\u8FD9\u4E2A\u8FDC\u7A0B\u51FD\u6570\u591A\u6B21\u8FD0\u884C func \u51FD\u6570\uFF0C\u5E76\u6D4B\u8BD5\u6BCF\u4E00\u6B21\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u8FD0\u884C\u7684\u6210\u672C\uFF0C\u7136\u540E\u8FD4\u56DE\u6D4B\u8BD5\u7684\u6210\u672C\uFF08\u4E0D\u5305\u62EC\u7F51\u7EDC\u5F00\u9500\uFF09\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'time_f = func.time_evaluator(func.entry_name, dev, number=10)\ncost = time_f(a, b).mean\nprint("%g secs/op" % cost)\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"1.369e-07 secs/op\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u901A\u8FC7-rpc-\u8FDC\u7A0B\u8FD0\u884C-opencl-\u5185\u6838",children:"\u901A\u8FC7 RPC \u8FDC\u7A0B\u8FD0\u884C OpenCL \u5185\u6838"}),"\n",(0,c.jsx)(n.p,{children:"\u8FDC\u7A0B OpenCL \u8BBE\u5907\u7684\u5DE5\u4F5C\u6D41\u7A0B\u4E0E\u4E0A\u8FF0\u5185\u5BB9\u57FA\u672C\u76F8\u540C\u3002\u53EF\u4EE5\u5B9A\u4E49\u5185\u6838\u3001\u4E0A\u4F20\u6587\u4EF6\uFF0C\u7136\u540E\u901A\u8FC7 RPC \u8FD0\u884C\u3002"}),"\n",(0,c.jsxs)(n.admonition,{type:"note",children:[(0,c.jsxs)(n.p,{children:["\u6811\u8393\u6D3E\u4E0D\u652F\u6301 OpenCL\uFF0C\u4E0B\u9762\u7684\u4EE3\u7801\u662F\u5728 Firefly-RK3399 \u4E0A\u6D4B\u8BD5\u7684\u3002\u53EF\u4EE5\u6309\u7167 ",(0,c.jsx)(n.a,{href:"https://gist.github.com/mli/585aed2cec0b5178b1a510f9f236afa2",children:"\u6559\u7A0B"})," \u4E3A RK3399 \u8BBE\u7F6E OS \u53CA OpenCL \u9A71\u52A8\u7A0B\u5E8F\u3002"]}),(0,c.jsx)(n.p,{children:"\u5728 rk3399 \u677F\u4E0A\u6784\u5EFA runtime \u4E5F\u9700\u542F\u7528 OpenCL\u3002\u5728 TVM \u6839\u76EE\u5F55\u4E0B\u6267\u884C\uFF1A"}),(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'cp cmake/config.cmake .\nsed -i "s/USE_OPENCL OFF/USE_OPENCL ON/" config.cmake\nmake runtime -j4\n'})})]}),"\n",(0,c.jsx)(n.p,{children:"\u4E0B\u9762\u7684\u51FD\u6570\u5C55\u793A\u4E86\u5982\u4F55\u8FDC\u7A0B\u8FD0\u884C OpenCL \u5185\u6838\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'def run_opencl():\n    # \u6CE8\u610F\uFF1A\u8FD9\u662F rk3399 \u677F\u7684\u8BBE\u7F6E\u3002\u4F60\u9700\u8981\u6839\u636E\u4F60\u7684\u73AF\u5883\u8FDB\u884C\u4FEE\u6539\n    opencl_device_host = "10.77.1.145"\n    opencl_device_port = 9090\n    target = tvm.target.Target("opencl", host="llvm -mtriple=aarch64-linux-gnu")\n\n    # \u4E3A\u4E0A\u9762\u7684\u8BA1\u7B97\u58F0\u660E "add one" \u521B\u5EFA schedule\n    s = te.create_schedule(B.op)\n    xo, xi = s[B].split(B.op.axis[0], factor=32)\n    s[B].bind(xo, te.thread_axis("blockIdx.x"))\n    s[B].bind(xi, te.thread_axis("threadIdx.x"))\n    func = tvm.build(s, [A, B], target=target)\n\n    remote = rpc.connect(opencl_device_host, opencl_device_port)\n\n    # \u5BFC\u51FA\u5E76\u4E0A\u4F20\n    path = temp.relpath("lib_cl.tar")\n    func.export_library(path)\n    remote.upload(path)\n    func = remote.load_module("lib_cl.tar")\n\n    # \u8FD0\u884C\n    dev = remote.cl()\n    a = tvm.nd.array(np.random.uniform(size=1024).astype(A.dtype), dev)\n    b = tvm.nd.array(np.zeros(1024, dtype=A.dtype), dev)\n    func(a, b)\n    np.testing.assert_equal(b.numpy(), a.numpy() + 1)\n    print("OpenCL test passed!")\n'})}),"\n",(0,c.jsx)(n.h2,{id:"\u603B\u7ED3",children:"\u603B\u7ED3"}),"\n",(0,c.jsx)(n.p,{children:"\u672C\u6559\u7A0B\u4ECB\u7ECD\u4E86 TVM \u4E2D\u7684\u4EA4\u53C9\u7F16\u8BD1\u548C RPC \u529F\u80FD\u3002"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5728\u8FDC\u7A0B\u8BBE\u5907\u4E0A\u8BBE\u7F6E RPC \u670D\u52A1\u5668\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u8BBE\u7F6E\u76EE\u6807\u8BBE\u5907\u914D\u7F6E\uFF0C\u4F7F\u5F97\u53EF\u5728\u672C\u5730\u673A\u5668\u4E0A\u4EA4\u53C9\u7F16\u8BD1\u5185\u6838\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u901A\u8FC7 RPC API \u8FDC\u7A0B\u4E0A\u4F20\u548C\u8FD0\u884C\u5185\u6838\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://tvm.apache.org/docs/_downloads/766206ab8f1fd80ac34d9816cb991a0d/cross_compilation_and_rpc.py",children:"\u4E0B\u8F7D Python \u6E90\u4EE3\u7801\uFF1Across_compilation_and_rpc.py"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://tvm.apache.org/docs/_downloads/f289ca2466fcf79c024068c1f8642bd0/cross_compilation_and_rpc.ipynb",children:"\u4E0B\u8F7D Jupyter Notebook\uFF1Across_compilation_and_rpc.ipynb"})})]})}function p(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},21494:function(e,n,r){r.d(n,{Z:function(){return s},a:function(){return i}});var t=r(39546);let c={},l=t.createContext(c);function i(e){let n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);