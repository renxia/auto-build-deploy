"use strict";(self.webpackChunktvm_cn=self.webpackChunktvm_cn||[]).push([["61285"],{66054:function(e,n,t){t.r(n),t.d(n,{default:()=>p,frontMatter:()=>l,metadata:()=>r,assets:()=>s,toc:()=>d,contentTitle:()=>i});var r=JSON.parse('{"id":"how_to/deploy/deploy_models/deploy_prequan","title":"\u4F7F\u7528 TVM \u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B","description":"\u5355\u51FB \u6B64\u5904 \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801","source":"@site/versioned_docs/version-0.12.0/how_to/deploy/deploy_models/05-deploy_prequan.md","sourceDirName":"how_to/deploy/deploy_models","slug":"/how_to/deploy/deploy_models/deploy_prequan","permalink":"/docs/tvm-cn/docs/0.12.0/how_to/deploy/deploy_models/deploy_prequan","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperai/tvm-cn/edit/master/versioned_docs/version-0.12.0/how_to/deploy/deploy_models/05-deploy_prequan.md","tags":[],"version":"0.12.0","lastUpdatedBy":"sparanoid","lastUpdatedAt":1744717810000,"sidebarPosition":5,"frontMatter":{"title":"\u4F7F\u7528 TVM \u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B"},"sidebar":"tutorialSidebar","previous":{"title":"\u7F16\u8BD1 PyTorch \u76EE\u6807\u68C0\u6D4B\u6A21\u578B","permalink":"/docs/tvm-cn/docs/0.12.0/how_to/deploy/deploy_models/compile_od"},"next":{"title":"\u4F7F\u7528 TVM \u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B - \u7B2C 3 \u90E8\u5206\uFF08TFLite\uFF09","permalink":"/docs/tvm-cn/docs/0.12.0/how_to/deploy/deploy_models/deploy_prequan_3"}}'),a=t("74132"),o=t("21494");let l={title:"\u4F7F\u7528 TVM \u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B"},i="\u4F7F\u7528 TVM \u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B",s={},d=[{value:"\u90E8\u7F72\u91CF\u5316\u7684 PyTorch \u6A21\u578B",id:"\u90E8\u7F72\u91CF\u5316\u7684-pytorch-\u6A21\u578B",level:2},{value:"\u4ECE torchvision \u52A0\u8F7D\u9884\u91CF\u5316\u3001\u9884\u8BAD\u7EC3\u7684 Mobilenet v2 \u6A21\u578B",id:"\u4ECE-torchvision-\u52A0\u8F7D\u9884\u91CF\u5316\u9884\u8BAD\u7EC3\u7684-mobilenet-v2-\u6A21\u578B",level:2},{value:"\u91CF\u5316\u3001\u8DDF\u8E2A\u548C\u8FD0\u884C PyTorch Mobilenet v2 \u6A21\u578B",id:"\u91CF\u5316\u8DDF\u8E2A\u548C\u8FD0\u884C-pytorch-mobilenet-v2-\u6A21\u578B",level:2},{value:"\u4F7F\u7528 PyTorch \u524D\u7AEF\u5C06\u91CF\u5316\u7684 Mobilenet v2 \u8F6C\u6362\u4E3A Relay-QNN",id:"\u4F7F\u7528-pytorch-\u524D\u7AEF\u5C06\u91CF\u5316\u7684-mobilenet-v2-\u8F6C\u6362\u4E3A-relay-qnn",level:2},{value:"\u7F16\u8BD1\u5E76\u8FD0\u884C Relay \u6A21\u5757",id:"\u7F16\u8BD1\u5E76\u8FD0\u884C-relay-\u6A21\u5757",level:2},{value:"\u6BD4\u8F83\u8F93\u51FA\u6807\u7B7E",id:"\u6BD4\u8F83\u8F93\u51FA\u6807\u7B7E",level:2},{value:"\u6D4B\u8BD5\u6027\u80FD",id:"\u6D4B\u8BD5\u6027\u80FD",level:2},{value:"\u90E8\u7F72\u91CF\u5316\u7684 MXNet \u6A21\u578B",id:"\u90E8\u7F72\u91CF\u5316\u7684-mxnet-\u6A21\u578B",level:2},{value:"\u90E8\u7F72\u91CF\u5316\u7684 TFLite \u6A21\u578B",id:"\u90E8\u7F72\u91CF\u5316\u7684-tflite-\u6A21\u578B",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\u4F7F\u7528-tvm-\u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B",children:"\u4F7F\u7528 TVM \u90E8\u7F72\u6846\u67B6\u9884\u91CF\u5316\u6A21\u578B"})}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["\u5355\u51FB ",(0,a.jsx)(n.a,{href:"https://tvm.apache.org/docs/how_to/deploy_models/deploy_prequantized.html#sphx-glr-download-how-to-deploy-models-deploy-prequantized-py",children:"\u6B64\u5904"})," \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801"]})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u4F5C\u8005"}),"\uFF1A",(0,a.jsx)(n.a,{href:"https://github.com/masahi",children:"Masahiro Masuda"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u672C\u6587\u4ECB\u7ECD\u5982\u4F55\u5C06\u6DF1\u5EA6\u5B66\u4E60\u6846\u67B6\u91CF\u5316\u7684\u6A21\u578B\u52A0\u8F7D\u5230 TVM\u3002\u9884\u91CF\u5316\u6A21\u578B\u7684\u5BFC\u5165\u662F TVM \u4E2D\u652F\u6301\u7684\u91CF\u5316\u4E4B\u4E00\u3002\u6709\u5173 TVM \u4E2D\u91CF\u5316\u7684\u66F4\u591A\u4FE1\u606F\uFF0C\u53C2\u9605 ",(0,a.jsx)(n.a,{href:"https://discuss.tvm.apache.org/t/quantization-story/3920",children:"\u6B64\u5904"}),"\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u8FD9\u91CC\u6F14\u793A\u4E86\u5982\u4F55\u52A0\u8F7D\u548C\u8FD0\u884C\u7531 PyTorch\u3001MXNet \u548C TFLite \u91CF\u5316\u7684\u6A21\u578B\u3002\u52A0\u8F7D\u540E\uFF0C\u53EF\u4EE5\u5728\u4EFB\u4F55 TVM \u652F\u6301\u7684\u786C\u4EF6\u4E0A\u8FD0\u884C\u7F16\u8BD1\u540E\u7684\u91CF\u5316\u6A21\u578B\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u9996\u5148\uFF0C\u5BFC\u5165\u5FC5\u8981\u7684\u5305\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from PIL import Image\nimport numpy as np\nimport torch\nfrom torchvision.models.quantization import mobilenet as qmobilenet\n\nimport tvm\nfrom tvm import relay\nfrom tvm.contrib.download import download_testdata\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5B9A\u4E49\u8FD0\u884C demo \u7684\u8F85\u52A9\u51FD\u6570\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def get_transform():\n    import torchvision.transforms as transforms\n\n    normalize = transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])\n    return transforms.Compose(\n        [\n            transforms.Resize(256),\n            transforms.CenterCrop(224),\n            transforms.ToTensor(),\n            normalize,\n        ]\n    )\n\ndef get_real_image(im_height, im_width):\n    img_url = "https://github.com/dmlc/mxnet.js/blob/main/data/cat.png?raw=true"\n    img_path = download_testdata(img_url, "cat.png", module="data")\n    return Image.open(img_path).resize((im_height, im_width))\n\ndef get_imagenet_input():\n    im = get_real_image(224, 224)\n    preprocess = get_transform()\n    pt_tensor = preprocess(im)\n    return np.expand_dims(pt_tensor.numpy(), 0)\n\ndef get_synset():\n    synset_url = "".join(\n        [\n            "https://gist.githubusercontent.com/zhreshold/",\n            "4d0b62f3d01426887599d4f7ede23ee5/raw/",\n            "596b27d23537e5a1b5751d2b0481ef172f58b539/",\n            "imagenet1000_clsid_to_human.txt",\n        ]\n    )\n    synset_name = "imagenet1000_clsid_to_human.txt"\n    synset_path = download_testdata(synset_url, synset_name, module="data")\n    with open(synset_path) as f:\n        return eval(f.read())\n\ndef run_tvm_model(mod, params, input_name, inp, target="llvm"):\n    with tvm.transform.PassContext(opt_level=3):\n        lib = relay.build(mod, target=target, params=params)\n\n    runtime = tvm.contrib.graph_executor.GraphModule(lib["default"](tvm.device(target, 0)))\n\n    runtime.set_input(input_name, inp)\n    runtime.run()\n    return runtime.get_output(0).numpy(), runtime\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u4ECE\u6807\u7B7E\u5230\u7C7B\u540D\u7684\u6620\u5C04\uFF0C\u9A8C\u8BC1\u6A21\u578B\u7684\u8F93\u51FA\u662F\u5426\u5408\u7406\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"synset = get_synset()\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u7528\u732B\u7684\u56FE\u50CF\u8FDB\u884C\u6F14\u793A\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"inp = get_imagenet_input()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u90E8\u7F72\u91CF\u5316\u7684-pytorch-\u6A21\u578B",children:"\u90E8\u7F72\u91CF\u5316\u7684 PyTorch \u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u9996\u5148\u6F14\u793A\u5982\u4F55\u7528 PyTorch \u524D\u7AEF\u52A0\u8F7D\u7531 PyTorch \u91CF\u5316\u7684\u6DF1\u5EA6\u5B66\u4E60\u6A21\u578B\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["\u53C2\u8003 ",(0,a.jsx)(n.a,{href:"https://pytorch.org/tutorials/advanced/static_quantization_tutorial.html",children:"PyTorch \u9759\u6001\u91CF\u5316\u6559\u7A0B"}),"\uFF0C\u4E86\u89E3\u91CF\u5316\u7684\u5DE5\u4F5C\u6D41\u7A0B\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u7528\u4E0B\u9762\u7684\u51FD\u6570\u6765\u91CF\u5316 PyTorch \u6A21\u578B\u3002\u6B64\u51FD\u6570\u91C7\u7528\u6D6E\u70B9\u6A21\u578B\uFF0C\u5E76\u5C06\u5176\u8F6C\u6362\u4E3A uint8\u3002\u8FD9\u4E2A\u6A21\u578B\u662F\u6309\u901A\u9053\u91CF\u5316\u7684\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def quantize_model(model, inp):\n    model.fuse_model()\n    model.qconfig = torch.quantization.get_default_qconfig("fbgemm")\n    torch.quantization.prepare(model, inplace=True)\n    # Dummy calibration\n    model(inp)\n    torch.quantization.convert(model, inplace=True)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u4ECE-torchvision-\u52A0\u8F7D\u9884\u91CF\u5316\u9884\u8BAD\u7EC3\u7684-mobilenet-v2-\u6A21\u578B",children:"\u4ECE torchvision \u52A0\u8F7D\u9884\u91CF\u5316\u3001\u9884\u8BAD\u7EC3\u7684 Mobilenet v2 \u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u4E4B\u6240\u4EE5\u9009\u62E9 mobilenet v2\uFF0C\u662F\u56E0\u4E3A\u8BE5\u6A21\u578B\u63A5\u53D7\u4E86\u91CF\u5316\u611F\u77E5\u8BAD\u7EC3\uFF0C\u800C\u5176\u4ED6\u6A21\u578B\u5219\u9700\u8981\u5B8C\u6574\u7684\u8BAD\u7EC3\u540E\u6821\u51C6\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"qmodel = qmobilenet.mobilenet_v2(pretrained=True).eval()\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'Downloading: "https://download.pytorch.org/models/mobilenet_v2-b0353104.pth" to /workspace/.cache/torch/hub/checkpoints/mobilenet_v2-b0353104.pth\n\n  0%|          | 0.00/13.6M [00:00<?, ?B/s]\n 44%|####4     | 6.03M/13.6M [00:00<00:00, 63.2MB/s]\n 89%|########8 | 12.1M/13.6M [00:00<00:00, 61.4MB/s]\n100%|##########| 13.6M/13.6M [00:00<00:00, 66.0MB/s]\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u91CF\u5316\u8DDF\u8E2A\u548C\u8FD0\u884C-pytorch-mobilenet-v2-\u6A21\u578B",children:"\u91CF\u5316\u3001\u8DDF\u8E2A\u548C\u8FD0\u884C PyTorch Mobilenet v2 \u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u91CF\u5316\u548C jit \u7684\u8BE6\u7EC6\u4FE1\u606F\u53EF\u53C2\u8003 PyTorch \u7F51\u7AD9\u4E0A\u7684\u6559\u7A0B\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"pt_inp = torch.from_numpy(inp)\nquantize_model(qmodel, pt_inp)\nscript_module = torch.jit.trace(qmodel, pt_inp).eval()\n\nwith torch.no_grad():\n    pt_result = script_module(pt_inp).numpy()\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'/usr/local/lib/python3.7/dist-packages/torch/ao/quantization/observer.py:179: UserWarning: Please use quant_min and quant_max to specify the range for observers.                     reduce_range will be deprecated in a future release of PyTorch.\n  reduce_range will be deprecated in a future release of PyTorch."\n/usr/local/lib/python3.7/dist-packages/torch/ao/quantization/observer.py:1126: UserWarning: must run observer before calling calculate_qparams.                                    Returning default scale and zero point\n  Returning default scale and zero point "\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u4F7F\u7528-pytorch-\u524D\u7AEF\u5C06\u91CF\u5316\u7684-mobilenet-v2-\u8F6C\u6362\u4E3A-relay-qnn",children:"\u4F7F\u7528 PyTorch \u524D\u7AEF\u5C06\u91CF\u5316\u7684 Mobilenet v2 \u8F6C\u6362\u4E3A Relay-QNN"}),"\n",(0,a.jsx)(n.p,{children:"PyTorch \u524D\u7AEF\u652F\u6301\u5C06\u91CF\u5316\u7684 PyTorch \u6A21\u578B\uFF0C\u8F6C\u6362\u4E3A\u5177\u6709\u91CF\u5316\u611F\u77E5\u7B97\u5B50\u7684\u7B49\u6548 Relay \u6A21\u5757\u3002\u5C06\u6B64\u8868\u793A\u79F0\u4E3A Relay QNN dialect\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u82E5\u8981\u67E5\u770B\u91CF\u5316\u6A21\u578B\u662F\u5982\u4F55\u8868\u793A\u7684\uFF0C\u53EF\u4EE5\u4ECE\u524D\u7AEF\u6253\u5370\u8F93\u51FA\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u53EF\u4EE5\u770B\u5230\u7279\u5B9A\u4E8E\u91CF\u5316\u7684\u7B97\u5B50\uFF0C\u4F8B\u5982 qnn.quantize\u3001qnn.dequantize\u3001qnn.requantize \u548C qnn.conv2d \u7B49\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'input_name = "input"  # \u5BF9\u4E8E PyTorch \u524D\u7AEF\uFF0C\u8F93\u5165\u540D\u79F0\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\u3002\ninput_shapes = [(input_name, (1, 3, 224, 224))]\nmod, params = relay.frontend.from_pytorch(script_module, input_shapes)\n# print(mod) # \u6253\u5370\u67E5\u770B QNN IR \u8F6C\u50A8\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u7F16\u8BD1\u5E76\u8FD0\u884C-relay-\u6A21\u5757",children:"\u7F16\u8BD1\u5E76\u8FD0\u884C Relay \u6A21\u5757"}),"\n",(0,a.jsx)(n.p,{children:"\u83B7\u5F97\u91CF\u5316\u7684 Relay \u6A21\u5757\u540E\uFF0C\u5269\u4E0B\u7684\u5DE5\u4F5C\u6D41\u7A0B\u4E0E\u8FD0\u884C\u6D6E\u70B9\u6A21\u578B\u76F8\u540C\u3002\u8BE6\u7EC6\u4FE1\u606F\u8BF7\u53C2\u9605\u5176\u4ED6\u6559\u7A0B\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u5E95\u5C42\uFF0C\u91CF\u5316\u7279\u5B9A\u7684\u7B97\u5B50\u5728\u7F16\u8BD1\u4E4B\u524D\uFF0C\u4F1A\u88AB\u964D\u7EA7\u4E3A\u4E00\u7CFB\u5217\u6807\u51C6 Relay \u7B97\u5B50\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'target = "llvm"\ntvm_result, rt_mod = run_tvm_model(mod, params, input_name, inp, target=target)\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'/workspace/python/tvm/driver/build_module.py:268: UserWarning: target_host parameter is going to be deprecated. Please pass in tvm.target.Target(target, host=target_host) instead.\n  "target_host parameter is going to be deprecated. "\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u6BD4\u8F83\u8F93\u51FA\u6807\u7B7E",children:"\u6BD4\u8F83\u8F93\u51FA\u6807\u7B7E"}),"\n",(0,a.jsx)(n.p,{children:"\u53EF\u770B\u5230\u6253\u5370\u51FA\u76F8\u540C\u7684\u6807\u7B7E\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'pt_top3_labels = np.argsort(pt_result[0])[::-1][:3]\ntvm_top3_labels = np.argsort(tvm_result[0])[::-1][:3]\n\nprint("PyTorch top3 labels:", [synset[label] for label in pt_top3_labels])\nprint("TVM top3 labels:", [synset[label] for label in tvm_top3_labels])\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"PyTorch top3 labels: ['tiger cat', 'Egyptian cat', 'tabby, tabby cat']\nTVM top3 labels: ['tiger cat', 'Egyptian cat', 'tabby, tabby cat']\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4F46\u7531\u4E8E\u6570\u5B57\u7684\u5DEE\u5F02\uFF0C\u901A\u5E38\u539F\u59CB\u6D6E\u70B9\u8F93\u51FA\u4E0D\u5E94\u8BE5\u662F\u76F8\u540C\u7684\u3002\u4E0B\u9762\u6253\u5370 mobilenet v2 \u7684 1000 \u4E2A\u8F93\u51FA\u4E2D\uFF0C\u6709\u591A\u5C11\u4E2A\u6D6E\u70B9\u8F93\u51FA\u503C\u662F\u76F8\u540C\u7684\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'print("%d in 1000 raw floating outputs identical." % np.sum(tvm_result[0] == pt_result[0]))\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"154 in 1000 raw floating outputs identical.\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6D4B\u8BD5\u6027\u80FD",children:"\u6D4B\u8BD5\u6027\u80FD"}),"\n",(0,a.jsx)(n.p,{children:"\u4EE5\u4E0B\u4E3E\u4F8B\u8BF4\u660E\u5982\u4F55\u6D4B\u8BD5 TVM \u7F16\u8BD1\u6A21\u578B\u7684\u6027\u80FD\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"n_repeat = 100  # \u4E3A\u4F7F\u6D4B\u8BD5\u66F4\u51C6\u786E\uFF0C\u5E94\u9009\u53D6\u66F4\u5927\u7684\u6570\u503C\ndev = tvm.cpu(0)\nprint(rt_mod.benchmark(dev, number=1, repeat=n_repeat))\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Execution time summary:\n mean (ms)   median (ms)    max (ms)     min (ms)     std (ms)\n  90.3752      90.2667      94.6845      90.0629       0.6087\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.p,{children:"\u63A8\u8350\u8FD9\u79CD\u65B9\u6CD5\u7684\u539F\u56E0\u5982\u4E0B\uFF1A"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u6D4B\u8BD5\u662F\u5728 C++ \u4E2D\u5B8C\u6210\u7684\uFF0C\u56E0\u6B64\u6CA1\u6709 Python \u5F00\u9500\u5927"}),"\n",(0,a.jsx)(n.li,{children:"\u5305\u62EC\u51E0\u4E2A\u51C6\u5907\u5DE5\u4F5C"}),"\n",(0,a.jsx)(n.li,{children:"\u53EF\u7528\u76F8\u540C\u7684\u65B9\u6CD5\u5728\u8FDC\u7A0B\u8BBE\u5907\uFF08Android \u7B49\uFF09\u4E0A\u8FDB\u884C\u5206\u6790\u3002"}),"\n"]})]}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.p,{children:"\u5982\u679C\u786C\u4EF6\u5BF9\xa0INT8 \u6574\u6570\u7684\u6307\u4EE4\u6CA1\u6709\u7279\u6B8A\u652F\u6301\uFF0C\u91CF\u5316\u6A21\u578B\u4E0E FP32 \u6A21\u578B\u901F\u5EA6\u76F8\u8FD1\u3002\u5982\u679C\u6CA1\u6709\xa0INT8 \u6574\u6570\u7684\u6307\u4EE4\uFF0CTVM \u4F1A\u4EE5 16 \u4F4D\u8FDB\u884C\u91CF\u5316\u5377\u79EF\uFF0C\u5373\u4F7F\u6A21\u578B\u672C\u8EAB\u662F 8 \u4F4D\u3002"}),(0,a.jsx)(n.p,{children:"\u5BF9\u4E8E x86\uFF0C\u5728\u5177\u6709 AVX512 \u6307\u4EE4\u96C6\u7684 CPU \u4E0A\u53EF\u5B9E\u73B0\u6700\u4F73\u6027\u80FD\u3002\u8FD9\u79CD\u60C5\u51B5 TVM \u5BF9\u7ED9\u5B9A target \u4F7F\u7528\u6700\u5FEB\u7684\u53EF\u7528 8 \u4F4D\u6307\u4EE4\uFF0C\u5305\u62EC\u5BF9 VNNI 8 \u4F4D\u70B9\u79EF\u6307\u4EE4\uFF08CascadeLake \u6216\u66F4\u65B0\u7248\u672C\uFF09\u7684\u652F\u6301\u3002"}),(0,a.jsx)(n.p,{children:"\u6B64\u5916\uFF0C\u4EE5\u4E0B\u4E00\u822C\u6280\u5DE7\u5BF9 CPU \u6027\u80FD\u7684\u63D0\u5347\u540C\u6837\u9002\u7528\uFF1A"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u5C06\u73AF\u5883\u53D8\u91CF TVM_NUM_THREADS \u8BBE\u7F6E\u4E3A\u7269\u7406 core \u7684\u6570\u91CF"}),"\n",(0,a.jsx)(n.li,{children:'\u4E3A\u786C\u4EF6\u9009\u62E9\u6700\u4F73 target\uFF0C\u4F8B\u5982 "llvm -mcpu=skylake-avx512" \u6216 "llvm -mcpu=cascadelake"\uFF08\u672A\u6765\u4F1A\u6709\u66F4\u591A\u652F\u6301 AVX512 \u7684 CPU\uFF09'}),"\n"]})]}),"\n",(0,a.jsx)(n.h2,{id:"\u90E8\u7F72\u91CF\u5316\u7684-mxnet-\u6A21\u578B",children:"\u90E8\u7F72\u91CF\u5316\u7684 MXNet \u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u5F85\u66F4\u65B0"}),"\n",(0,a.jsx)(n.h2,{id:"\u90E8\u7F72\u91CF\u5316\u7684-tflite-\u6A21\u578B",children:"\u90E8\u7F72\u91CF\u5316\u7684 TFLite \u6A21\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u5F85\u66F4\u65B0"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u811A\u672C\u603B\u8FD0\u884C\u65F6\u957F\uFF1A"}),"\uFF081 \u5206 7.374 \u79D2\uFF09"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://tvm.apache.org/docs/_downloads/fb8217c13f4351224c6cf3aacf1a87fc/deploy_prequantized.py",children:"\u4E0B\u8F7D Python \u6E90\u4EE3\u7801\uFF1Adeploy_prequantized.py"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://tvm.apache.org/docs/_downloads/c20f81a94729f461f33b52cc110fd9d6/deploy_prequantized.ipynb",children:"\u4E0B\u8F7D Jupyter Notebook\uFF1Adeploy_prequantized.ipynb"})})]})}function p(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},21494:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return l}});var r=t(39546);let a={},o=r.createContext(a);function l(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);