"use strict";(self.webpackChunktvm_cn=self.webpackChunktvm_cn||[]).push([["71464"],{28368:function(e,c,r){r.r(c),r.d(c,{default:()=>h,frontMatter:()=>t,metadata:()=>n,assets:()=>l,toc:()=>a,contentTitle:()=>s});var n=JSON.parse('{"id":"arch/arch/device_target_interactions","title":"\u8BBE\u5907/Target \u4EA4\u4E92","description":"\u672C\u6587\u6863\u9002\u7528\u4E8E\u6709\u5174\u8DA3\u4E86\u89E3 TVM \u6846\u67B6\u5982\u4F55\u4E0E\u7279\u5B9A\u8BBE\u5907 API \u4EA4\u4E92\u7684\u5F00\u53D1\u8005\uFF0C\u6216\u5E0C\u671B\u5B9E\u73B0\u5BF9\u65B0 API \u6216\u65B0\u786C\u4EF6\u7684\u652F\u6301\u7684\u5F00\u53D1\u8005\u3002","source":"@site/versioned_docs/version-0.12.0/arch/arch/05-device_target_interactions.md","sourceDirName":"arch/arch","slug":"/arch/arch/device_target_interactions","permalink":"/docs/tvm-cn/docs/0.12.0/arch/arch/device_target_interactions","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperai/tvm-cn/edit/master/versioned_docs/version-0.12.0/arch/arch/05-device_target_interactions.md","tags":[],"version":"0.12.0","lastUpdatedBy":"sparanoid","lastUpdatedAt":1744717810000,"sidebarPosition":150,"frontMatter":{"title":"\u8BBE\u5907/Target \u4EA4\u4E92","sidebar_position":150},"sidebar":"tutorialSidebar","previous":{"title":"\u6A21\u5757\u5E8F\u5217\u5316\u7B80\u4ECB","permalink":"/docs/tvm-cn/docs/0.12.0/arch/arch/introduction_to_module_serialization"},"next":{"title":"Pass Infrastructure","permalink":"/docs/tvm-cn/docs/0.12.0/arch/arch/pass_infra"}}'),i=r("74132"),d=r("21494");let t={title:"\u8BBE\u5907/Target \u4EA4\u4E92",sidebar_position:150},s="\u8BBE\u5907/Target \u4EA4\u4E92",l={},a=[{value:"DeviceAPI",id:"deviceapi",level:2},{value:"Target \u5B9A\u4E49",id:"target-\u5B9A\u4E49",level:2},{value:"Target \u4EE3\u7801\u751F\u6210\u5668",id:"target-\u4EE3\u7801\u751F\u6210\u5668",level:2}];function o(e){let c={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,d.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.header,{children:(0,i.jsx)(c.h1,{id:"\u8BBE\u5907target-\u4EA4\u4E92",children:"\u8BBE\u5907/Target \u4EA4\u4E92"})}),"\n",(0,i.jsx)(c.p,{children:"\u672C\u6587\u6863\u9002\u7528\u4E8E\u6709\u5174\u8DA3\u4E86\u89E3 TVM \u6846\u67B6\u5982\u4F55\u4E0E\u7279\u5B9A\u8BBE\u5907 API \u4EA4\u4E92\u7684\u5F00\u53D1\u8005\uFF0C\u6216\u5E0C\u671B\u5B9E\u73B0\u5BF9\u65B0 API \u6216\u65B0\u786C\u4EF6\u7684\u652F\u6301\u7684\u5F00\u53D1\u8005\u3002"}),"\n",(0,i.jsx)(c.p,{children:"\u6240\u6709\u65B0\u7684 runtime \u73AF\u5883\u90FD\u5FC5\u987B\u5B9E\u73B0\u7684\u4E09\u4E2A\u4E3B\u8981\u65B9\u9762\uFF1A"}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.a,{href:"#tvm-target-specific-device-api",children:"DeviceAPI"})," \u7C7B\u4E3A\u7279\u5B9A\u8BBE\u5907\u63D0\u4F9B\u53E5\u67C4\uFF0C\u4EE5\u53CA\u7528\u4E8E\u4E0E\u5176\u4EA4\u4E92\u7684 API\u3002\u5B83\u5B9A\u4E49\u4E86\u4E00\u4E2A\u901A\u7528\u63A5\u53E3\uFF0C\u7528\u4E8E\u67E5\u8BE2\u8BBE\u5907\u53C2\u6570\uFF08\u4F8B\u5982\u53EF\u7528\u5185\u5B58\u3001\u7EBF\u7A0B\u6570\u7B49\uFF09\u548C\u6267\u884C\u7B80\u5355\u64CD\u4F5C\uFF08\u4F8B\u5982\uFF0C\u4ECE\u4E3B\u673A\u590D\u5236\u5185\u5B58\uFF0C\u6216\u5728\u8BBE\u5907\u4E0A\u7684\u7F13\u51B2\u533A\u4E4B\u95F4\u590D\u5236\uFF09\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.a,{href:"#tvm-target-specific-target",children:"Target"})," \u7C7B\u63CF\u8FF0\u4E86\u8FD0\u884C\u51FD\u6570\u7684\u8BBE\u5907\u3002\u5B83\u65E2\u5BF9 target \u4EE3\u7801\u751F\u6210\u5668\u516C\u5F00\uFF0C\u4E5F\u5BF9\u4F18\u5316 pass \u516C\u5F00\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.a,{href:"#tvm-target-specific-codegen",children:"target \u4EE3\u7801\u751F\u6210\u5668"})," \u4ECE IRModule \u6784\u9020\u4E86\u4E00\u4E2A ",(0,i.jsx)(c.a,{href:"/docs/arch/arch/runtimes#module",children:"\u6A21\u5757"}),"\uFF0C\u5B83\u7531\u4E00\u4E2A\u6216\u591A\u4E2A ",(0,i.jsx)(c.a,{href:"/docs/arch/arch/runtimes#PackedFunc",children:"PackedFunc"})," \u7EC4\u6210\u3002"]}),"\n"]}),"\n",(0,i.jsx)(c.h2,{id:"deviceapi",children:"DeviceAPI"}),"\n",(0,i.jsxs)(c.p,{children:[(0,i.jsx)(c.code,{children:"DeviceAPI"})," \u8868\u793A\u7279\u5B9A\u786C\u4EF6\u8BBE\u5907 API \u7684\u53E5\u67C4\u3002\uFF08\u4F8B\u5982\uFF0C",(0,i.jsx)(c.code,{children:"CUDADeviceAPI"})," \u901A\u8FC7 CUDA \u6846\u67B6\u5904\u7406\u6240\u6709\u7684\u4EA4\u4E92\u3002\uFF09\u5927\u591A\u6570 ",(0,i.jsx)(c.code,{children:"DeviceAPI"})," \u65B9\u6CD5\u63A5\u6536\u4E00\u4E2A ",(0,i.jsx)(c.code,{children:"device_id"})," \u53C2\u6570\uFF0C\u6765\u6307\u5B9A\u8BBF\u95EE\u54EA\u4E2A\u8BBE\u5907\u3002Python \u4E2D\u901A\u5E38\u7528 ",(0,i.jsx)(c.code,{children:"tvm.runtime.device()"})," \u51FD\u6570\u8BBF\u95EE\u5B83\u4EEC\uFF0C\u8FD9\u4E2A\u51FD\u6570\u8FD4\u56DE\u7279\u5B9A\u8BBE\u5907\u7684\u53E5\u67C4\uFF0C\u901A\u8FC7\u7279\u5B9A API \u8BBF\u95EE\u3002\uFF08\u4F8B\u5982\uFF0C",(0,i.jsx)(c.code,{children:"tvm.runtime.device()"})," \u901A\u8FC7 CUDA API \u8BBF\u95EE\u7269\u7406\u8BBE\u5907 ",(0,i.jsx)(c.code,{children:"0"}),"\u3002\uFF09"]}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsxs)(c.p,{children:["\u5C5E\u6027\u67E5\u8BE2 - ",(0,i.jsx)(c.code,{children:"GetAttr"})," \u5141\u8BB8\u67E5\u8BE2\u4E0D\u540C\u7684\u8BBE\u5907\u7279\u5B9A\u7684\u53C2\u6570\uFF0C\u4F8B\u5982\u8BBE\u5907\u540D\u79F0\u3001\u7EBF\u7A0B\u6570\u7B49\u3002",(0,i.jsx)(c.a,{href:"https://github.com/apache/tvm/blob/main/include/tvm/runtime/device_api.h",children:"device_api.h"})," \u4E2D\u7684 ",(0,i.jsx)(c.code,{children:"enum DeviceAttrKind"})," \u5B9A\u4E49\u4E86\u53EF\u4EE5\u67E5\u8BE2\u7684\u53C2\u6570\u3002\u6709\u4E9B\u8BBE\u5907\u4E0D\u652F\u6301\u90E8\u5206\u53EF\u67E5\u8BE2\u53C2\u6570\u3002\u82E5\u65E0\u6CD5\u67E5\u8BE2\u67D0\u4E2A\u53C2\u6570\uFF08\u4F8B\u5982 Vulkan \u4E0A\u7684 ",(0,i.jsx)(c.code,{children:"kMaxClockRate"}),"\uFF09\uFF0C\u6216\u8005\u67D0\u4E2A\u53C2\u6570\u4E0D\u9002\u7528\uFF08\u4F8B\u5982 CPU \u4E0A\u7684 ",(0,i.jsx)(c.code,{children:"kWarpSize"}),"\uFF09\uFF0C\u90A3\u4E48\u67E5\u8BE2\u8FD4\u56DE ",(0,i.jsx)(c.code,{children:"nullptr"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsxs)(c.p,{children:["\u8BBE\u7F6E\u6D3B\u52A8\u8BBE\u5907 - ",(0,i.jsx)(c.code,{children:"SetDevice"})," \u5E94\u5C06\u67D0\u4E2A\u7279\u5B9A\u8BBE\u5907\u8BBE\u4E3A\u6D3B\u52A8\u8BBE\u5907\u3002\u82E5\u8981\u5728\u8BBE\u5907\u4E0A\u6267\u884C target \u7279\u5B9A\u7684 codegen \u751F\u6210\u7684 ",(0,i.jsx)(c.code,{children:"PackedFunc"})," \uFF0C\u5E94\u8BE5\u5728\u6D3B\u52A8\u8BBE\u5907\u4E0A\u8FD0\u884C\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsx)(c.p,{children:"\u5185\u5B58\u7BA1\u7406 - \u7528\u4E8E\u5728\u8BBE\u5907\u4E0A\u5206\u914D\u548C\u91CA\u653E\u5185\u5B58\u7684\u7A0B\u5E8F\u3002"}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:["\u5206\u914D\u6570\u636E\u7A7A\u95F4 - ",(0,i.jsx)(c.code,{children:"AllocDataSpace"})," \u548C ",(0,i.jsx)(c.code,{children:"FreeDataSpace"})," \u5728\u8BBE\u5907\u4E0A\u5206\u914D\u548C\u91CA\u653E\u7A7A\u95F4\u3002\u8FD9\u4E9B\u5206\u914D\u53EF\u4EE5\u4F5C\u4E3A\u8F93\u5165\u548C\u8F93\u51FA\u63D0\u4F9B\u7ED9\u7B97\u5B50\uFF0C\u5E76\u6784\u6210\u7B97\u5B50\u8BA1\u7B97\u56FE\u7684\u4E3B\u8981\u6570\u636E\u6D41\u3002\u5B83\u4EEC\u5FC5\u987B\u80FD\u591F\u5728\u4E3B\u673A\u548C\u6570\u636E\u7A7A\u95F4\u4E4B\u95F4\u4F20\u8F93\u6570\u636E\u3002\u8FD4\u56DE\u503C\u662F\u4E00\u4E2A\u4E0D\u900F\u660E\u7684 ",(0,i.jsx)(c.code,{children:"void*"}),"\u3002\u867D\u7136\u67D0\u4E9B\u5B9E\u73B0\u8FD4\u56DE\u4E00\u4E2A\u5185\u5B58\u5730\u5740\uFF0C\u4F46\u8FD9\u4E0D\u662F\u5FC5\u9700\u7684\uFF0C\u5E76\u4E14 ",(0,i.jsx)(c.code,{children:"void*"})," \u53EF\u80FD\u662F\u4E0D\u900F\u660E\u53E5\u67C4\uFF0C\u53EA\u80FD\u7531\u751F\u6210\u5B83\u7684\u8BBE\u5907\u540E\u7AEF\u89E3\u91CA\u3002 ",(0,i.jsx)(c.code,{children:"void*"})," \u7528\u4F5C\u5176\u4ED6\u540E\u7AEF\u7279\u5B9A\u7684\u51FD\u6570\u7684\u53C2\u6570\uFF0C\u4F8B\u5982 ",(0,i.jsx)(c.code,{children:"CopyDataFromTo"}),"\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:["\u5206\u914D\u5DE5\u4F5C\u7A7A\u95F4 - ",(0,i.jsx)(c.code,{children:"AllocWorkspace"})," \u548C ",(0,i.jsx)(c.code,{children:"FreeWorkspace"})," \u5728\u8BBE\u5907\u4E0A\u5206\u914D\u548C\u91CA\u653E\u7A7A\u95F4\u3002\u4E0D\u540C\u4E8E\u6570\u636E\u7A7A\u95F4\uFF0C\u5B83\u4EEC\u7528\u4E8E\u5B58\u50A8\u7B97\u5B50\u5B9A\u4E49\u4E2D\u7684\u4E2D\u95F4\u503C\uFF0C\u5E76\u4E14\u4E0D\u9700\u8981\u4F20\u8F93\u5230\u4E3B\u673A\u8BBE\u5907\uFF0C\u6216\u4ECE\u4E3B\u673A\u8BBE\u5907\u4F20\u8F93\u3002\u82E5 ",(0,i.jsx)(c.code,{children:"DeviceAPI"})," \u5B50\u7C7B\u6CA1\u6709\u5B9E\u73B0\u8FD9\u4E9B\u65B9\u6CD5\uFF0C\u5B83\u4EEC\u4F1A\u9ED8\u8BA4\u8C03\u7528\u76F8\u5E94\u7684 ",(0,i.jsx)(c.code,{children:"DataSpace"})," \u51FD\u6570\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:["\u590D\u5236\u6570\u636E - ",(0,i.jsx)(c.code,{children:"CopyDataFromTo"})," \u5E94\u8BE5\u5C06\u6570\u636E\u4ECE\u4E00\u4E2A\u4F4D\u7F6E\u590D\u5236\u5230\u53E6\u4E00\u4E2A\u4F4D\u7F6E\u3002\u526F\u672C\u7684\u7C7B\u578B\u7531 ",(0,i.jsx)(c.code,{children:"dev_from"})," \u548C ",(0,i.jsx)(c.code,{children:"dev_to"})," \u53C2\u6570\u786E\u5B9A\u3002\u5B9E\u73B0\u5E94\u652F\u6301\u5728\u5355\u4E2A\u8BBE\u5907\u4E0A\u5C06\u5185\u5B58\u4ECE CPU \u590D\u5236\u5230\u8BBE\u5907\u3001\u4ECE\u8BBE\u5907\u590D\u5236\u5230 CPU\uFF0C\u4EE5\u53CA\u4ECE\u4E00\u4E2A\u7F13\u51B2\u533A\u590D\u5236\u5230\u53E6\u4E00\u4E2A\u7F13\u51B2\u533A\u3002\u82E5\u6E90\u4F4D\u7F6E\u6216\u76EE\u6807\u4F4D\u7F6E\u5728 CPU \u4E0A\uFF0C\u5219\u5BF9\u5E94\u7684 ",(0,i.jsx)(c.code,{children:"void*"})," \u6307\u5411\u4E00\u4E2A CPU \u5730\u5740\uFF0C\u8FD9\u4E2A\u5730\u5740\u53EF\u4EE5\u4F20\u9012\u7ED9 ",(0,i.jsx)(c.code,{children:"memcpy"}),"\u3002\u82E5\u6E90\u4F4D\u7F6E\u6216\u76EE\u6807\u4F4D\u7F6E\u5728\u8BBE\u5907\u4E0A\uFF0C\u5219\u76F8\u5E94\u7684 ",(0,i.jsx)(c.code,{children:"void*"})," \u4E4B\u524D\u5DF2\u7531 ",(0,i.jsx)(c.code,{children:"AllocDataSpace"})," \u6216 ",(0,i.jsx)(c.code,{children:"AllocWorkspace"})," \u751F\u6210\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(c.p,{children:["\u8FD9\u4E9B\u526F\u672C\u6392\u961F\u7B49\u5F85\u5728\u7279\u5B9A\u7684 ",(0,i.jsx)(c.code,{children:"TVMStreamHandle"})," \u4E0A\u6267\u884C\u3002\u4F46\u662F\uFF0C\u8BE5\u5B9E\u73B0\u4E0D\u5E94\u8BE5\u5047\u5B9A\u5728 ",(0,i.jsx)(c.code,{children:"CopyDataFromTo"})," \u8C03\u7528\u5B8C\u6210\u540E\uFF0CCPU \u7F13\u51B2\u533A\u4ECD\u7136\u6709\u6548\u6216\u53EF\u8BBF\u95EE\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsxs)(c.p,{children:["\u6267\u884C\u6D41\u7BA1\u7406 - \u7528\u4E8E\u5904\u7406 ",(0,i.jsx)(c.code,{children:"TVMStreamHandle"})," \u7684\u7A0B\u5E8F\uFF0C\u5B83\u8868\u793A\u7528\u4E8E\u6267\u884C\u547D\u4EE4\u7684\u5E76\u884C\u6267\u884C\u6D41\u3002"]}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:["\u521B\u5EFA\u6D41 - ",(0,i.jsx)(c.code,{children:"CreateStream"})," \u548C ",(0,i.jsx)(c.code,{children:"FreeStream"})," \u4E3A\u6267\u884C\u6D41\u5206\u914D/\u91CA\u653E\u53E5\u67C4\u3002\u82E5\u8BBE\u5907\u4EC5\u5B9E\u73B0\u4E00\u4E2A\u547D\u4EE4\u961F\u5217\uFF0C\u5219 ",(0,i.jsx)(c.code,{children:"CreateStream"})," \u8FD4\u56DE ",(0,i.jsx)(c.code,{children:"nullptr"}),"\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:["\u8BBE\u7F6E\u6D3B\u52A8\u6D41 - ",(0,i.jsx)(c.code,{children:"SetStream"})," \u5C06\u6D41\u8BBE\u7F6E\u4E3A\u6D3B\u52A8\u7684\u3002\u5728\u6D3B\u52A8\u671F\u95F4\uFF0C\u82E5\u7279\u5B9A\u4E8E target \u7684 code gen \u751F\u6210\u7684 ",(0,i.jsx)(c.code,{children:"PackedFunc"})," \u9700\u8981\u5728\u8BBE\u5907\u4E0A\u6267\u884C\uFF0C\u5219\u5E94\u5C06\u5DE5\u4F5C\u63D0\u4EA4\u5230\u6D3B\u52A8\u6D41\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:["\u540C\u6B65\u5230 CPU - ",(0,i.jsx)(c.code,{children:"StreamSync"})," \u5C06\u6267\u884C\u6D41\u540C\u6B65\u5230 CPU\u3002",(0,i.jsx)(c.code,{children:"StreamSync"})," \u8C03\u7528\u4E00\u6B21\u6027\u8FD4\u56DE\u6240\u6709\u7684\u5185\u5B58\u8F6C\u6362\uFF0C\u4EE5\u53CA\u5728\u8C03\u7528\u5B8C\u6210\u524D\u63D0\u4EA4\u7684\u8BA1\u7B97\u3002"]}),"\n",(0,i.jsxs)(c.li,{children:["\u5728\u6D41\u4E4B\u95F4\u540C\u6B65 - ",(0,i.jsx)(c.code,{children:"SyncStreamFromTo"})," \u5728\u6E90\u6D41\u548C\u76EE\u6807\u6D41\u4E4B\u95F4\u5F15\u5165\u540C\u6B65\u5C4F\u969C\uFF08synchronization barrier\uFF09\u3002\u5373\u5728\u6E90\u6D41\u5B8C\u6210\u5F53\u524D\u6392\u961F\u7684\u6240\u6709\u547D\u4EE4\u524D\uFF0C\u76EE\u6807\u6D41\u4E0D\u4F1A\u8D85\u51FA\u5F53\u524D\u6392\u961F\u7684\u547D\u4EE4\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(c.p,{children:"TVM \u6846\u67B6\u82E5\u8981\u4F7F\u7528\u65B0\u7684 DeviceAPI\uFF0C\u5E94\u8BE5\u6309\u7167\u4EE5\u4E0B\u6B65\u9AA4\u6CE8\u518C\uFF1A"}),"\n",(0,i.jsxs)(c.ol,{children:["\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsx)(c.p,{children:"\u521B\u5EFA\u4E00\u4E2A\u51FD\u6570\uFF0C\u5B83\u5B9E\u4F8B\u5316\u65B0 DeviceAPI\uFF0C\u5E76\u8FD4\u56DE\u4E00\u4E2A\u6307\u5411\u5B83\u7684\u6307\u9488\uFF1A"}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-c++",children:"FooDeviceAPI* FooDeviceAPI::Global() {\n  static FooDeviceAPI inst;\n  return &inst;\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsx)(c.p,{children:"\u5C06\u51FD\u6570\u6CE8\u518C\u5230 TVM \u6CE8\u518C\u8868\uFF1A"}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-c++",children:'TVM_REGISTER_GLOBAL("device_api.foo").set_body_typed(FooDeviceAPI::Global);\n'})}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsxs)(c.p,{children:["\u4E3A\u65B0\u7684 DeviceAPI \u6DFB\u52A0\u4E00\u4E2A\u8FDB\u5165 ",(0,i.jsx)(c.a,{href:"https://github.com/apache/tvm/blob/main/include/tvm/runtime/c_runtime_api.h",children:"c_runtime_api.h"})," \u4E2D\u7684 ",(0,i.jsx)(c.code,{children:"TVMDeviceExtType"})," \u679A\u4E3E\u7684\u5165\u53E3\u3002\u8BE5\u503C\u662F\u4E00\u4E2A\u672A\u4F7F\u7528\u503C\uFF0C\u5B83\u5927\u4E8E ",(0,i.jsx)(c.code,{children:"DLDeviceType::kDLExtDev"}),"\uFF0C\u4F46\u5C0F\u4E8E ",(0,i.jsx)(c.code,{children:"DeviceAPIManager::kMaxDeviceAPI"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsxs)(c.p,{children:["\u7ED9 ",(0,i.jsx)(c.a,{href:"https://github.com/apache/tvm/blob/main/include/tvm/runtime/device_api.h",children:"device_api.h"})," \u4E2D\u7684 ",(0,i.jsx)(c.code,{children:"DeviceName"})," \u6DFB\u52A0\u4E00\u4E2A\u6848\u4F8B\uFF0C\u4ECE\u800C\u5C06\u679A\u4E3E\u503C\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\u8868\u793A\u5F62\u5F0F\u3002\u8FD9\u4E2A\u5B57\u7B26\u4E32\u8868\u793A\u5E94\u8BE5\u548C ",(0,i.jsx)(c.code,{children:"TVM_REGISTER_GLOBAL"})," \u7684\u540D\u79F0\u5339\u914D\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(c.li,{children:["\n",(0,i.jsxs)(c.p,{children:["\u5C06\u5165\u53E3\u6DFB\u52A0\u5230 ",(0,i.jsx)(c.code,{children:"tvm.runtime.Device"})," \u7684 ",(0,i.jsx)(c.code,{children:"MASK2STR"})," \u548C ",(0,i.jsx)(c.code,{children:"STR2MASK"})," \u5B57\u5178\uFF0C\u83B7\u53D6\u65B0\u7684\u679A\u4E3E\u503C\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(c.h2,{id:"target-\u5B9A\u4E49",children:"Target \u5B9A\u4E49"}),"\n",(0,i.jsxs)(c.p,{children:[(0,i.jsx)(c.code,{children:"Target"})," \u5BF9\u8C61\u662F\u5C5E\u6027\uFF08\u5305\u542B\u7269\u7406\u8BBE\u5907\u3001\u5176\u786C\u4EF6/\u9A71\u52A8\u7A0B\u5E8F\u9650\u5236\uFF0C\u53CA\u5176\u529F\u80FD\uFF09\u7684\u67E5\u627E\u8868\u3002\u5728\u4F18\u5316\u548C\u4EE3\u7801\u751F\u6210\u9636\u6BB5\u90FD\u53EF\u4EE5\u8BBF\u95EE ",(0,i.jsx)(c.code,{children:"Target"}),"\u3002\u867D\u7136\u76F8\u540C\u7684 ",(0,i.jsx)(c.code,{children:"Target"})," \u7C7B\u9002\u7528\u4E8E\u6240\u6709 runtime target\uFF0C\u4F46\u6BCF\u4E2A runtime target \u53EF\u80FD\u9700\u8981\u6DFB\u52A0\u7279\u5B9A\u4E8E target \u7684\u9009\u9879\u3002"]}),"\n",(0,i.jsxs)(c.p,{children:["\u5728 ",(0,i.jsx)(c.a,{href:"https://github.com/apache/tvm/blob/main/src/target/target_kind.cc",children:"target_kind.cc"})," \u4E2D\uFF0C\u4E3A ",(0,i.jsx)(c.code,{children:"TVM_REGISTER_TARGET_KIND"})," \u6DFB\u52A0\u4E00\u4E2A\u65B0\u7684\u58F0\u660E\uFF0C\u4F20\u9012\u65B0 target \u7684\u5B57\u7B26\u4E32\u540D\u79F0\uFF0C\u4EE5\u53CA\u8BE5 target \u8FD0\u884C\u8BBE\u5907\u7684 ",(0,i.jsx)(c.code,{children:"TVMDeviceExtType"})," \u6216 ",(0,i.jsx)(c.code,{children:"DLDeviceType"})," \u679A\u4E3E\u503C\u3002\u901A\u5E38\uFF0Ctarget \u540D\u79F0\u548C\u8BBE\u5907\u540D\u79F0\u5339\u914D\u3002\uFF08\u4F8B\u5982\uFF0C",(0,i.jsx)(c.code,{children:'"cuda"'})," target \u5728 ",(0,i.jsx)(c.code,{children:"kDLCUDA"})," \u8BBE\u5907\u4E0A\u8FD0\u884C\u3002\uFF09\u4F46\u4E5F\u6709\u4F8B\u5916\uFF0C\u4F8B\u5982\u591A\u4E2A\u4E0D\u540C\u7684\u4EE3\u7801\u751F\u6210 targets \u53EF\u4EE5\u5728\u540C\u4E00\u4E2A\u7269\u7406\u8BBE\u5907\u4E0A\u8FD0\u884C\u3002 \uFF08\u4F8B\u5982\uFF0C",(0,i.jsx)(c.code,{children:'"llvm"'})," \u548C ",(0,i.jsx)(c.code,{children:'"c"'})," targets \u90FD\u5728 ",(0,i.jsx)(c.code,{children:"kDLCPU"})," \u8BBE\u5907\u7C7B\u578B\u4E0A\u8FD0\u884C\u3002\uFF09"]}),"\n",(0,i.jsxs)(c.p,{children:["\u7279\u5B9A target \u79CD\u7C7B\u7684\u6240\u6709\u9009\u9879\u90FD\u4F7F\u7528 ",(0,i.jsx)(c.code,{children:"add_attr_option"})," \u51FD\u6570\u6DFB\u52A0\uFF0C\u5177\u6709\u53EF\u9009\u7684\u9ED8\u8BA4\u503C\u3002\u53EF\u4EE5\u7528 ",(0,i.jsx)(c.code,{children:"set_target_parser"})," \u6765\u6DFB\u52A0 ",(0,i.jsx)(c.em,{children:"Target"}),"  \u89E3\u6790\u5668\uFF0C\u6765\u5904\u7406\u90A3\u4E9B\u52A8\u6001\u57FA\u4E8E\u5176\u4ED6\u53C2\u6570\uFF0C\u6216\u662F\u4ECE\u8BBE\u5907\u5C5E\u6027\u67E5\u8BE2\u5230\u7684\u53C2\u6570\u3002"]}),"\n",(0,i.jsxs)(c.p,{children:["\u8FD9\u4E2A\u53C2\u6570\u5B9A\u4E49\u4E86\u4E00\u4E2A\u89E3\u6790\u5668\uFF0C\u53EF\u4EE5\u89E3\u6790 target \u7684\u5B57\u7B26\u4E32\u63CF\u8FF0\u3002\u8FD9\u662F\u5728 C++ \u7684 ",(0,i.jsx)(c.code,{children:"Target::Target(const String&)"})," \u6784\u9020\u51FD\u6570\u4E2D\u5B9E\u73B0\u7684\uFF0C\u5B83\u63A5\u6536 JSON \u683C\u5F0F\u7684\u5B57\u7B26\u4E32\uFF0C\u901A\u5E38\u7528 ",(0,i.jsx)(c.code,{children:"tvm.target.Target"})," \u8FD9\u4E2A Python \u5BF9\u8C61\u6765\u8C03\u7528\u3002\u4F8B\u5982\uFF0C ",(0,i.jsx)(c.code,{children:'tvm.target.Target(\'{"kind": "cuda", "max_num_threads": 1024}\')'})," \u4F1A\u521B\u5EFA\u4E00\u4E2A ",(0,i.jsx)(c.code,{children:"cuda"})," target\uFF0C\u540C\u65F6\u8986\u76D6\u9ED8\u8BA4\u7684\u6700\u5927\u7EBF\u7A0B\u6570\u3002"]}),"\n",(0,i.jsxs)(c.p,{children:["\u4EE3\u7801\u751F\u6210\u5668\u4E2D\u53EF\u4EE5\u7528 C++ \u4E2D\u7684 ",(0,i.jsx)(c.code,{children:"target->GetAttr<T>(param_name)"}),"\uFF0C\u6216\u662F Python \u4E2D\u7684 ",(0,i.jsx)(c.code,{children:"target.attrs"})," \u5B57\u5178\u6765\u8BBF\u95EE target \u5C5E\u6027\u3002"]}),"\n",(0,i.jsx)(c.h2,{id:"target-\u4EE3\u7801\u751F\u6210\u5668",children:"Target \u4EE3\u7801\u751F\u6210\u5668"}),"\n",(0,i.jsxs)(c.p,{children:["\u4EE3\u7801\u751F\u6210\u5668\u91C7\u7528\u4F18\u5316\u7684 ",(0,i.jsx)(c.code,{children:"IRModule"}),"\uFF0C\u5E76\u5C06\u5176\u8F6C\u6362\u4E3A\u53EF\u6267\u884C\u8868\u793A\u3002\u6BCF\u4E2A\u4EE3\u7801\u751F\u6210\u5668\u6CE8\u518C\u540E\uFF0C\u624D\u80FD\u88AB TVM \u6846\u67B6\u4F7F\u7528\u3002\u8FD9\u662F\u901A\u8FC7\u6CE8\u518C ",(0,i.jsx)(c.code,{children:'"target.build.foo"'})," \u51FD\u6570\u6765\u5B8C\u6210\u7684\uFF0C\u5176\u4E2D ",(0,i.jsx)(c.code,{children:"foo"})," \u4E0E\u4E0A\u9762\u7684 ",(0,i.jsx)(c.code,{children:"TVM_REGISTER_TARGET_KIND"})," \u5B9A\u4E49\u4E2D\u4F7F\u7528\u7684\u540D\u79F0\u76F8\u540C\u3002"]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-c++",children:'tvm::runtime::Module GeneratorFooCode(IRModule mod, Target target);\nTVM_REGISTER_GLOBAL("target.build.foo").set_body_typed(GeneratorFooCode);\n'})}),"\n",(0,i.jsxs)(c.p,{children:["\u4EE3\u7801\u751F\u6210\u5668\u6709\u4E24\u4E2A\u53C2\u6570\uFF1A\u7B2C\u4E00\u4E2A\u662F\u8981\u7F16\u8BD1\u7684 ",(0,i.jsx)(c.code,{children:"IRModule"}),"\uFF0C\u7B2C\u4E8C\u4E2A\u662F\u63CF\u8FF0\u4EE3\u7801\u8981\u5728\u54EA\u4E2A\u8BBE\u5907\u8FD0\u884C\u7684 ",(0,i.jsx)(c.code,{children:"Target"}),"\u53C2\u6570\u3002\u56E0\u4E3A\u6267\u884C\u7F16\u8BD1\u7684\u73AF\u5883\u4E0E\u6267\u884C\u4EE3\u7801\u7684\u73AF\u5883\u4E0D\u4E00\u5B9A\u76F8\u540C\uFF0C\u6240\u4EE5\u4EE3\u7801\u751F\u6210\u5668\u4E0D\u5E94\u8BE5\u5728\u8BBE\u5907\u672C\u8EAB\u4E0A\u6267\u884C\u4EFB\u4F55\u5C5E\u6027\u7684\u67E5\u627E\uFF0C\u800C\u662F\u5E94\u8BE5\u8BBF\u95EE\u5B58\u50A8\u5728 ",(0,i.jsx)(c.code,{children:"Target"})," \u4E2D\u7684\u53C2\u6570\u3002"]}),"\n",(0,i.jsxs)(c.p,{children:["\u8F93\u5165 ",(0,i.jsx)(c.code,{children:"IRModule"})," \u4E2D\u7684\u6BCF\u4E2A\u51FD\u6570\u90FD\u53EF\u4EE5\u5728\u8F93\u51FA ",(0,i.jsx)(c.code,{children:"runtime::Module"})," \u4E2D\u6309\u540D\u79F0\u8BBF\u95EE\u3002"]})]})}function h(e={}){let{wrapper:c}={...(0,d.a)(),...e.components};return c?(0,i.jsx)(c,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},21494:function(e,c,r){r.d(c,{Z:function(){return s},a:function(){return t}});var n=r(39546);let i={},d=n.createContext(i);function t(e){let c=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(c):{...c,...e}},[c,e])}function s(e){let c;return c=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),n.createElement(d.Provider,{value:c},e.children)}}}]);