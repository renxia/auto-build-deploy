"use strict";(self.webpackChunktvm_cn=self.webpackChunktvm_cn||[]).push([["63134"],{1530:function(e,t,n){n.r(t),n.d(t,{default:()=>d,frontMatter:()=>a,metadata:()=>r,assets:()=>s,toc:()=>c,contentTitle:()=>p});var r=JSON.parse('{"id":"how_to/microtvm/micro_mlperftiny","title":"8. \u521B\u5EFA\u4F7F\u7528 microTVM \u7684 MLPerfTiny \u63D0\u4EA4","description":"\u5355\u51FB \u6B64\u5904 \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801","source":"@site/docs/how_to/microtvm/09-micro_mlperftiny.md","sourceDirName":"how_to/microtvm","slug":"/how_to/microtvm/micro_mlperftiny","permalink":"/docs/tvm-cn/docs/how_to/microtvm/micro_mlperftiny","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperai/tvm-cn/edit/master/docs/how_to/microtvm/09-micro_mlperftiny.md","tags":[],"version":"current","lastUpdatedBy":"sparanoid","lastUpdatedAt":1744717810000,"sidebarPosition":9,"frontMatter":{"title":"8. \u521B\u5EFA\u4F7F\u7528 microTVM \u7684 MLPerfTiny \u63D0\u4EA4"},"sidebar":"tutorialSidebar","previous":{"title":"4. microTVM PyTorch \u6559\u7A0B","permalink":"/docs/tvm-cn/docs/how_to/microtvm/micro_pytorch"},"next":{"title":"9. \u5F00\u53D1\u73AF\u5883\u4E2D\u52A0\u5165 microTVM","permalink":"/docs/tvm-cn/docs/how_to/microtvm/micro_custom_ide"}}'),i=n("74132"),o=n("21494");let a={title:"8. \u521B\u5EFA\u4F7F\u7528 microTVM \u7684 MLPerfTiny \u63D0\u4EA4"},p="8. \u521B\u5EFA\u4F7F\u7528 microTVM \u7684 MLPerfTiny \u63D0\u4EA4",s={},c=[{value:"\u5B89\u88C5 microTVM Python \u4F9D\u8D56\u9879",id:"\u5B89\u88C5-microtvm-python-\u4F9D\u8D56\u9879",level:2},{value:"\u5B89\u88C5 Zephyr",id:"\u5B89\u88C5-zephyr",level:2},{value:"\u5B89\u88C5 Install CMSIS-NN",id:"\u5B89\u88C5-install-cmsis-nn",level:2},{value:"\u5BFC\u5165 Python \u4F9D\u8D56",id:"\u5BFC\u5165-python-\u4F9D\u8D56",level:2},{value:"\u5BFC\u5165 Visual Wake Word Model",id:"\u5BFC\u5165-visual-wake-word-model",level:2}];function l(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["\u5355\u51FB ",(0,i.jsx)(t.a,{href:"https://tvm.apache.org/docs/v0.13.0/how_to/work_with_microtvm/micro_mlperftiny.html#sphx-glr-download-how-to-work-with-microtvm-micro-mlperftiny-py",children:"\u6B64\u5904"})," \u4E0B\u8F7D\u5B8C\u6574\u7684\u793A\u4F8B\u4EE3\u7801"]})}),"\n",(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"8-\u521B\u5EFA\u4F7F\u7528-microtvm-\u7684-mlperftiny-\u63D0\u4EA4",children:"8. \u521B\u5EFA\u4F7F\u7528 microTVM \u7684 MLPerfTiny \u63D0\u4EA4"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"\u4F5C\u8005\uFF1A"}),(0,i.jsx)(t.a,{href:"https://github.com/mehrdadh",children:"Mehrdad Hessar"})]}),"\n",(0,i.jsx)(t.p,{children:"\u672C\u6559\u7A0B\u5C55\u793A\u4E86\u5982\u4F55\u4F7F\u7528 microTVM \u6784\u5EFA MLPerfTiny \u63D0\u4EA4\u3002\u8BE5\u6559\u7A0B\u6F14\u793A\u4E86\u4ECE MLPerfTiny \u57FA\u51C6\u6A21\u578B\u4E2D\u5BFC\u5165\u4E00\u4E2A TFLite \u6A21\u578B\uFF0C\u4F7F\u7528 TVM \u8FDB\u884C\u7F16\u8BD1\uFF0C\u5E76\u751F\u6210\u4E00\u4E2A\u53EF\u4EE5\u5237\u5199\u5230\u652F\u6301 Zephyr \u7684\u677F\u4E0A\u7684 Zephyr \u9879\u76EE\uFF0C\u4EE5\u4F7F\u7528 EEMBC runner \u5BF9\u6A21\u578B\u8FDB\u884C\u57FA\u51C6\u6D4B\u8BD5\u7684\u6B65\u9AA4\u3002"}),"\n",(0,i.jsx)(t.h2,{id:"\u5B89\u88C5-microtvm-python-\u4F9D\u8D56\u9879",children:"\u5B89\u88C5 microTVM Python \u4F9D\u8D56\u9879"}),"\n",(0,i.jsx)(t.p,{children:"TVM \u4E0D\u5305\u542B\u7528\u4E8E Python \u4E32\u884C\u901A\u4FE1\u7684\u8F6F\u4EF6\u5305\uFF0C\u56E0\u6B64\u5728\u4F7F\u7528 microTVM \u4E4B\u524D\uFF0C\u6211\u4EEC\u5FC5\u987B\u5B89\u88C5\u5B83\u3002\u6211\u4EEC\u8FD8\u9700\u8981 TFLite \u6765\u52A0\u8F7D\u6A21\u578B\u3002"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"pip install pyserial==3.5 tflite==2.1\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"import os\nimport pathlib\nimport tarfile\nimport tempfile\nimport shutil\n"})}),"\n",(0,i.jsx)(t.h2,{id:"\u5B89\u88C5-zephyr",children:"\u5B89\u88C5 Zephyr"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'# \u5B89\u88C5 west \u548C ninja\npython3 -m pip install west\napt-get install -y ninja-build\n\n# \u5B89\u88C5 ZephyrProject\nZEPHYR_PROJECT_PATH="/content/zephyrproject"\nexport ZEPHYR_BASE=${ZEPHYR_PROJECT_PATH}/zephyr\nwest init ${ZEPHYR_PROJECT_PATH}\ncd ${ZEPHYR_BASE}\ngit checkout v3.2-branch\ncd ..\nwest update\nwest zephyr-export\nchmod -R o+w ${ZEPHYR_PROJECT_PATH}\n\n# \u5B89\u88C5 Zephyr SDK\ncd /content\nZEPHYR_SDK_VERSION="0.15.2"\nwget "https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v${ZEPHYR_SDK_VERSION}/zephyr-sdk-${ZEPHYR_SDK_VERSION}_linux-x86_64.tar.gz"\ntar xvf "zephyr-sdk-${ZEPHYR_SDK_VERSION}_linux-x86_64.tar.gz"\nmv "zephyr-sdk-${ZEPHYR_SDK_VERSION}" zephyr-sdk\nrm "zephyr-sdk-${ZEPHYR_SDK_VERSION}_linux-x86_64.tar.gz"\n\n# \u5B89\u88C5 Python \u4F9D\u8D56\u9879\npython3 -m pip install -r "${ZEPHYR_BASE}/scripts/requirements.txt"\n\n'})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"\u6CE8\u610F"}),"\uFF1A\u4EC5\u5728\u60A8\u6709\u610F\u4F7F\u7528 CMSIS-NN \u4EE3\u7801\u751F\u6210\u5668\u751F\u6210\u6B64\u63D0\u4EA4\u65F6\u5B89\u88C5 CMSIS-NN\u3002"]}),"\n",(0,i.jsx)(t.h2,{id:"\u5B89\u88C5-install-cmsis-nn",children:"\u5B89\u88C5 Install CMSIS-NN"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'CMSIS_SHA="51263182d16c92649a48144ba56c0945f9fce60e"\nCMSIS_URL="http://github.com/ARM-software/CMSIS_5/archive/${CMSIS_SHA}.tar.gz"\nexport CMSIS_PATH=/content/cmsis\nDOWNLOAD_PATH="/content/${CMSIS_SHA}.tar.gz"\nmkdir ${CMSIS_PATH}\nwget ${CMSIS_URL} -O "${DOWNLOAD_PATH}"\ntar -xf "${DOWNLOAD_PATH}" -C ${CMSIS_PATH} --strip-components=1\nrm ${DOWNLOAD_PATH}\n\nCMSIS_NN_TAG="v4.0.0"\nCMSIS_NN_URL="https://github.com/ARM-software/CMSIS-NN.git"\ngit clone ${CMSIS_NN_URL} --branch ${CMSIS_NN_TAG} --single-branch ${CMSIS_PATH}/CMSIS-NN\n\n'})}),"\n",(0,i.jsx)(t.h2,{id:"\u5BFC\u5165-python-\u4F9D\u8D56",children:"\u5BFC\u5165 Python \u4F9D\u8D56"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"import tensorflow as tf\nimport numpy as np\n\nimport tvm\nfrom tvm import relay\nfrom tvm.relay.backend import Executor, Runtime\nfrom tvm.contrib.download import download_testdata\nfrom tvm.micro import export_model_library_format\nimport tvm.micro.testing\nfrom tvm.micro.testing.utils import (\n    create_header_file,\n    mlf_extract_workspace_size_bytes,\n)\n\n"})}),"\n",(0,i.jsx)(t.h2,{id:"\u5BFC\u5165-visual-wake-word-model",children:"\u5BFC\u5165 Visual Wake Word Model"}),"\n",(0,i.jsxs)(t.p,{children:["\u9996\u5148\uFF0C\u4ECE MLPerfTiny \u4E0B\u8F7D\u5E76\u5BFC\u5165 Visual Wake Word (VWW) TFLite \u6A21\u578B\u3002\u8BE5\u6A21\u578B\u6700\u521D\u6765\u81EA ",(0,i.jsx)(t.a,{href:"https://github.com/mlcommons/tiny",children:"MLPerf Tiny \u4ED3\u5E93"}),"\u3002\u6211\u4EEC\u8FD8\u6355\u83B7\u4E86\u6765\u81EA TFLite \u6A21\u578B\u7684\u5143\u6570\u636E\u4FE1\u606F\uFF0C\u5982\u8F93\u5165/\u8F93\u51FA\u540D\u79F0\u3001\u91CF\u5316\u53C2\u6570\u7B49\uFF0C\u8FD9\u4E9B\u4FE1\u606F\u5C06\u5728\u63A5\u4E0B\u6765\u7684\u6B65\u9AA4\u4E2D\u4F7F\u7528\u3002"]}),"\n",(0,i.jsx)(t.p,{children:"\u6211\u4EEC\u4F7F\u7528\u7D22\u5F15\u6765\u6784\u5EFA\u5404\u79CD\u6A21\u578B\u7684\u63D0\u4EA4\u3002\u7D22\u5F15\u5B9A\u4E49\u5982\u4E0B\uFF1A\u8981\u6784\u5EFA\u53E6\u4E00\u4E2A\u6A21\u578B\uFF0C\u60A8\u9700\u8981\u66F4\u65B0\u6A21\u578B URL\u3001\u7B80\u77ED\u540D\u79F0\u548C\u7D22\u5F15\u53F7\u3002"}),"\n",(0,i.jsx)(t.p,{children:"\u5173\u952E\u8BCD\u8BC6\u522B\uFF08KWS\uFF091"}),"\n",(0,i.jsx)(t.p,{children:"\u89C6\u89C9\u5524\u9192\u8BCD\uFF08VWW\uFF092"}),"\n",(0,i.jsx)(t.p,{children:"\u5F02\u5E38\u68C0\u6D4B\uFF08AD\uFF093"}),"\n",(0,i.jsx)(t.p,{children:"\u56FE\u50CF\u5206\u7C7B\uFF08IC\uFF094"}),"\n",(0,i.jsx)(t.p,{children:"\u5982\u679C\u60A8\u60F3\u8981\u4F7F\u7528 CMSIS-NN \u6784\u5EFA\u63D0\u4EA4\uFF0C\u8BF7\u4FEE\u6539 USE_CMSIS \u73AF\u5883\u53D8\u91CF\u3002"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"export USE_CMSIS=1\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'MODEL_URL = "https://github.com/mlcommons/tiny/raw/bceb91c5ad2e2deb295547d81505721d3a87d578/benchmark/training/visual_wake_words/trained_models/vww_96_int8.tflite"\nMODEL_PATH = download_testdata(MODEL_URL, "vww_96_int8.tflite", module="model")\n\nMODEL_SHORT_NAME = "VWW"\nMODEL_INDEX = 2\n\nUSE_CMSIS = os.environ.get("TVM_USE_CMSIS", False)\n\ntflite_model_buf = open(MODEL_PATH, "rb").read()\ntry:\n    import tflite\n\n    tflite_model = tflite.Model.GetRootAsModel(tflite_model_buf, 0)\nexcept AttributeError:\n    import tflite.Model\n\n    tflite_model = tflite.Model.Model.GetRootAsModel(tflite_model_buf, 0)\n\ninterpreter = tf.lite.Interpreter(model_path=str(MODEL_PATH))\ninterpreter.allocate_tensors()\ninput_details = interpreter.get_input_details()\noutput_details = interpreter.get_output_details()\n\ninput_name = input_details[0]["name"]\ninput_shape = tuple(input_details[0]["shape"])\ninput_dtype = np.dtype(input_details[0]["dtype"]).name\noutput_name = output_details[0]["name"]\noutput_shape = tuple(output_details[0]["shape"])\noutput_dtype = np.dtype(output_details[0]["dtype"]).name\n\n# \u4ECE TFLite \u6A21\u578B\u4E2D\u63D0\u53D6\u91CF\u5316\u4FE1\u606F\u3002\n# \u9664\u4E86\u5F02\u5E38\u68C0\u6D4B\u6A21\u578B\u5916\uFF0C\u6240\u6709\u5176\u4ED6\u6A21\u578B\u90FD\u9700\u8981\u8FD9\u6837\u505A\uFF0C\n# \u56E0\u4E3A\u5BF9\u4E8E\u5176\u4ED6\u6A21\u578B\uFF0C\u6211\u4EEC\u4ECE\u4E3B\u673A\u53D1\u9001\u91CF\u5316\u6570\u636E\u5230\u89E3\u91CA\u5668\uFF0C\n# \u7136\u800C\uFF0C\u5BF9\u4E8E\u5F02\u5E38\u68C0\u6D4B\u6A21\u578B\uFF0C\u6211\u4EEC\u53D1\u9001\u6D6E\u70B9\u6570\u636E\uFF0C\u91CF\u5316\u4FE1\u606F\n# \u5728\u5FAE\u63A7\u5236\u5668\u4E0A\u8FDB\u884C\u3002\nif MODEL_SHORT_NAME != "AD":\n    quant_output_scale = output_details[0]["quantization_parameters"]["scales"][0]\n    quant_output_zero_point = output_details[0]["quantization_parameters"]["zero_points"][0]\n\nrelay_mod, params = relay.frontend.from_tflite(\n    tflite_model, shape_dict={input_name: input_shape}, dtype_dict={input_name: input_dtype}\n)\n\n'})}),"\n",(0,i.jsx)(t.h1,{id:"\u5B9A\u4E49\u76EE\u6807\u8FD0\u884C\u65F6\u548C\u6267\u884C\u5668",children:"\u5B9A\u4E49\u76EE\u6807\u3001\u8FD0\u884C\u65F6\u548C\u6267\u884C\u5668"}),"\n",(0,i.jsx)(t.p,{children:"\u73B0\u5728\u6211\u4EEC\u9700\u8981\u5B9A\u4E49\u76EE\u6807\u3001\u8FD0\u884C\u65F6\u548C\u6267\u884C\u5668\u6765\u7F16\u8BD1\u8FD9\u4E2A\u6A21\u578B\u3002\u5728\u672C\u6559\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u4F7F\u7528\u9884\u5148\u7F16\u8BD1\uFF08Ahead-of-Time\uFF0CAoT\uFF09\u8FDB\u884C\u7F16\u8BD1\uFF0C\u5E76\u6784\u5EFA\u4E00\u4E2A\u72EC\u7ACB\u7684\u9879\u76EE\u3002\u8FD9\u4E0E\u4F7F\u7528\u4E3B\u673A\u9A71\u52A8\u6A21\u5F0F\u7684 AoT \u4E0D\u540C\uFF0C\u5176\u4E2D\u76EE\u6807\u4F1A\u4F7F\u7528\u4E3B\u673A\u9A71\u52A8\u7684 AoT \u6267\u884C\u5668\u4E0E\u4E3B\u673A\u901A\u4FE1\u4EE5\u8FD0\u884C\u63A8\u7406\u3002"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'# \u4F7F\u7528 C \u8FD0\u884C\u65F6 (crt)\nRUNTIME = Runtime("crt")\n\n# \u4F7F\u7528\u5E26\u6709 `unpacked-api=True` \u548C `interface-api=c` \u7684 AoT \u6267\u884C\u5668\u3002`interface-api=c` \u5F3A\u5236\n# \u7F16\u8BD1\u5668\u751F\u6210 C \u7C7B\u578B\u7684\u51FD\u6570 API\uFF0C\u800C `unpacked-api=True` \u5F3A\u5236\u7F16\u8BD1\u5668\u751F\u6210\u6700\u5C0F\u7684\u672A\u6253\u5305\u683C\u5F0F\u8F93\u5165\uFF0C\n# \u8FD9\u51CF\u5C11\u4E86\u8C03\u7528\u6A21\u578B\u63A8\u7406\u5C42\u65F6\u7684\u5806\u6808\u5185\u5B58\u4F7F\u7528\u3002\nEXECUTOR = Executor(\n    "aot",\n    {"unpacked-api": True, "interface-api": "c", "workspace-byte-alignment": 8},\n)\n\n# \u9009\u62E9\u4E00\u4E2A Zephyr \u677F\nBOARD = os.getenv("TVM_MICRO_BOARD", default="nucleo_l4r5zi")\n\n# \u4F7F\u7528 BOARD \u83B7\u53D6\u5B8C\u6574\u7684\u76EE\u6807\u63CF\u8FF0\nTARGET = tvm.micro.testing.get_target("zephyr", BOARD)\n\n'})}),"\n",(0,i.jsx)(t.h1,{id:"\u7F16\u8BD1\u6A21\u578B\u5E76\u5BFC\u51FA\u6A21\u578B\u5E93\u683C\u5F0F",children:"\u7F16\u8BD1\u6A21\u578B\u5E76\u5BFC\u51FA\u6A21\u578B\u5E93\u683C\u5F0F"}),"\n",(0,i.jsx)(t.p,{children:"\u73B0\u5728\uFF0C\u6211\u4EEC\u4E3A\u76EE\u6807\u7F16\u8BD1\u6A21\u578B\u3002\u7136\u540E\uFF0C\u6211\u4EEC\u4E3A\u7F16\u8BD1\u540E\u7684\u6A21\u578B\u751F\u6210\u6A21\u578B\u5E93\u683C\u5F0F\u3002\u6211\u4EEC\u8FD8\u9700\u8981\u8BA1\u7B97\u7F16\u8BD1\u540E\u7684\u6A21\u578B\u6240\u9700\u7684\u5DE5\u4F5C\u7A7A\u95F4\u5927\u5C0F\u3002"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'config = {"tir.disable_vectorize": True}\nif USE_CMSIS:\n    from tvm.relay.op.contrib import cmsisnn\n\n    config["relay.ext.cmsisnn.options"] = {"mcpu": TARGET.mcpu}\n    relay_mod = cmsisnn.partition_for_cmsisnn(relay_mod, params, mcpu=TARGET.mcpu)\n\nwith tvm.transform.PassContext(opt_level=3, config=config):\n    module = tvm.relay.build(\n        relay_mod, target=TARGET, params=params, runtime=RUNTIME, executor=EXECUTOR\n    )\n\ntemp_dir = tvm.contrib.utils.tempdir()\nmodel_tar_path = temp_dir / "model.tar"\nexport_model_library_format(module, model_tar_path)\nworkspace_size = mlf_extract_workspace_size_bytes(model_tar_path)\n\n'})}),"\n",(0,i.jsx)(t.h1,{id:"\u751F\u6210\u8F93\u5165\u8F93\u51FA\u5934\u6587\u4EF6",children:"\u751F\u6210\u8F93\u5165/\u8F93\u51FA\u5934\u6587\u4EF6"}),"\n",(0,i.jsx)(t.p,{children:"\u4E3A\u4E86\u4F7F\u7528 AoT \u521B\u5EFA microTVM \u72EC\u7ACB\u9879\u76EE\uFF0C\u6211\u4EEC\u9700\u8981\u751F\u6210\u8F93\u5165\u548C\u8F93\u51FA\u5934\u6587\u4EF6\u3002\u8FD9\u4E9B\u5934\u6587\u4EF6\u7528\u4E8E\u5C06\u751F\u6210\u7684\u4EE3\u7801\u4E2D\u7684\u8F93\u5165\u548C\u8F93\u51FA API \u4E0E\u72EC\u7ACB\u9879\u76EE\u7684\u5176\u4F59\u90E8\u5206\u8FDE\u63A5\u8D77\u6765\u3002\u5BF9\u4E8E\u6B64\u7279\u5B9A\u63D0\u4EA4\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u751F\u6210\u8F93\u51FA\u5934\u6587\u4EF6\uFF0C\u56E0\u4E3A\u8F93\u5165 API \u8C03\u7528\u662F\u4EE5\u4E0D\u540C\u7684\u65B9\u5F0F\u5904\u7406\u7684\u3002"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'extra_tar_dir = tvm.contrib.utils.tempdir()\nextra_tar_file = extra_tar_dir / "extra.tar"\n\nwith tarfile.open(extra_tar_file, "w:gz") as tf:\n    create_header_file(\n        "output_data",\n        np.zeros(\n            shape=output_shape,\n            dtype=output_dtype,\n        ),\n        "include/tvm",\n        tf,\n    )\n\n'})}),"\n",(0,i.jsx)(t.h1,{id:"\u521B\u5EFA\u9879\u76EE\u6784\u5EFA\u5E76\u51C6\u5907\u9879\u76EE-tar-\u6587\u4EF6",children:"\u521B\u5EFA\u9879\u76EE\u3001\u6784\u5EFA\u5E76\u51C6\u5907\u9879\u76EE tar \u6587\u4EF6"}),"\n",(0,i.jsx)(t.p,{children:"\u73B0\u5728\u6211\u4EEC\u6709\u4E86\u7F16\u8BD1\u540E\u7684\u6A21\u578B\u4F5C\u4E3A\u6A21\u578B\u5E93\u683C\u5F0F\uFF0C\u53EF\u4EE5\u4F7F\u7528 Zephyr \u6A21\u677F\u9879\u76EE\u751F\u6210\u5B8C\u6574\u7684\u9879\u76EE\u3002\u9996\u5148\uFF0C\u6211\u4EEC\u51C6\u5907\u9879\u76EE\u9009\u9879\uFF0C\u7136\u540E\u6784\u5EFA\u9879\u76EE\u3002\u6700\u540E\uFF0C\u6211\u4EEC\u6E05\u7406\u4E34\u65F6\u6587\u4EF6\u5E76\u5C06\u63D0\u4EA4\u9879\u76EE\u79FB\u52A8\u5230\u5F53\u524D\u5DE5\u4F5C\u76EE\u5F55\uFF0C\u53EF\u4EE5\u5728\u5F00\u53D1\u5957\u4EF6\u4E0A\u4E0B\u8F7D\u5E76\u4F7F\u7528\u3002"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'input_total_size = 1\nfor i in range(len(input_shape)):\n    input_total_size *= input_shape[i]\n\ntemplate_project_path = pathlib.Path(tvm.micro.get_microtvm_template_projects("zephyr"))\nproject_options = {\n    "extra_files_tar": str(extra_tar_file),\n    "project_type": "mlperftiny",\n    "board": BOARD,\n    "compile_definitions": [\n        f"-DWORKSPACE_SIZE={workspace_size + 512}",  # Memory workspace size, 512 is a temporary offset\n        # since the memory calculation is not accurate.\n        f"-DTARGET_MODEL={MODEL_INDEX}",  # Sets the model index for project compilation.\n        f"-DTH_MODEL_VERSION=EE_MODEL_VERSION_{MODEL_SHORT_NAME}01",  # Sets model version. This is required by MLPerfTiny API.\n        f"-DMAX_DB_INPUT_SIZE={input_total_size}",  # Max size of the input data array.\n    ],\n}\n\nif MODEL_SHORT_NAME != "AD":\n    project_options["compile_definitions"].append(f"-DOUT_QUANT_SCALE={quant_output_scale}")\n    project_options["compile_definitions"].append(f"-DOUT_QUANT_ZERO={quant_output_zero_point}")\n\nif USE_CMSIS:\n    project_options["compile_definitions"].append(f"-DCOMPILE_WITH_CMSISNN=1")\n\n# \u6CE8\u610F\uFF1A\u6839\u636E\u60A8\u4F7F\u7528\u7684\u677F\u5B50\u53EF\u80FD\u9700\u8981\u8C03\u6574\u8FD9\u4E2A\u503C\u3002\nproject_options["config_main_stack_size"] = 4000\n\nif USE_CMSIS:\n    project_options["cmsis_path"] = os.environ.get("CMSIS_PATH", "/content/cmsis")\n\ngenerated_project_dir = temp_dir / "project"\n\nproject = tvm.micro.project.generate_project_from_mlf(\n    template_project_path, generated_project_dir, model_tar_path, project_options\n)\nproject.build()\n\n# \u6E05\u7406\u6784\u5EFA\u76EE\u5F55\u548C\u989D\u5916\u7684\u5DE5\u4EF6\nshutil.rmtree(generated_project_dir / "build")\n(generated_project_dir / "model.tar").unlink()\n\nproject_tar_path = pathlib.Path(os.getcwd()) / "project.tar"\nwith tarfile.open(project_tar_path, "w:tar") as tar:\n    tar.add(generated_project_dir, arcname=os.path.basename("project"))\n\nprint(f"The generated project is located here: {project_tar_path}")\n'})}),"\n",(0,i.jsx)(t.h1,{id:"\u4F7F\u7528\u6B64\u9879\u76EE\u4E0E\u60A8\u7684\u677F\u5B50",children:"\u4F7F\u7528\u6B64\u9879\u76EE\u4E0E\u60A8\u7684\u677F\u5B50"}),"\n",(0,i.jsx)(t.p,{children:"\u65E2\u7136\u6211\u4EEC\u6709\u4E86\u751F\u6210\u7684\u9879\u76EE\uFF0C\u60A8\u53EF\u4EE5\u5728\u672C\u5730\u4F7F\u7528\u8BE5\u9879\u76EE\u5C06\u677F\u5B50\u5237\u5199\u5E76\u51C6\u5907\u597D\u8FD0\u884C EEMBC runner \u8F6F\u4EF6\u3002\u8981\u6267\u884C\u6B64\u64CD\u4F5C\uFF0C\u8BF7\u6309\u7167\u4EE5\u4E0B\u6B65\u9AA4\u64CD\u4F5C\uFF1A"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"tar -xf project.tar\ncd project\nmkdir build\ncmake ..\nmake -j2\nwest flash\n\n"})}),"\n",(0,i.jsx)(t.p,{children:"\u73B0\u5728\uFF0C\u60A8\u53EF\u4EE5\u6309\u7167\u8FD9\u4E9B\u8BF4\u660E\u5C06\u60A8\u7684\u677F\u5B50\u8FDE\u63A5\u5230 EEMBC runner \u5E76\u5728\u60A8\u7684\u677F\u5B50\u4E0A\u5BF9\u6B64\u6A21\u578B\u8FDB\u884C\u57FA\u51C6\u6D4B\u8BD5\u3002"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://tvm.apache.org/docs/v0.13.0/_downloads/4577847d31fa9ec38d0a6dda3e1d178d/micro_mlperftiny.py",children:"\u4E0B\u8F7D Python \u6E90\u4EE3\u7801\uFF1Amicro_mlperftiny.py"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://tvm.apache.org/docs/v0.13.0/_downloads/1fc1683d67bee4f26703504a58d42578/micro_mlperftiny.ipynb",children:"\u4E0B\u8F7D Jupyter notebook\uFF1Amicro_mlperftiny.ipynb"})})]})}function d(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},21494:function(e,t,n){n.d(t,{Z:function(){return p},a:function(){return a}});var r=n(39546);let i={},o=r.createContext(i);function a(e){let t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function p(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);