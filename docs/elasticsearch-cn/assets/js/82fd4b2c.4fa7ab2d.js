"use strict";(self.webpackChunkelasticsearch_doc=self.webpackChunkelasticsearch_doc||[]).push([[987],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>u});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),o=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):c(c({},a),e)),t},p=function(e){var a=o(e.components);return n.createElement(i.Provider,{value:a},e.children)},m="mdxType",k={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=o(t),d=r,u=m["".concat(i,".").concat(d)]||m[d]||k[d]||l;return t?n.createElement(u,c(c({ref:a},p),{},{components:t})):n.createElement(u,c({ref:a},p))}));function u(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=t.length,c=new Array(l);c[0]=d;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s[m]="string"==typeof e?e:r,c[1]=s;for(var o=2;o<l;o++)c[o]=t[o];return n.createElement.apply(null,c)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},3602:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>o});var n=t(7462),r=(t(7294),t(3905));const l={sidebar_position:60},c="\u4f7f\u7528 Docker \u5b89\u88c5 Elasticsearch",s={unversionedId:"set_up_elasticsearch/installing_elasticsearch/docker",id:"set_up_elasticsearch/installing_elasticsearch/docker",title:"\u4f7f\u7528 Docker \u5b89\u88c5 Elasticsearch",description:"Elasticsearch \u4e5f\u63d0\u4f9b Docker \u955c\u50cf\u3002\u955c\u50cf\u4f7f\u7528 centos:8 \u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u3002",source:"@site/docs/set_up_elasticsearch/installing_elasticsearch/docker.md",sourceDirName:"set_up_elasticsearch/installing_elasticsearch",slug:"/set_up_elasticsearch/installing_elasticsearch/docker",permalink:"/docs/elasticsearch-cn/set_up_elasticsearch/installing_elasticsearch/docker",draft:!1,tags:[],version:"current",sidebarPosition:60,frontMatter:{sidebar_position:60},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528 Windows MSI \u5b89\u88c5\u7a0b\u5e8f\u5b89\u88c5 Elasticsearch",permalink:"/docs/elasticsearch-cn/set_up_elasticsearch/installing_elasticsearch/msi"},next:{title:"\u4f7f\u7528 Homebrew \u5728 macOS \u4e0a\u5b89\u88c5 Elasticsearch",permalink:"/docs/elasticsearch-cn/set_up_elasticsearch/installing_elasticsearch/brew"}},i={},o=[{value:"\u62c9\u53d6\u955c\u50cf",id:"\u62c9\u53d6\u955c\u50cf",level:2},{value:"\u4f7f\u7528 Docker \u542f\u52a8\u5355\u8282\u70b9\u96c6\u7fa4",id:"\u4f7f\u7528-docker-\u542f\u52a8\u5355\u8282\u70b9\u96c6\u7fa4",level:2},{value:"\u4f7f\u7528 Docker Compose \u542f\u52a8\u591a\u8282\u70b9\u96c6\u7fa4",id:"\u4f7f\u7528-docker-compose-\u542f\u52a8\u591a\u8282\u70b9\u96c6\u7fa4",level:2},{value:"\u542f\u52a8\u5f00\u542f TLS \u7684\u591a\u8282\u70b9\u96c6\u7fa4",id:"\u542f\u52a8\u5f00\u542f-tls-\u7684\u591a\u8282\u70b9\u96c6\u7fa4",level:3},{value:"\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528 Docker \u955c\u50cf",id:"\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528-docker-\u955c\u50cf",level:2},{value:"\u8bbe\u7f6e <code>vm.max_map_count</code> \u81f3\u5c11\u4e3a <code>262144</code>",id:"\u8bbe\u7f6e-vmmax_map_count-\u81f3\u5c11\u4e3a-262144",level:3},{value:"\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u53ef\u88ab\u7528\u6237 <code>elasticsearch</code> \u7528\u6237\u8bfb\u53d6",id:"\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u53ef\u88ab\u7528\u6237-elasticsearch-\u7528\u6237\u8bfb\u53d6",level:3},{value:"\u4e3a nofile \u548c nproc \u589e\u52a0 ulimit",id:"\u4e3a-nofile-\u548c-nproc-\u589e\u52a0-ulimit",level:3},{value:"\u7981\u7528 swapping",id:"\u7981\u7528-swapping",level:3},{value:"\u968f\u673a\u53d1\u5e03\u7aef\u53e3",id:"\u968f\u673a\u53d1\u5e03\u7aef\u53e3",level:3},{value:"\u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f",id:"\u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f",level:3},{value:"\u90e8\u7f72\u56fa\u5b9a\u4e3a\u6307\u5b9a\u7684\u955c\u50cf\u7248\u672c",id:"\u90e8\u7f72\u56fa\u5b9a\u4e3a\u6307\u5b9a\u7684\u955c\u50cf\u7248\u672c",level:3},{value:"\u59cb\u7ec8\u7ed1\u5b9a\u6570\u636e\u5377",id:"\u59cb\u7ec8\u7ed1\u5b9a\u6570\u636e\u5377",level:3},{value:"\u7981\u6b62\u4f7f\u7528 <code>loop-lvm</code> \u6a21\u5f0f",id:"\u7981\u6b62\u4f7f\u7528-loop-lvm-\u6a21\u5f0f",level:3},{value:"\u96c6\u4e2d\u4f60\u7684\u65e5\u5fd7",id:"\u96c6\u4e2d\u4f60\u7684\u65e5\u5fd7",level:3},{value:"\u4f7f\u7528 Docker \u914d\u7f6e Elasticsearch",id:"\u4f7f\u7528-docker-\u914d\u7f6e-elasticsearch",level:2},{value:"\u6302\u8f7d Elasticsearch \u914d\u7f6e\u6587\u4ef6",id:"\u6302\u8f7d-elasticsearch-\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u6302\u8f7d Elasticsearch \u5bc6\u94a5\u5e93",id:"\u6302\u8f7d-elasticsearch-\u5bc6\u94a5\u5e93",level:3},{value:"\u4f7f\u7528\u81ea\u5b9a\u4e49 Docker \u955c\u50cf",id:"\u4f7f\u7528\u81ea\u5b9a\u4e49-docker-\u955c\u50cf",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}],p={toc:o};function m(e){let{components:a,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u4f7f\u7528-docker-\u5b89\u88c5-elasticsearch"},"\u4f7f\u7528 Docker \u5b89\u88c5 Elasticsearch"),(0,r.kt)("p",null,"Elasticsearch \u4e5f\u63d0\u4f9b Docker \u955c\u50cf\u3002\u955c\u50cf\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/_/centos/"},"centos:8")," \u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u3002"),(0,r.kt)("p",null,"\u6240\u6709\u5df2\u53d1\u5e03\u7684 Docker \u955c\u50cf\u5217\u8868\u548c\u7248\u672c\u90fd\u5728 ",(0,r.kt)("a",{parentName:"p",href:"www.docker.elastic.co"},"www.docker.elastic.co")," \u4e0a\u3002\u6e90\u6587\u4ef6\u5728 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/elastic/elasticsearch/blob/7.11/distribution/docker"},"github"),"\u3002"),(0,r.kt)("p",null,"\u8f6f\u4ef6\u5305\u5305\u542b\u514d\u8d39\u548c\u8ba2\u9605\u7684\u7279\u6027\u3002",(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html"},"\u5f00\u59cb 30 \u5929\u7684\u8bd5\u7528"),"\uff0c\u5c1d\u8bd5\u6240\u6709\u529f\u80fd\u3002"),(0,r.kt)("h2",{id:"\u62c9\u53d6\u955c\u50cf"},"\u62c9\u53d6\u955c\u50cf"),(0,r.kt)("p",null,"Docker \u4e0a\u83b7\u53d6 Elasticsearch\uff0c\u7b80\u5355\u5230\u53ea\u8981\u5411 Elastic Docker \u4ed3\u5e93\u53d1\u51fa docker pull \u547d\u4ee4\u4e00\u6837\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n")),(0,r.kt)("h2",{id:"\u4f7f\u7528-docker-\u542f\u52a8\u5355\u8282\u70b9\u96c6\u7fa4"},"\u4f7f\u7528 Docker \u542f\u52a8\u5355\u8282\u70b9\u96c6\u7fa4"),(0,r.kt)("p",null,"\u8981\u542f\u52a8\u5355\u8282\u70b9 Elasticsearch \u96c6\u7fa4\u8fdb\u884c\u5f00\u53d1\u6216\u6d4b\u8bd5\uff0c\u8bf7\u6307\u5b9a",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/bootstrap#%E5%8D%95%E8%8A%82%E7%82%B9%E5%8F%91%E7%8E%B0"},"\u5355\u8282\u70b9\u53d1\u73b0"),"\u4ee5\u7ed5\u8fc7",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/bootstrap"},"\u542f\u52a8\u68c0\u67e5"),"\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker run -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n')),(0,r.kt)("h2",{id:"\u4f7f\u7528-docker-compose-\u542f\u52a8\u591a\u8282\u70b9\u96c6\u7fa4"},"\u4f7f\u7528 Docker Compose \u542f\u52a8\u591a\u8282\u70b9\u96c6\u7fa4"),(0,r.kt)("p",null,"\u4e3a\u4e86\u5728 Docker \u4e2d\u542f\u52a8\u548c\u8fd0\u884c\u4e00\u4e2a\u4e09\u8282\u70b9 Elasticsearch \u96c6\u7fa4\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Docker Compose\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," \u6587\u4ef6\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'2.2\'\nservices:\n  es01:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n    container_name: es01\n    environment:\n      - node.name=es01\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=es02,es03\n      - cluster.initial_master_nodes=es01,es02,es03\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - data01:/usr/share/elasticsearch/data\n    ports:\n      - 9200:9200\n    networks:\n      - elastic\n  es02:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n    container_name: es02\n    environment:\n      - node.name=es02\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=es01,es03\n      - cluster.initial_master_nodes=es01,es02,es03\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - data02:/usr/share/elasticsearch/data\n    networks:\n      - elastic\n  es03:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n    container_name: es03\n    environment:\n      - node.name=es03\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=es01,es02\n      - cluster.initial_master_nodes=es01,es02,es03\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - data03:/usr/share/elasticsearch/data\n    networks:\n      - elastic\n\nvolumes:\n  data01:\n    driver: local\n  data02:\n    driver: local\n  data03:\n    driver: local\n\nnetworks:\n  elastic:\n    driver: bridge\n')),(0,r.kt)("admonition",{title:"\u63d0\u793a",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\u4f8b\u5b50\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," \u4f7f\u7528\u73af\u5883\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"p"},"ES_JAVA_OPTS")," \u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f\u4e3a 512 MB\u3002\u6211\u4eec\u4e0d\u63a8\u8350\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ES_JAVA_OPTS"),"\u3002\u53c2\u770b",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E6%89%8B%E5%B7%A5%E8%AE%BE%E7%BD%AE%E5%A0%86%E5%A4%A7%E5%B0%8F"},"\u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f"),"\u3002")),(0,r.kt)("p",null,"\u8fd9\u4e2a\u793a\u4f8b Docker Compose \u6587\u4ef6\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e09\u8282\u70b9 Elasticsearch \u96c6\u7fa4\u3002\u8282\u70b9 ",(0,r.kt)("inlineCode",{parentName:"p"},"es01")," \u76d1\u542c ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost:9200"),"\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"es02")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"es03")," \u901a\u8fc7 Docker \u7f51\u7edc\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"es01")," \u901a\u4fe1\u3002"),(0,r.kt)("p",null,"\u8bf7\u6ce8\u610f\u6b64\u914d\u7f6e\u5728\u6240\u6709\u7f51\u7edc\u63a5\u53e3\u4e0a\u66b4\u9732\u7aef\u53e3 9200\uff0c\u5e76\u4e14\u8003\u8651\u5230 Docker \u600e\u4e48\u5728 Linux \u4e0a\u64cd\u4f5c ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables"),"\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u7684 Elasticsearch \u96c6\u7fa4\u53ef\u4ee5\u516c\u5f00\u8bbf\u95ee\uff0c\u53ef\u80fd\u4f1a\u5ffd\u7565\u4efb\u4f55\u9632\u706b\u5899\u8bbe\u7f6e\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u66b4\u9732\u7aef\u53e3 9200\uff0c\u8f6c\u800c\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\uff0c\u5728 docker-compose.yml \u6587\u4ef6\u4e2d\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1:9200:9200")," \u66ff\u4ee3 ",(0,r.kt)("inlineCode",{parentName:"p"},"9200:9200"),"\u3002Elasticsearch \u5c06\u53ea\u80fd\u4ece\u4e3b\u673a\u81ea\u8eab\u8bbf\u95ee\u3002"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/storage/volumes"},"Docker \u547d\u540d\u5377")," ",(0,r.kt)("inlineCode",{parentName:"p"},"data01"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"data02")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"data03")," \u5b58\u50a8\u8282\u70b9\u6570\u636e\u76ee\u5f55\uff0c\u4ee5\u4fbf\u91cd\u542f\u65f6\u6570\u636e\u6301\u7eed\u5b58\u5728\u3002\u5982\u679c\u4ed6\u4eec\u4e0d\u5b58\u5728\uff0cdocker-compose \u5c06\u4f1a\u5728\u4f60\u521b\u5efa\u96c6\u7fa4\u65f6\u521b\u5efa\u4ed6\u4eec\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u786e\u4fdd Docker Engine \u5206\u914d\u4e86\u81f3\u5c11 4 GiB \u5185\u5b58\u3002\u5728 Docker \u684c\u9762\u4e2d\uff0c\u4f60\u53ef\u4ee5\u5728\u9996\u9009\u9879\uff08macOS\uff09\u6216\u8bbe\u7f6e\uff08Windows\uff09\u7684\u9ad8\u7ea7\u9009\u9879\u5361\u4e2d\u914d\u7f6e\u8d44\u6e90\u4f7f\u7528\u3002")),(0,r.kt)("admonition",{title:"\u63d0\u793a",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\u5728 Linux \u4e0a\uff0cDocker Compose \u672a\u4e0e Docker \u4e00\u8d77\u9884\u88c5\u3002\u5728 docs.docker.com \u67e5\u770b\u5b89\u88c5\u6307\u5357\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/install"},"\u5728 Linux \u5b89\u88c5 Compose"))),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u8fd0\u884c docker-compose \u4ee5\u542f\u52a8\u96c6\u7fa4\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose up\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u63d0\u4ea4\u8bf7\u6c42 ",(0,r.kt)("inlineCode",{parentName:"li"},"_cat/nodes")," \u67e5\u770b\u8282\u70b9\u662f\u5426\u542f\u52a8\u8fd0\u884c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X GET "localhost:9200/_cat/nodes?v=true&pretty"\n')),(0,r.kt)("p",null,"\u65e5\u5fd7\u6d88\u606f\u8fdb\u5165\u63a7\u5236\u53f0\uff0c\u7531\u914d\u7f6e\u7684 Docker \u65e5\u5fd7\u9a71\u52a8\u5904\u7406\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker logs")," \u8bbf\u95ee\u65e5\u5fd7\u3002\u5982\u679c\u4f60\u66f4\u60f3 Elasticsearch \u5bb9\u5668\u628a\u65e5\u5fd7\u5199\u5165\u78c1\u76d8\uff0c\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"p"},"ES_LOG_STYLE")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"file"),"\u3002\u8fd9\u5c06\u5bfc\u81f4 Elasticsearch \u4f7f\u7528\u4e0e\u5176\u4ed6 Elasticsearch \u5206\u53d1\u683c\u5f0f\u76f8\u540c\u7684\u914d\u7f6e\u3002"),(0,r.kt)("p",null,"\u8981\u505c\u6b62\u96c6\u7fa4\uff0c\u8fd0\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose down"),"\u3002\u5f53\u4f60\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up")," \u91cd\u542f\u96c6\u7fa4\uff0cDocker \u5377\u4e2d\u7684\u6570\u636e\u5c06\u88ab\u4fdd\u5b58\u548c\u52a0\u8f7d\u3002\u4e3a\u4e86\u5728\u505c\u6b62\u96c6\u7fa4\u65f6\u5220\u9664\u6570\u636e\u5377\uff0c\u6307\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"-v")," \u9009\u9879\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose down -v"),"\u3002"),(0,r.kt)("h3",{id:"\u542f\u52a8\u5f00\u542f-tls-\u7684\u591a\u8282\u70b9\u96c6\u7fa4"},"\u542f\u52a8\u5f00\u542f TLS \u7684\u591a\u8282\u70b9\u96c6\u7fa4"),(0,r.kt)("p",null,"\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"/secure/encrypt/docker"},"\u5728Elasticsearch Docker \u5bb9\u5668\u7684\u52a0\u5bc6\u901a\u4fe1"),"\u548c",(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elastic-stack-get-started/7.11/get-started-docker.html#get-started-docker-tls"},"\u5728 Docker \u4e2d\u5f00\u542f TLS \u8fd0\u884c Elastic \u6808"),"\u3002"),(0,r.kt)("h2",{id:"\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528-docker-\u955c\u50cf"},"\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528 Docker \u955c\u50cf"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u8981\u6c42\u548c\u5efa\u8bae\u9002\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u5728 Docker \u4e2d\u8fd0\u884c Elasticsearch\u3002"),(0,r.kt)("h3",{id:"\u8bbe\u7f6e-vmmax_map_count-\u81f3\u5c11\u4e3a-262144"},"\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"h3"},"vm.max_map_count")," \u81f3\u5c11\u4e3a ",(0,r.kt)("inlineCode",{parentName:"h3"},"262144")),(0,r.kt)("p",null,"\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \u5185\u6838\u8bbe\u7f6e\u5fc5\u987b\u81f3\u5c11\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"262144"),"\u3002"),(0,r.kt)("p",null,"\u5982\u4f55\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \u57fa\u4e8e\u4f60\u7684\u5e73\u53f0\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Linux")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \u5e94\u8be5\u6c38\u4e45\u8bbe\u7f6e\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.conf"),"\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"grep vm.max_map_count /etc/sysctl.conf\nvm.max_map_count=262144\n")),(0,r.kt)("p",null,"\u5728\u8fd0\u884c\u7684\u7cfb\u7edf\u4e2d\u5e94\u7528\u6b64\u914d\u7f6e\uff0c\u6267\u884c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl -w vm.max_map_count=262144\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5e26 ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/docker-for-mac"},"Mac \u7248 Docker")," \u7684 macOS")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \u8bbe\u7f6e\u5fc5\u987b\u5728 xhyve \u865a\u673a\u4e2d\u8bbe\u7f6e\uff1a"),(0,r.kt)("p",null,"a. \u4ece\u547d\u4ee4\u884c\u8fd0\u884c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty\n")),(0,r.kt)("p",null,'b. \u6309\u56de\u8f66\uff0c\u4f7f\u7528 "sysctl" \u914d\u7f6e ',(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl -w vm.max_map_count=262144\n")),(0,r.kt)("p",null,"c. \u9000\u51fa ",(0,r.kt)("inlineCode",{parentName:"p"},"screen")," \u4f1a\u8bdd\uff0c\u6309 ",(0,r.kt)("inlineCode",{parentName:"p"},"Ctrl a d")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5e26 ",(0,r.kt)("a",{parentName:"li",href:"https://www.docker.com/products/docker-desktop"},"Docker \u684c\u9762\u7248"),"\u7684 Windows \u548c macOS")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \u5fc5\u987b\u901a\u8fc7 docker-machine \u8bbe\u7f6e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker-machine ssh\nsudo sysctl -w vm.max_map_count=262144\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5e26 ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/docker-for-windows/wsl/"},"Docker WSL 2 \u540e\u7aef\u684c\u9762\u7248"),"\u7684 Windows")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," \u5fc5\u987b\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-desktop")," \u5bb9\u5668\u4e2d\u8bbe\u7f6e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"wsl -d docker-desktop\nsysctl -w vm.max_map_count=262144\n")),(0,r.kt)("h3",{id:"\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u53ef\u88ab\u7528\u6237-elasticsearch-\u7528\u6237\u8bfb\u53d6"},"\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u53ef\u88ab\u7528\u6237 ",(0,r.kt)("inlineCode",{parentName:"h3"},"elasticsearch")," \u7528\u6237\u8bfb\u53d6"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cElasticsearch \u901a\u8fc7 uid:gid ",(0,r.kt)("inlineCode",{parentName:"p"},"1000:0"),"\uff0c\u4ee5\u7528\u6237 ",(0,r.kt)("inlineCode",{parentName:"p"},"elasticsearch")," \u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u3002"),(0,r.kt)("admonition",{title:"\u8b66\u544a",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"\u4e00\u4e2a\u4f8b\u5916\u662f ",(0,r.kt)("a",{parentName:"p",href:"https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines"},"OpenShift"),"\uff0c\u5b83\u4f7f\u7528\u4efb\u610f\u5206\u914d\u7684\u7528\u6237 ID \u8fd0\u884c\u5bb9\u5668\u3002OpenShift \u663e\u793a\u7684\u6301\u4e45\u5377\u7684 gid \u8bbe\u7f6e\u4e3a 0\uff0c\u5b83\u53ef\u4ee5\u65e0\u9700\u8c03\u6574\u7684\u8fd0\u884c\u3002")),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u8981\u7ed1\u5b9a\u6302\u8f7d\u672c\u5730\u76ee\u5f55\u6216\u6587\u4ef6\uff0c\u5b83\u5fc5\u987b\u53ef\u88ab\u7528\u6237 ",(0,r.kt)("inlineCode",{parentName:"p"},"elasticsearch")," \u8bfb\u53d6\u3002\u6b64\u5916\uff0c\u6b64\u7528\u6237\u5bf9 ",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/important_es_config#%E8%B7%AF%E5%BE%84%E8%AE%BE%E7%BD%AE"},"\u914d\u7f6e\u3001\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55"),"\u6709\u5199\u6743\u9650\uff08Elasticsearch \u9700\u8981\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"config")," \u76ee\u5f55\u6709\u5199\u6743\u9650\uff0c\u8fd9\u6837\u5b83\u624d\u80fd\u751f\u6210\u5bc6\u94a5\u5e93\uff09\u3002\u4e00\u4e2a\u597d\u7684\u7b56\u7565\u662f\u4e3a\u672c\u5730\u76ee\u5f55 gid ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," \u5206\u914d\u7ec4\u8bbf\u95ee\u6743\u9650\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u8981\u51c6\u5907\u672c\u5730\u76ee\u5f55\u4ee5\u901a\u8fc7\u7ed1\u5b9a\u6302\u8f7d\u6765\u5b58\u50a8\u6570\u636e\uff0c\u6309\u4ee5\u4e0b\u64cd\u4f5c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir esdatadir\nchmod g+rwx esdatadir\nchgrp 0 esdatadir\n")),(0,r.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49 UID \u548c GID \u6765\u8fd0\u884c Elasticsearch \u5bb9\u5668\u3002\u9664\u975e\u4f60\u7ed1\u5b9a\u6302\u8f7d\u6bcf\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"config"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"data")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"logs")," \u76ee\u5f55\uff0c\u5426\u5219\u5fc5\u987b\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run")," \u4f20\u9012\u547d\u4ee4\u884c\u9009\u9879 ",(0,r.kt)("inlineCode",{parentName:"p"},"--group-add 0"),"\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u8fd0\u884c Elasticsearch \u7684\u7528\u6237\u4e5f\u662f\u5bb9\u5668 ",(0,r.kt)("inlineCode",{parentName:"p"},"root")," \uff08GID 0\uff09\u7ec4\u7684\u6210\u5458\u3002"),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"p"},"TAKE_FILE_OWNERSHIP")," \u5f3a\u5236\u5bb9\u5668\u66f4\u6539\u7528\u4e8e",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/important#%E8%B7%AF%E5%BE%84%E8%AE%BE%E7%BD%AE"},"\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55"),"\u7684\u7ed1\u5b9a\u6302\u8f7d\u7684\u6240\u6709\u6743\u3002\u5f53\u4f60\u8fd9\u6837\u505a\u7684\u65f6\u5019\uff0c\u5b83\u4eec\u5c06\u5c5e\u4e8e uid:gid ",(0,r.kt)("inlineCode",{parentName:"p"},"1000:0"),"\uff0c\u5b83\u63d0\u4f9b\u4e86 Elasticsearch \u8fdb\u7a0b\u6240\u9700\u7684\u8bfb\u5199\u8bbf\u95ee\u6743\u9650\u3002"),(0,r.kt)("h3",{id:"\u4e3a-nofile-\u548c-nproc-\u589e\u52a0-ulimit"},"\u4e3a nofile \u548c nproc \u589e\u52a0 ulimit"),(0,r.kt)("p",null,"\u5fc5\u987b\u4e3a Elasticsearch \u5bb9\u5668\u63d0\u4f9b ",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/important_system_config/config"},"nofile")," \u548c ",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/bootstrap/thread"},"nproc")," \u589e\u52a0 ulimit\u3002\u9a8c\u8bc1 Docker \u7684\u5b88\u62a4\u8fdb\u7a0b\u662f\u5426\u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init"},"init system")," \u662f\u5426\u5c06\u5b83\u4eec\u8bbe\u7f6e\u4e3a\u53ef\u63a5\u53d7\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u68c0\u6d4b Docker \u5b88\u62a4\u8fdb\u7a0b\u9ed8\u8ba4\u7684 ulimit\uff0c\u6267\u884c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --rm centos:8 /bin/bash -c 'ulimit -Hn && ulimit -Sn && ulimit -Hu && ulimit -Su'\n")),(0,r.kt)("p",null,"\u5982\u679c\u9700\u8981\uff0c\u5728\u5b88\u62a4\u8fdb\u7a0b\u4e2d\u8c03\u6574\u4ed6\u4eec\uff0c\u6216\u8005\u5728\u6bcf\u4e2a\u5bb9\u5668\u4e2d\u91cd\u8f7d\u4ed6\u4eec\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run")," \u65f6\uff0c\u8bbe\u7f6e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"--ulimit nofile=65535:65535\n")),(0,r.kt)("h3",{id:"\u7981\u7528-swapping"},"\u7981\u7528 swapping"),(0,r.kt)("p",null,"\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\u548c\u8282\u70b9\u7a33\u5b9a\u6027\uff0cswapping \u9700\u8981\u7981\u7528\u3002\u6709\u5173\u6267\u884c\u6b64\u64cd\u4f5c\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/important_system_config/swapping"},"\u7981\u7528 swapping"),"\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u9009\u62e9 ",(0,r.kt)("inlineCode",{parentName:"p"},"bootstrap.memory_lock: true"),"\uff0c\u4f60\u4e5f\u9700\u8981\u5728 Docker \u5b88\u62a4\u8fdb\u7a0b\u4e2d\u5b9a\u4e49 ",(0,r.kt)("inlineCode",{parentName:"p"},"memlock: true")," \u9650\u5b9a\uff0c\u6216\u8005\u5982",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8-Docker-Compose-%E5%90%AF%E5%8A%A8%E5%A4%9A%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4"},"\u793a\u4f8b compose \u6587\u4ef6"),"\u4e2d\u663e\u793a\u7684\u8bbe\u7f6e\u3002\u5f53\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run"),"\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\uff1a"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},'-e "bootstrap.memory_lock=true" --ulimit memlock=-1:-1')),(0,r.kt)("h3",{id:"\u968f\u673a\u53d1\u5e03\u7aef\u53e3"},"\u968f\u673a\u53d1\u5e03\u7aef\u53e3"),(0,r.kt)("p",null,"\u955c\u50cf",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/builder/#/expose"},"\u66b4\u9732")," TCP \u7aef\u53e3 9200 \u548c 9300\u3002\u5bf9\u751f\u4ea7\u73af\u5883\u96c6\u7fa4\uff0c\u63a8\u8350\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"--publish-all")," \u968f\u673a\u53d1\u5e03\u7aef\u53e3\uff0c\u9664\u975e\u4f60\u4e3a\u6bcf\u4e2a\u4e3b\u673a\u56fa\u5b9a\u4e00\u4e2a\u5bb9\u5668\u3002"),(0,r.kt)("h3",{id:"\u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f"},"\u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cElasticsearch \u57fa\u4e8e\u8282\u70b9\u7684",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/configuring_elasticsearch/node#%E8%8A%82%E7%82%B9%E8%A7%92%E8%89%B2"},"\u89d2\u8272"),"\u548c\u8282\u70b9\u5bb9\u5668\u603b\u53ef\u7528\u5185\u5b58\uff0c\u81ea\u52a8\u5730\u8bbe\u7f6e JVM \u5806\u3002\u5bf9\u5927\u591a\u6570\u751f\u4ea7\u73af\u5883\uff0c\u6211\u4eec\u63a8\u8350\u9ed8\u8ba4\u5927\u5c0f\u8bbe\u7f6e\u3002\u5982\u679c\u6709\u9700\u8981\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u624b\u5de5\u8bbe\u7f6e JVM \u5806\u5927\u5c0f\u6765\u91cd\u8f7d\u9ed8\u8ba4\u8bbe\u7f6e\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u5728\u751f\u4ea7\u73af\u5883\u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f\uff0c\u7ed1\u5b9a\u6302\u8f7d\u5305\u542b\u4e86\u4f60\u671f\u671b\u7684",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/configuring_elasticsearch/advanced#%E8%AE%BE%E7%BD%AE-JVM-%E5%A0%86%E5%A4%A7%E5%B0%8F"},"\u5806\u5927\u5c0f"),"\u8bbe\u7f6e\u7684 ",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/configuring_elasticsearch/jvm"},"JVM \u9009\u9879"),"\u6587\u4ef6\uff08\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/elasticsearch/configuring_elasticsearchjvm.options.d"),"\u4e2d\uff09\u3002"),(0,r.kt)("p",null,"\u7528\u4e8e\u6d4b\u8bd5\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"p"},"ES_JAVA_OPTS")," \u624b\u5de5\u8bbe\u7f6e\u5806\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u8981\u7528 16 GB\uff0c\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run")," \u6307\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},'-e ES_JAVA_OPTS="-Xms16g -Xmx16g"'),"\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"ES_JAVA_OPTS")," \u91cd\u8f7d\u6240\u6709\u5176\u4ed6 JVM \u9009\u9879\u3002\u5728\u751f\u4ea7\u73af\u5883\uff0c\u6211\u4eec\u4e0d\u63a8\u8350\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ES_JAVA_OPTS"),"\u3002\u4e0a\u65b9\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," \u53ef\u4ee5\u770b\u5230\u8bbe\u7f6e\u5806\u5927\u5c0f\u4e3a 512 MB\u3002"),(0,r.kt)("h3",{id:"\u90e8\u7f72\u56fa\u5b9a\u4e3a\u6307\u5b9a\u7684\u955c\u50cf\u7248\u672c"},"\u90e8\u7f72\u56fa\u5b9a\u4e3a\u6307\u5b9a\u7684\u955c\u50cf\u7248\u672c"),(0,r.kt)("p",null,"\u5c06\u90e8\u7f72\u56fa\u5b9a\u4e3a\u6307\u5b9a\u7684 Elasticsearch Docker \u955c\u50cf\u3002\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker.elastic.co/elasticsearch/elasticsearch:7.11.2"),"\u3002"),(0,r.kt)("h3",{id:"\u59cb\u7ec8\u7ed1\u5b9a\u6570\u636e\u5377"},"\u59cb\u7ec8\u7ed1\u5b9a\u6570\u636e\u5377"),(0,r.kt)("p",null,"\u51fa\u4e8e\u4ee5\u4e0b\u539f\u56e0\uff0c\u4f60\u5e94\u8be5\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/elasticsearch/data")," \u4f7f\u7528\u5377\u7ed1\u5b9a\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u5bb9\u5668\u88ab\u6740\u6b7b\uff0cElasticsearch \u8282\u70b9\u6570\u636e\u4e0d\u4f1a\u4e22\u5931"),(0,r.kt)("li",{parentName:"ol"},"Elasticsearch \u5bf9 I/O \u654f\u611f\uff0c\u800c Docker \u5b58\u50a8\u9a71\u52a8\u4e0d\u9002\u5408\u5feb\u901f I/O"),(0,r.kt)("li",{parentName:"ol"},"\u5141\u8bb8\u4f7f\u7528\u9ad8\u7ea7 ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/extend/plugins/#volume-plugins"},"Docker \u5377\u63d2\u4ef6"))),(0,r.kt)("h3",{id:"\u7981\u6b62\u4f7f\u7528-loop-lvm-\u6a21\u5f0f"},"\u7981\u6b62\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"h3"},"loop-lvm")," \u6a21\u5f0f"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 devicemapper \u5b58\u50a8\u9a71\u52a8\uff0c\u4e0d\u8981\u4f7f\u7528\u9ed8\u8ba4\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"loop-lvm")," \u6a21\u5f0f\u3002\u914d\u7f6e docker-engine \u4ee5\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper"},"direct-lvm"),"\u3002"),(0,r.kt)("h3",{id:"\u96c6\u4e2d\u4f60\u7684\u65e5\u5fd7"},"\u96c6\u4e2d\u4f60\u7684\u65e5\u5fd7"),(0,r.kt)("p",null,"\u8003\u8651\u4f7f\u7528\u4e0d\u540c\u7684",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/admin/logging/overview/"},"\u65e5\u5fd7\u9a71\u52a8"),"\u6765\u96c6\u4e2d\u65e5\u5fd7\u3002\u8fd8\u8981\u6ce8\u610f\uff0c\u9ed8\u8ba4\u7684 json-file \u65e5\u5fd7\u9a71\u52a8\u4e0d\u9002\u5408\u751f\u4ea7\u73af\u5883\u3002"),(0,r.kt)("h2",{id:"\u4f7f\u7528-docker-\u914d\u7f6e-elasticsearch"},"\u4f7f\u7528 Docker \u914d\u7f6e Elasticsearch"),(0,r.kt)("p",null,"\u5f53\u4f60\u5728 Docker \u4e2d\u8fd0\u884c\u65f6\uff0c ",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/config#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"},"Elasticsearch \u914d\u7f6e\u6587\u4ef6"),"\u4ece ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/elasticsearch/configuring_elasticsearch")," \u52a0\u8f7d\u3002\u4e3a\u4e86\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u4f60\u8981",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E6%8C%82%E8%BD%BD-Elasticsearch-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"},"\u7ed1\u5b9a\u6302\u8f7d\u6587\u4ef6"),"\u5230\u955c\u50cf\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u4e0a\u3002"),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\u72ec\u7acb\u7684 Elasticsearch \u914d\u7f6e\u53c2\u6570\u3002",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8-Docker-Compose-%E5%90%AF%E5%8A%A8%E5%A4%9A%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4"},"\u793a\u4f8b compose \u6587\u4ef6"),"\u548c",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8-Docker-%E5%90%AF%E5%8A%A8%E5%8D%95%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4"},"\u5355\u8282\u70b9\u793a\u4f8b"),"\u5c31\u7528\u7684\u8fd9\u79cd\u65b9\u6cd5\u3002"),(0,r.kt)("p",null,"\u8981\u4f7f\u7528\u6587\u4ef6\u5185\u5bb9\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u7ed9\u73af\u5883\u53d8\u91cf\u540d\u5b57\u52a0\u4e0a\u540e\u7f00 ",(0,r.kt)("inlineCode",{parentName:"p"},"_FILE"),"\u3002\u8fd9\u5bf9\u4e8e\u79d8\u5bc6\u4f20\u8f93\u914d\u7f6e\uff08\u5982\u5bc6\u7801\uff09\u7ed9 Elasticsearch\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u6307\u5b9a\u5b83\u4eec\u975e\u5e38\u6709\u7528\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u4e3a\u4e86\u4ece\u6587\u4ef6\u8bbe\u7f6e Elasticsearch \u7684\u542f\u52a8\u5bc6\u7801\uff0c\u4f60\u53ef\u4ee5\u7ed1\u5b9a\u6302\u8f7d\u8fd9\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u5728\u6302\u8f7d\u8def\u5f84\u4e2d\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",(0,r.kt)("inlineCode",{parentName:"p"},"ELASTIC_PASSWORD_FILE"),"\u3002\u5982\u679c\u4f60\u6302\u8f7d\u7684\u5bc6\u7801\u6587\u4ef6\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"/run/secrets/bootstrapPassword.txt"),",\u5982\u4e0b\u6307\u5b9a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"-e ELASTIC_PASSWORD_FILE=/run/secrets/bootstrapPassword.txt\n")),(0,r.kt)("p",null,"\u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012 Elasticsearch \u914d\u7f6e\u53c2\u6570\u4f5c\u4e3a\u547d\u4ee4\u884c\u9009\u9879\uff0c\u6765\u91cd\u8f7d\u9ed8\u8ba4\u7684\u547d\u4ee4\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run <various parameters> bin/elasticsearch -Ecluster.name=mynewclustername\n")),(0,r.kt)("p",null,"\u867d\u7136\u7ed1\u5b9a\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6\u901a\u5e38\u5728\u751f\u4ea7\u73af\u5883\u662f\u9996\u9009\u65b9\u6cd5\uff0c\u4f60\u4e5f\u53ef\u4ee5\u521b\u5efa\u5305\u542b\u4f60\u81ea\u5df1\u914d\u7f6e\u7684",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-Docker-%E9%95%9C%E5%83%8F"},"\u81ea\u5b9a\u4e49 Docker \u955c\u50cf"),"\u3002"),(0,r.kt)("h3",{id:"\u6302\u8f7d-elasticsearch-\u914d\u7f6e\u6587\u4ef6"},"\u6302\u8f7d Elasticsearch \u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"\u521b\u5efa\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u5176\u7ed1\u5b9a\u6302\u8f7d\u5230 Docker \u955c\u50cf\u7684\u76f8\u5e94\u6587\u4ef6\u4e0a\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run")," \u7ed1\u5b9a\u6302\u8f7d ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_elasticsearch.yml"),"\uff0c\u5982\u4e0b\u6307\u5b9a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"-v full_path_to/custom_elasticsearch.yml:/usr/share/elasticsearch/configuring_elasticsearch/elasticsearch.yml\n")),(0,r.kt)("admonition",{title:"\u8b66\u544a",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"\u5bb9\u5668\u4ee5\u7528\u6237 ",(0,r.kt)("inlineCode",{parentName:"p"},"elasticsearch"),"\uff0c\u4f7f\u7528 uid:gid ",(0,r.kt)("inlineCode",{parentName:"p"},"1000:0")," \u8fd0\u884c Elasticsearch\u3002\u7ed1\u5b9a\u6302\u8f7d\u7684\u4e3b\u673a\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u5fc5\u987b\u80fd\u88ab\u6b64\u7528\u6237\u8bbf\u95ee\uff0c\u4e14\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55\u5fc5\u987b\u80fd\u88ab\u6b64\u7528\u6237\u5199\u5165\u3002")),(0,r.kt)("h3",{id:"\u6302\u8f7d-elasticsearch-\u5bc6\u94a5\u5e93"},"\u6302\u8f7d Elasticsearch \u5bc6\u94a5\u5e93"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cElasticsearch \u4f1a\u4e3a\u5b89\u5168\u8bbe\u7f6e\u81ea\u52a8\u751f\u6210\u5bc6\u94a5\u5e93\u6587\u4ef6\u3002\u8fd9\u4e2a\u6587\u4ef6\u662f\u6df7\u6dc6\u7684\uff0c\u4f46\u6ca1\u6709\u52a0\u5bc6\u3002\u5982\u679c\u4f60\u60f3\u4f7f\u7528\u5bc6\u7801\u52a0\u5bc6\u4f60\u7684",(0,r.kt)("a",{parentName:"p",href:"/set_up_elasticsearch/configuring_elasticsearchsecure_settings"},"\u5b89\u5168\u8bbe\u7f6e"),"\uff0c\u4f60\u5fc5\u987b\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"elasticsearch-keystore")," \u7a0b\u5e8f\u53bb\u521b\u5efa\u4e00\u4e2a\u5bc6\u7801\u4fdd\u62a4\u7684\u5bc6\u94a5\u5e93\uff0c\u7136\u540e\u7ed1\u5b9a\u6302\u8f7d\u5b83\u5230\u5bb9\u5668\u4e2d\u6587\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/elasticsearch/configuring_elasticsearchelasticsearch.keystore"),"\u3002\u4e3a\u4e86\u5728\u542f\u52a8\u65f6\u5411 Docker \u5bb9\u5668\u63d0\u4f9b\u5bc6\u7801\uff0c\u5c06 Docker \u7684\u73af\u5883\u53d8\u91cf\u503c ",(0,r.kt)("inlineCode",{parentName:"p"},"KEYSTORE_PASSWORD")," \u8bbe\u7f6e\u4e3a\u5bc6\u7801\u503c\u3002\u4f8b\u5982\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"docker run")," \u547d\u4ee4\u53ef\u4ee5\u6709\u4ee5\u4e0b\u7684\u9009\u9879\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"-v full_path_to/elasticsearch.keystore:/usr/share/elasticsearch/configuring_elasticsearch/elasticsearch.keystore\n-E KEYSTORE_PASSWORD=mypassword\n")),(0,r.kt)("h3",{id:"\u4f7f\u7528\u81ea\u5b9a\u4e49-docker-\u955c\u50cf"},"\u4f7f\u7528\u81ea\u5b9a\u4e49 Docker \u955c\u50cf"),(0,r.kt)("p",null,"\u5728\u4e00\u4e9b\u73af\u5883\u4e2d\uff0c\u51c6\u5907\u5305\u542b\u4f60\u914d\u7f6e\u7684\u81ea\u5b9a\u4e49\u955c\u50cf\u66f4\u6709\u610f\u4e49\u3002\u5b9e\u73b0\u8fd9\u4e00\u70b9\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile")," \u53ef\u80fd\u5982\u4e0b\u4e00\u6837\u7b80\u5355\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"FROM docker.elastic.co/elasticsearch/elasticsearch:7.11.2\nCOPY --chown=elasticsearch:elasticsearch elasticsearch.yml /usr/share/elasticsearch/configuring_elasticsearch\n")),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u8fd9\u6837\u6784\u5efa\u548c\u8fd0\u884c\u955c\u50cf\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build --tag=elasticsearch-custom .\ndocker run -ti -v /usr/share/elasticsearch/data elasticsearch-custom\n")),(0,r.kt)("p",null,"\u4e00\u4e9b\u63d2\u4ef6\u9700\u8981\u989d\u5916\u7684\u5b89\u5168\u6743\u9650\u3002\u4f60\u5fc5\u987b\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u660e\u786e\u63a5\u53d7\u5b83\u4eec\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u4f60\u8fd0\u884c Docker \u955c\u50cf\u65f6\uff0c\u9644\u52a0 ",(0,r.kt)("inlineCode",{parentName:"li"},"tty")," \u5e76\u5728\u63d0\u4f9b\u65f6\u5141\u8bb8\u6743\u9650\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u5411\u63d2\u4ef6\u5b89\u88c5\u547d\u4ee4\u6dfb\u52a0 ",(0,r.kt)("inlineCode",{parentName:"li"},"--batch")," \u6807\u5fd7\u6765\u68c0\u67e5\u5b89\u5168\u6743\u9650\uff0c\u5e76\u4e14\u63a5\u53d7\u5b83\u4eec\uff08\u5982\u679c\u5408\u9002\uff09")),(0,r.kt)("p",null,"\u53c2\u9605",(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/plugins/7.11/_other_command_line_parameters.html"},"\u63d2\u4ef6\u7ba1\u7406"),"\uff0c\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002"),(0,r.kt)("h2",{id:"\u4e0b\u4e00\u6b65"},"\u4e0b\u4e00\u6b65"),(0,r.kt)("p",null,"\u4f60\u73b0\u5728\u6709\u4e00\u4e2a\u6d4b\u8bd5 Elasticsearch \u73af\u5883\u90e8\u7f72\u597d\u3002\u5728\u4f60\u4f7f\u7528 Elasticsearch \u6b63\u5f0f\u5f00\u59cb\u5f00\u53d1\u6216\u8005\u751f\u4ea7\u4e4b\u524d\uff0c\u4f60\u5fc5\u987b\u505a\u4e00\u4e9b\u989d\u5916\u7684\u8bbe\u7f6e\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b66\u4e60\u5982\u4f55\u914d\u7f6e ",(0,r.kt)("a",{parentName:"li",href:"/set_up_elasticsearch/config"},"Elasticsearch"),"\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u914d\u7f6e",(0,r.kt)("a",{parentName:"li",href:"/set_up_elasticsearch/important_es_config"},"\u91cd\u8981\u7684 Elasticsearch \u8bbe\u7f6e"),"\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u914d\u7f6e",(0,r.kt)("a",{parentName:"li",href:"/set_up_elasticsearch/important_system_config"},"\u91cd\u8981\u7684\u7cfb\u7edf\u8bbe\u7f6e"),"\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html"},"\u539f\u6587\u94fe\u63a5"))))}m.isMDXComponent=!0}}]);